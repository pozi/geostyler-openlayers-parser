var GeoStylerOpenlayersParser=function(A){"use strict";var Tr=Object.defineProperty;var Dr=(A,E,D)=>E in A?Tr(A,E,{enumerable:!0,configurable:!0,writable:!0,value:D}):A[E]=D;var I=(A,E,D)=>(Dr(A,typeof E!="symbol"?E+"":E,D),D);function E(n){return!/^(-?\d|--)/.test(n)}function D(n){const t=[];let e="",i="",r=7;for(let s,o=0;s=n.charAt(o);o++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(s)&&r===7)e+=s;else if(s==="\\"&&r===7)r=6;else if(s===" "&&r===7){if(e!==""){if(!E(e))return null;t.push(e),e=""}}else if(r===6)/[0-9a-f]/i.test(s)?(i+=s,r=8):(e+=s,r=7);else{if(r!==8)return null;/[0-9a-f]/i.test(s)&&i.length<6?i+=s:(e+=String.fromCodePoint(parseInt(i,16)),e+=s,i="",r=7)}if(e!==""){if(!E(e))return null;t.push(e)}return t.join(" ")}function Fi(n,t){let e=t,i="";const r={"font-family":[]};for(let s,o=0;s=n.charAt(o);o+=1)if(e!==4||s!=='"'&&s!=="'")if(e===3&&s===",")e=4,i="";else if(e===4&&s===","){const a=D(i);a&&r["font-family"].push(a),i=""}else if(e===5&&s===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(i)?(r["font-style"]+=" "+i,i=""):o-=1,e=1;else if(e!==1||s!==" "&&s!=="/")e===2&&s===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(i)&&(r["line-height"]=i),e=4,i=""):i+=s;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(i)||/^(?:larg|small)er$/.test(i)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(i))e=s==="/"?2:4,r["font-size"]=i;else if(/^italic$/.test(i))r["font-style"]=i;else if(/^oblique$/.test(i))r["font-style"]=i,e=5;else if(/^small-caps$/.test(i))r["font-variant"]=i;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(i))r["font-weight"]=i;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(i)){const a=parseFloat(i);a>=1&&a<=1e3&&(r["font-weight"]=i)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(i)&&(r["font-stretch"]=i);i=""}else{let a=o+1;do if(a=n.indexOf(s,a)+1,!a)return null;while(n.charAt(a-2)==="\\");r["font-family"].push(n.slice(o+1,a-1).replace(/\\('|")/g,"$1")),o=a-1,e=3,i=""}if(e===3&&!/^\s*$/.test(i))return null;if(e===4){const s=D(i);s&&r["font-family"].push(s)}return r}function Ii(n){const t=Fi(n,1);return t!==null&&t["font-size"]&&t["font-family"].length?t:null}function Li(n){return n!=null&&typeof n.valueOf()=="string"}const Ai=n=>(n==null?void 0:n.kind)==="Icon",Ei=n=>(n==null?void 0:n.kind)==="Mark"&&Li(n==null?void 0:n.wellKnownName),wt=n=>["abs","acos","add","asin","atan","atan2","ceil","cos","div","exp","floor","interpolate","log","max","min","modulo","mul","pi","pow","random","rint","round","sin","sqrt","strIndexOf","strLastIndexOf","strLength","sub","tan","toDegrees","toNumber","toRadians"].includes(n==null?void 0:n.name),V=n=>["numberFormat","strAbbreviate","strCapitalize","strConcat","strDefaultIfBlank","strReplace","strStripAccents","strSubstring","strSubstringStart","strToLowerCase","strToString","strToUpperCase","strTrim"].includes(n==null?void 0:n.name),et=n=>["all","any","between","double2bool","equalTo","greaterThan","greaterThanOrEqualTo","in","lessThan","lessThanOrEqualTo","not","notEqualTo","parseBoolean","strEndsWith","strEqualsIgnoreCase","strMatches","strStartsWith"].includes(n==null?void 0:n.name),le=n=>["case","property","step"].includes(n==null?void 0:n.name),O=n=>et(n)||wt(n)||V(n)||le(n),xt=n=>typeof(n==null?void 0:n.source)=="string"||O(n==null?void 0:n.source)&&Array.isArray(n.position)&&Array.isArray(n.size);class Mi{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}var ce=Mi,Ti={PROPERTYCHANGE:"propertychange"};class Di{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}var Pi=Di;function he(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function ue(){}function Ri(n){let t,e,i;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==i||!he(r,e))&&(i=this,e=r,t=n.apply(this,arguments)),t}}function fe(n){for(const t in n)delete n[t]}function zi(n){let t;for(t in n)return!1;return!t}class Ni extends Pi{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),r=i[t]||(i[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const s=e?new ce(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let c=0,h=r.length;c<h;++c)if("handleEvent"in r[c]?l=r[c].handleEvent(s):l=r[c].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[i]===0){let c=a[i];for(delete a[i];c--;)this.removeEventListener(i,ue);delete o[i]}return l}disposeInternal(){this.listeners_&&fe(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const r=i.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[r]=ue,++this.pendingRemovals_[t]):(i.splice(r,1),i.length===0&&delete this.listeners_[t]))}}var ge=Ni,R={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function it(n,t,e,i,r){if(r){const o=e;e=function(){n.removeEventListener(t,e),o.apply(i??this,arguments)}}else i&&i!==n&&(e=e.bind(i));const s={target:n,type:t,listener:e};return n.addEventListener(t,e),s}function de(n,t,e,i){return it(n,t,e,i,!0)}function Ct(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),fe(n))}class nt extends ge{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(R.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=it(this,t[s],e);return r}return it(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const r=t.length;i=new Array(r);for(let s=0;s<r;++s)i[s]=de(this,t[s],e)}else i=de(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)Gi(i);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}nt.prototype.on,nt.prototype.once,nt.prototype.un;function Gi(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)Ct(n[t]);else Ct(n)}var Wi=nt;function v(){throw new Error("Unimplemented abstract method.")}let Bi=0;function vt(n){return n.ol_uid||(n.ol_uid=String(++Bi))}class me extends ce{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class qi extends Wi{constructor(t){super(),this.on,this.once,this.un,vt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new me(i,t,e)),i=Ti.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new me(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const r=this.values_||(this.values_={});if(i)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],zi(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}var Ot=qi;function rt(n,t){if(!n)throw new Error(t)}const Ui=new Array(6);function kt(){return[1,0,0,1,0,0]}function Xi(n,t){const e=n[0],i=n[1],r=n[2],s=n[3],o=n[4],a=n[5],l=t[0],c=t[1],h=t[2],f=t[3],u=t[4],d=t[5];return n[0]=e*l+r*c,n[1]=i*l+s*c,n[2]=e*h+r*f,n[3]=i*h+s*f,n[4]=e*u+r*d+o,n[5]=i*u+s*d+a,n}function Yi(n,t,e,i,r,s,o){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n[4]=s,n[5]=o,n}function $i(n,t,e){return Xi(n,Yi(Ui,t,0,0,e,0,0))}function _e(n,t,e,i,r,s,o,a){const l=Math.sin(s),c=Math.cos(s);return n[0]=i*c,n[1]=r*l,n[2]=-i*l,n[3]=r*c,n[4]=o*i*c-a*i*l+t,n[5]=o*r*l+a*r*c+e,n}function Vi(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function Hi(){return[1/0,1/0,-1/0,-1/0]}function ye(n,t,e,i,r){return r?(r[0]=n,r[1]=t,r[2]=e,r[3]=i,r):[n,t,e,i]}function pe(n){return ye(1/0,1/0,-1/0,-1/0,n)}function ji(n,t){const e=n[0],i=n[1];return ye(e,i,e,i,t)}function Ki(n,t,e,i,r){const s=pe(r);return Ji(s,n,t,e,i)}function Ji(n,t,e,i,r){for(;e<i;e+=r)Zi(n,t[e],t[e+1]);return n}function Zi(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function Qi(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Se(n){return n[3]-n[1]}function H(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function tn(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}const we={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class en{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||we[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}var bt=en;const j=6378137,W=Math.PI*j,nn=[-W,-W,W,W],rn=[-180,-85,180,85],st=j*Math.log(Math.tan(Math.PI/2));class B extends bt{constructor(t){super({code:t,units:"m",extent:nn,global:!0,worldExtent:rn,getPointResolution:function(e,i){return e/Math.cosh(i[1]/j)}})}}const xe=[new B("EPSG:3857"),new B("EPSG:102100"),new B("EPSG:102113"),new B("EPSG:900913"),new B("http://www.opengis.net/def/crs/EPSG/0/3857"),new B("http://www.opengis.net/gml/srs/epsg.xml#3857")];function sn(n,t,e,i){const r=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let s=0;s<r;s+=i){t[s]=W*n[s]/180;let o=j*Math.log(Math.tan(Math.PI*(+n[s+1]+90)/360));o>st?o=st:o<-st&&(o=-st),t[s+1]=o}return t}function on(n,t,e,i){const r=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(r));for(let s=0;s<r;s+=i)t[s]=180*n[s]/W,t[s+1]=360*Math.atan(Math.exp(n[s+1]/j))/Math.PI-90;return t}const an=6378137,Ce=[-180,-90,180,90],ln=Math.PI*an/180;class z extends bt{constructor(t,e){super({code:t,units:"degrees",extent:Ce,axisOrientation:e,global:!0,metersPerUnit:ln,worldExtent:Ce})}}const ve=[new z("CRS:84"),new z("EPSG:4326","neu"),new z("urn:ogc:def:crs:OGC:1.3:CRS84"),new z("urn:ogc:def:crs:OGC:2:84"),new z("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new z("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new z("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ft={};function cn(n){return Ft[n]||Ft[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function hn(n,t){Ft[n]=t}let q={};function K(n,t,e){const i=n.getCode(),r=t.getCode();i in q||(q[i]={}),q[i][r]=e}function It(n,t){return n in q&&t in q[n]?q[n][t]:null}function ot(n,t,e){return Math.min(Math.max(n,t),e)}function un(n,t,e,i){const r=e-n,s=i-t;return r*r+s*s}function Oe(n){return n*180/Math.PI}function at(n){return n*Math.PI/180}function fn(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function Lt(n,t,e){if(n>=t&&n<e)return n;const i=e-t;return((n-t)%i+i)%i+t}const lt=.9996,L=.00669438,ct=L*L,ht=ct*L,N=L/(1-L),ke=Math.sqrt(1-L),U=(1-ke)/(1+ke),be=U*U,At=be*U,Et=At*U,Fe=Et*U,Ie=1-L/4-3*ct/64-5*ht/256,gn=3*L/8+3*ct/32+45*ht/1024,dn=15*ct/256+45*ht/1024,mn=35*ht/3072,_n=3/2*U-27/32*At+269/512*Fe,yn=21/16*be-55/32*Et,pn=151/96*At-417/128*Fe,Sn=1097/512*Et,ut=6378137;function wn(n,t,e){const i=n-5e5,o=(e.north?t:t-1e7)/lt/(ut*Ie),a=o+_n*Math.sin(2*o)+yn*Math.sin(4*o)+pn*Math.sin(6*o)+Sn*Math.sin(8*o),l=Math.sin(a),c=l*l,h=Math.cos(a),f=l/h,u=f*f,d=u*u,m=1-L*c,_=Math.sqrt(1-L*c),S=ut/_,p=(1-L)/m,y=N*h**2,x=y*y,C=i/(S*lt),F=C*C,T=F*C,ki=T*C,bi=ki*C,Er=bi*C,Mr=a-f/p*(F/2-ki/24*(5+3*u+10*y-4*x-9*N))+Er/720*(61+90*u+298*y+45*d-252*N-3*x);let ae=(C-T/6*(1+2*u+y)+bi/120*(5-2*y+28*u-3*x+8*N+24*d))/h;return ae=Lt(ae+at(Ee(e.number)),-Math.PI,Math.PI),[Oe(ae),Oe(Mr)]}const Le=-80,Ae=84,xn=-180,Cn=180;function vn(n,t,e){n=Lt(n,xn,Cn),t<Le?t=Le:t>Ae&&(t=Ae);const i=at(t),r=Math.sin(i),s=Math.cos(i),o=r/s,a=o*o,l=a*a,c=at(n),h=Ee(e.number),f=at(h),u=ut/Math.sqrt(1-L*r**2),d=N*s**2,m=s*Lt(c-f,-Math.PI,Math.PI),_=m*m,S=_*m,p=S*m,y=p*m,x=y*m,C=ut*(Ie*i-gn*Math.sin(2*i)+dn*Math.sin(4*i)-mn*Math.sin(6*i)),F=lt*u*(m+S/6*(1-a+d)+y/120*(5-18*a+l+72*d-58*N))+5e5;let T=lt*(C+u*o*(_/2+p/24*(5-a+9*d+4*d**2)+x/720*(61-58*a+l+600*d-330*N)));return e.north||(T+=1e7),[F,T]}function Ee(n){return(n-1)*6-180+3}const On=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Me(n){let t=0;for(const r of On){const s=n.match(r);if(s){t=parseInt(s[1]);break}}if(!t)return null;let e=0,i=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(i=!0,e=t-32600),e?{number:e,north:i}:null}function Te(n,t){return function(e,i,r,s){const o=e.length;r=r>1?r:2,s=s??r,i||(r>2?i=e.slice():i=new Array(o));for(let a=0;a<o;a+=s){const l=e[a],c=e[a+1],h=n(l,c,t);i[a]=h[0],i[a+1]=h[1]}return i}}function kn(n){return Me(n)?new bt({code:n,units:"m"}):null}function bn(n){const t=Me(n.getCode());return t?{forward:Te(vn,t),inverse:Te(wn,t)}:null}const Fn=[bn],In=[kn];function De(n,t){if(t!==void 0){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];t=t}else t=n.slice();return t}function Mt(n){hn(n.getCode(),n),K(n,n,De)}function Ln(n){n.forEach(Mt)}function Tt(n){if(typeof n!="string")return n;const t=cn(n);if(t)return t;for(const e of In){const i=e(n);if(i)return i}return null}function Pe(n){Ln(n),n.forEach(function(t){n.forEach(function(e){t!==e&&K(t,e,De)})})}function An(n,t,e,i){n.forEach(function(r){t.forEach(function(s){K(r,s,e),K(s,r,i)})})}function En(n,t){const e=n.getCode(),i=t.getCode();let r=It(e,i);if(r)return r;let s=null,o=null;for(const l of Fn)s||(s=l(n)),o||(o=l(t));if(!s&&!o)return null;const a="EPSG:4326";if(o)if(s)r=Dt(s.inverse,o.forward);else{const l=It(e,a);l&&(r=Dt(l,o.forward))}else{const l=It(a,i);l&&(r=Dt(s.inverse,l))}return r&&(Mt(n),Mt(t),K(n,t,r)),r}function Dt(n,t){return function(e,i,r,s){return i=n(e,i,r,s),t(i,i,r,s)}}function Re(n,t){const e=Tt(n),i=Tt(t);return En(e,i)}function Mn(){Pe(xe),Pe(ve),An(ve,xe,sn,on)}Mn();function J(n,t,e,i,r,s,o){s=s||[],o=o||2;let a=0;for(let l=t;l<e;l+=i){const c=n[l],h=n[l+1];s[a++]=r[0]*c+r[2]*h+r[4],s[a++]=r[1]*c+r[3]*h+r[5];for(let f=2;f<o;f++)s[a++]=n[l+f]}return s&&s.length!=a&&(s.length=a),s}function Tn(n,t,e,i,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),c=s[0],h=s[1];let f=0;for(let u=t;u<e;u+=i){const d=n[u]-c,m=n[u+1]-h;o[f++]=c+d*a-m*l,o[f++]=h+d*l+m*a;for(let _=u+2;_<u+i;++_)o[f++]=n[_]}return o&&o.length!=f&&(o.length=f),o}function Dn(n,t,e,i,r,s,o,a){a=a||[];const l=o[0],c=o[1];let h=0;for(let f=t;f<e;f+=i){const u=n[f]-l,d=n[f+1]-c;a[h++]=l+r*u,a[h++]=c+s*d;for(let m=f+2;m<f+i;++m)a[h++]=n[m]}return a&&a.length!=h&&(a.length=h),a}function Pn(n,t,e,i,r,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=n[l]+r,o[a++]=n[l+1]+s;for(let c=l+2;c<l+i;++c)o[a++]=n[c]}return o&&o.length!=a&&(o.length=a),o}const ze=kt();class Rn extends Ot{constructor(){super(),this.extent_=Hi(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Ri((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return v()}closestPointXY(t,e,i,r){return v()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return v()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&pe(e),this.extentRevision_=this.getRevision()}return tn(this.extent_,t)}rotate(t,e){v()}scale(t,e,i){v()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return v()}getType(){return v()}applyTransform(t){v()}intersectsExtent(t){return v()}translate(t,e){v()}transform(t,e){const i=Tt(t),r=i.getUnits()=="tile-pixels"?function(s,o,a){const l=i.getExtent(),c=i.getWorldExtent(),h=Se(c)/Se(l);_e(ze,c[0],c[3],h,-h,0,0,0);const f=J(s,0,s.length,a,ze,o),u=Re(i,e);return u?u(f,f,a):f}:Re(i,e);return this.applyTransform(r),this}}var zn=Rn;class Nn extends zn{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Ki(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return v()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Ne(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){v()}setLayout(t,e,i){let r;if(t)r=Ne(t);else{for(let s=0;s<i;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=Gn(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();Tn(i,0,i.length,r,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=Qi(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();Dn(r,0,r.length,s,t,e,i,r),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();Pn(i,0,i.length,r,t,e,i),this.changed()}}}function Gn(n){let t;return n==2?t="XY":n==3?t="XYZ":n==4&&(t="XYZM"),t}function Ne(n){let t;return n=="XY"?t=2:n=="XYZ"||n=="XYM"?t=3:n=="XYZM"&&(t=4),t}function Wn(n,t,e){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return J(i,0,i.length,r,t,e)}var Bn=Nn;function qn(n,t,e,i){for(let r=0,s=e.length;r<s;++r)n[t++]=e[r];return t}class Pt extends Bn{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Pt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const s=this.flatCoordinates,o=un(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return ji(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Vi(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=qn(this.flatCoordinates,0,t,this.stride),this.changed()}}var Un=Pt,w={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},ft={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},b={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};b.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},b.max=b.whitepoint[2].D65,b.rgb=function(n,t){t=t||b.whitepoint[2].E;var e=n[0]/t[0],i=n[1]/t[1],r=n[2]/t[2],s,o,a;return s=e*3.240969941904521+i*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+i*1.87596750150772+r*.041555057407175,a=e*.055630079696993+i*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,.4166666666666667)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,.4166666666666667)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,.4166666666666667)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]},ft.xyz=function(n,t){var e=n[0]/255,i=n[1]/255,r=n[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+i*.35758433938387+r*.18048078840183,o=e*.21263900587151+i*.71516867876775+r*.072192315360733,a=e*.019330818715591+i*.11919477979462+r*.95053215224966;return t=t||b.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};var Ge={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(n,t,e){var i,r,s,o,a,l,c,h,f,u,d,m,_;if(s=n[0],o=n[1],a=n[2],s===0)return[0,0,0];var S=.0011070564598794539;return t=t||"D65",e=e||2,f=b.whitepoint[e][t][0],u=b.whitepoint[e][t][1],d=b.whitepoint[e][t][2],m=4*f/(f+15*u+3*d),_=9*u/(f+15*u+3*d),i=o/(13*s)+m||0,r=a/(13*s)+_||0,c=s>8?u*Math.pow((s+16)/116,3):u*s*S,l=c*9*i/(4*r)||0,h=c*(12-3*i-20*r)/(4*r)||0,[l,c,h]}};b.luv=function(n,t,e){var i,r,s,o,a,l,c,h,f,u,d,m,_,S=.008856451679035631,p=903.2962962962961;t=t||"D65",e=e||2,f=b.whitepoint[e][t][0],u=b.whitepoint[e][t][1],d=b.whitepoint[e][t][2],m=4*f/(f+15*u+3*d),_=9*u/(f+15*u+3*d),l=n[0],c=n[1],h=n[2],i=4*l/(l+15*c+3*h)||0,r=9*c/(l+15*c+3*h)||0;var y=c/u;return s=y<=S?p*y:116*Math.pow(y,.3333333333333333)-16,o=13*s*(i-m),a=13*s*(r-_),[s,o,a]},Ge.lchuv=function(n){var t=n[0],e=n[1],i=n[2],r=Math.sqrt(e*e+i*i),s=Math.atan2(i,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]},b.lchuv=function(n){return Ge.lchuv(b.luv(n))};function Xn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},We=Xn(Yn),Be={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function $n(n){var h,f;var t,e=[],i=1,r;if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(n=String(n).toLowerCase(),We[n])e=We[n].slice(),r="rgb";else if(n==="transparent")i=0,r="rgb",e=[0,0,0];else if(n[0]==="#"){var s=n.slice(1),o=s.length,a=o<=4;i=1,a?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(i=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(i=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(n)){var l=t[1];r=l.replace(/a$/,"");var c=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(u,d){if(u[u.length-1]==="%")return u=parseFloat(u)/100,d===3?u:r==="rgb"?u*255:r[0]==="h"||r[0]==="l"&&!d?u*100:r==="lab"?u*125:r==="lch"?d<2?u*150:u*360:r[0]==="o"&&!d?u:r==="oklab"?u*.4:r==="oklch"?d<2?u*.4:u*360:u;if(r[d]==="h"||d===2&&r[r.length-1]==="h"){if(Be[u]!==void 0)return Be[u];if(u.endsWith("deg"))return parseFloat(u);if(u.endsWith("turn"))return parseFloat(u)*360;if(u.endsWith("grad"))return parseFloat(u)*360/400;if(u.endsWith("rad"))return parseFloat(u)*180/Math.PI}return u==="none"?0:parseFloat(u)}),i=e.length>c?e.pop():1}else/[0-9](?:\s|\/|,)/.test(n)&&(e=n.match(/([0-9]+)/g).map(function(u){return parseFloat(u)}),r=((f=(h=n.match(/([a-z])/ig))==null?void 0:h.join(""))==null?void 0:f.toLowerCase())||"rgb");return{space:r,values:e,alpha:i}}var Rt={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(n){var t=n[0]/360,e=n[1]/100,i=n[2]/100,r,s,o,a,l,c=0;if(e===0)return l=i*255,[l,l,l];for(s=i<.5?i*(1+e):i+e-i*e,r=2*i-s,a=[0,0,0];c<3;)o=t+1/3*-(c-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[c++]=l*255;return a}};ft.hsl=function(n){var t=n[0]/255,e=n[1]/255,i=n[2]/255,r=Math.min(t,e,i),s=Math.max(t,e,i),o=s-r,a,l,c;return s===r?a=0:t===s?a=(e-i)/o:e===s?a=2+(i-t)/o:i===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),c=(r+s)/2,s===r?l=0:c<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,c*100]};function Vn(n){Array.isArray(n)&&n.raw&&(n=String.raw(...arguments)),n instanceof Number&&(n=+n);var t,e=$n(n);if(!e.space)return[];const i=e.space[0]==="h"?Rt.min:ft.min,r=e.space[0]==="h"?Rt.max:ft.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),r[2]),e.space[0]==="h"&&(t=Rt.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const Hn=[NaN,NaN,NaN,0];function jn(n){return typeof n=="string"?n:qe(n)}const Kn=1024,Z={};let zt=0;function Jn(n){if(n==="none")return Hn;if(Z.hasOwnProperty(n))return Z[n];if(zt>=Kn){let e=0;for(const i in Z)e++&3||(delete Z[i],--zt)}const t=Vn(n);if(t.length!==4)throw new Error('failed to parse "'+n+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+n+'" as color');return Zn(t),Z[n]=t,++zt,t}function gt(n){return Array.isArray(n)?n:Jn(n)}function Zn(n){return n[0]=ot(n[0]+.5|0,0,255),n[1]=ot(n[1]+.5|0,0,255),n[2]=ot(n[2]+.5|0,0,255),n[3]=ot(n[3],0,1),n}function qe(n){let t=n[0];t!=(t|0)&&(t=t+.5|0);let e=n[1];e!=(e|0)&&(e=e+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+r+")"}const P=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";P.includes("firefox"),P.includes("safari")&&!P.includes("chrom")&&(P.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(P)),P.includes("webkit")&&P.includes("edge"),P.includes("macintosh");const Qn=typeof devicePixelRatio<"u"?devicePixelRatio:1,tr=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,er=typeof Image<"u"&&Image.prototype.decode;(function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n})();function G(n,t,e,i){let r;return e&&e.length?r=e.shift():tr?r=new OffscreenCanvas(n||300,t||300):r=document.createElement("canvas"),n&&(r.width=n),t&&(r.height=t),r.getContext("2d",i)}let Nt;function Ue(){return Nt||(Nt=G(1,1)),Nt}function ir(n,t){return new Promise((e,i)=>{function r(){o(),e(n)}function s(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",r),n.removeEventListener("error",s)}n.addEventListener("load",r),n.addEventListener("error",s),t&&(n.src=t)})}function nr(n,t){return t&&(n.src=t),n.src&&er?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(r=>n.complete&&n.width?e(n):i(r))):ir(n)}class rr{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const r=Gt(t,e,i);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,i){const r=Gt(t,e,i);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,i,r,s){const o=Gt(t,e,i),a=o in this.cache_;this.cache_[o]=r,s&&(r.getImageState()===w.IDLE&&r.load(),r.getImageState()===w.LOADING?r.ready().then(()=>{this.patternCache_[o]=Ue().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=Ue().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Gt(n,t,e){const i=e?gt(e):"null";return t+":"+n+":"+i}const M=new rr;let Q=null;class Xe extends ge{constructor(t,e,i,r,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=s,this.imageState_=r===void 0?w.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===w.LOADED){Q||(Q=G(1,1,void 0,{willReadFrequently:!0})),Q.drawImage(this.image_,0,0);try{Q.getImageData(0,0,1,1),this.tainted_=!1}catch{Q=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(R.CHANGE)}handleImageError_(){this.imageState_=w.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=w.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=G(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===w.IDLE){this.image_||this.initializeImage_(),this.imageState_=w.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&nr(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==w.LOADED)return;const e=this.image_,i=G(Math.ceil(e.width*t),Math.ceil(e.height*t)),r=i.canvas;i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=jn(this.color_),i.fillRect(0,0,r.width/t,r.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===w.LOADED||this.imageState_===w.ERROR)t();else{const e=()=>{(this.imageState_===w.LOADED||this.imageState_===w.ERROR)&&(this.removeEventListener(R.CHANGE,e),t())};this.addEventListener(R.CHANGE,e)}})),this.ready_}}function Wt(n,t,e,i,r,s){let o=t===void 0?void 0:M.get(t,e,r);return o||(o=new Xe(n,n&&"src"in n?n.src||void 0:t,e,i,r),M.set(t,e,r,o,s)),s&&o&&!M.getPattern(t,e,r)&&M.set(t,e,r,o,s),o}var sr=Xe;function dt(n,t){return Array.isArray(n)?n:(t===void 0?t=[n,n]:(t[0]=n,t[1]=n),t)}class Bt{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=dt(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Bt({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return v()}getImage(t){return v()}getHitDetectionImage(){return v()}getPixelRatio(t){return 1}getImageState(){return v()}getImageSize(){return v()}getOrigin(){return v()}getSize(){return v()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=dt(t)}listenImageChange(t){v()}load(){v()}unlistenImageChange(t){v()}ready(){return Promise.resolve()}}var qt=Bt;function X(n){return n?Array.isArray(n)?qe(n):typeof n=="object"&&"src"in n?or(n):n:null}function or(n){if(!n.offset||!n.size)return M.getPattern(n.src,"anonymous",n.color);const t=n.src+":"+n.offset,e=M.getPattern(t,void 0,n.color);if(e)return e;const i=M.get(n.src,"anonymous",null);if(i.getImageState()!==w.LOADED)return null;const r=G(n.size[0],n.size[1]);return r.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),Wt(r.canvas,t,void 0,w.LOADED,n.color,!0),M.getPattern(t,void 0,n.color)}const ar="10px sans-serif",mt="#000",_t="round",Ye=[],$e=0,yt="round",Ut=10,Xt="#000",Ve="center",lr="middle",Yt=1;new Ot;class $t extends qt{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?w.LOADING:w.LOADED,this.imageState_===w.LOADING&&this.ready().then(()=>this.imageState_=w.LOADED),this.render()}clone(){const t=this.getScale(),e=new $t({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var s,o;const e=(s=this.fill_)==null?void 0:s.getKey(),i=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let r=(o=M.get(i,null,null))==null?void 0:o.getImage(1);if(!r){const a=this.renderOptions_,l=Math.ceil(a.size*t),c=G(l,l);this.draw_(a,c,t),r=c.canvas,M.set(i,null,null,new sr(r,void 0,null,w.LOADED,null))}return r}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const T=r;r=s,s=T}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),c=Math.sqrt(s*s-l*l),h=r-c,f=Math.sqrt(l*l+h*h),u=f/l;if(t==="miter"&&u<=i)return u*e;const d=e/2/u,m=e/2*(h/f),S=Math.sqrt((r+d)*(r+d)+m*m)-r;if(this.radius2_===void 0||t==="bevel")return S*2;const p=r*Math.sin(a),y=Math.sqrt(r*r-p*p),x=s-y,F=Math.sqrt(p*p+x*x)/p;if(F<=i){const T=F*e/2-s-r;return 2*Math.max(S,T)}return S*2}createRenderOptions(){let t=_t,e=yt,i=0,r=null,s=0,o,a=0;this.stroke_&&(o=X(this.stroke_.getColor()??Xt),a=this.stroke_.getWidth()??Yt,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??yt,t=this.stroke_.getLineCap()??_t,i=this.stroke_.getMiterLimit()??Ut);const l=this.calculateLineJoinSize_(e,a,i),c=Math.max(this.radius,this.radius2_||0),h=Math.ceil(2*c+l);return{strokeStyle:o,strokeWidth:a,size:h,lineCap:t,lineDash:r,lineDashOffset:s,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=mt),e.fillStyle=X(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=gt(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(e=G(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,c=a%2===0?i:r;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=mt,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}var He=$t;class Vt extends He{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Vt({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}var cr=Vt;class Ht{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Ht({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Wt(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===w.IDLE&&e.load(),e.getImageState()===w.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?vt(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:gt(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}var je=Ht;class jt{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new jt({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var hr=jt;class Kt{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Ke,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Kt({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Ke,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Ke(n){return n.getGeometry()}var Je=Kt;const ur="#333";class Jt{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=dt(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new je({color:ur}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Jt({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=dt(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}var fr=Jt;function Ze(n,t,e,i){return e!==void 0&&i!==void 0?[e/n,i/t]:e!==void 0?e/n:i!==void 0?i/t:1}class Zt extends qt{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;rt(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||vt(o)),rt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),rt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=w.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?w.LOADED:w.IDLE:l=w.LOADING:l=w.LOADED),this.color_=t.color!==void 0?gt(t.color):null,this.iconImage_=Wt(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let c,h;if(t.size)[c,h]=t.size;else{const f=this.getImage(1);if(f.width&&f.height)c=f.width,h=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;const u=()=>{if(this.unlistenImageChange(u),!this.initialOptions_)return;const d=this.iconImage_.getSize();this.setScale(Ze(d[0],d[1],t.width,t.height))};this.listenImageChange(u);return}}c!==void 0&&this.setScale(Ze(c,h,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Zt({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==w.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==w.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(R.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(R.CHANGE,t)}ready(){return this.iconImage_.ready()}}var Qe=Zt;const ti={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ei="3.7.7",gr=ei,Y=typeof Buffer=="function",ii=typeof TextDecoder=="function"?new TextDecoder:void 0,ni=typeof TextEncoder=="function"?new TextEncoder:void 0,dr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",tt=Array.prototype.slice.call(dr),pt=(n=>{let t={};return n.forEach((e,i)=>t[e]=i),t})(tt),mr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,k=String.fromCharCode.bind(String),ri=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),si=n=>n.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),oi=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),ai=n=>{let t,e,i,r,s="";const o=n.length%3;for(let a=0;a<n.length;){if((e=n.charCodeAt(a++))>255||(i=n.charCodeAt(a++))>255||(r=n.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=e<<16|i<<8|r,s+=tt[t>>18&63]+tt[t>>12&63]+tt[t>>6&63]+tt[t&63]}return o?s.slice(0,o-3)+"===".substring(o):s},Qt=typeof btoa=="function"?n=>btoa(n):Y?n=>Buffer.from(n,"binary").toString("base64"):ai,te=Y?n=>Buffer.from(n).toString("base64"):n=>{let e=[];for(let i=0,r=n.length;i<r;i+=4096)e.push(k.apply(null,n.subarray(i,i+4096)));return Qt(e.join(""))},St=(n,t=!1)=>t?si(te(n)):te(n),_r=n=>{if(n.length<2){var t=n.charCodeAt(0);return t<128?n:t<2048?k(192|t>>>6)+k(128|t&63):k(224|t>>>12&15)+k(128|t>>>6&63)+k(128|t&63)}else{var t=65536+(n.charCodeAt(0)-55296)*1024+(n.charCodeAt(1)-56320);return k(240|t>>>18&7)+k(128|t>>>12&63)+k(128|t>>>6&63)+k(128|t&63)}},yr=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,li=n=>n.replace(yr,_r),ci=Y?n=>Buffer.from(n,"utf8").toString("base64"):ni?n=>te(ni.encode(n)):n=>Qt(li(n)),$=(n,t=!1)=>t?si(ci(n)):ci(n),hi=n=>$(n,!0),pr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Sr=n=>{switch(n.length){case 4:var t=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),e=t-65536;return k((e>>>10)+55296)+k((e&1023)+56320);case 3:return k((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return k((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},ui=n=>n.replace(pr,Sr),fi=n=>{if(n=n.replace(/\s+/g,""),!mr.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let t,e="",i,r;for(let s=0;s<n.length;)t=pt[n.charAt(s++)]<<18|pt[n.charAt(s++)]<<12|(i=pt[n.charAt(s++)])<<6|(r=pt[n.charAt(s++)]),e+=i===64?k(t>>16&255):r===64?k(t>>16&255,t>>8&255):k(t>>16&255,t>>8&255,t&255);return e},ee=typeof atob=="function"?n=>atob(oi(n)):Y?n=>Buffer.from(n,"base64").toString("binary"):fi,gi=Y?n=>ri(Buffer.from(n,"base64")):n=>ri(ee(n).split("").map(t=>t.charCodeAt(0))),di=n=>gi(mi(n)),wr=Y?n=>Buffer.from(n,"base64").toString("utf8"):ii?n=>ii.decode(gi(n)):n=>ui(ee(n)),mi=n=>oi(n.replace(/[-_]/g,t=>t=="-"?"+":"/")),ie=n=>wr(mi(n)),xr=n=>{if(typeof n!="string")return!1;const t=n.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},_i=n=>({value:n,enumerable:!1,writable:!0,configurable:!0}),yi=function(){const n=(t,e)=>Object.defineProperty(String.prototype,t,_i(e));n("fromBase64",function(){return ie(this)}),n("toBase64",function(t){return $(this,t)}),n("toBase64URI",function(){return $(this,!0)}),n("toBase64URL",function(){return $(this,!0)}),n("toUint8Array",function(){return di(this)})},pi=function(){const n=(t,e)=>Object.defineProperty(Uint8Array.prototype,t,_i(e));n("toBase64",function(t){return St(this,t)}),n("toBase64URI",function(){return St(this,!0)}),n("toBase64URL",function(){return St(this,!0)})},Si={version:ei,VERSION:gr,atob:ee,atobPolyfill:fi,btoa:Qt,btoaPolyfill:ai,fromBase64:ie,toBase64:$,encode:$,encodeURI:hi,encodeURL:hi,utob:li,btou:ui,decode:ie,isValid:xr,fromUint8Array:St,toUint8Array:di,extendString:yi,extendUint8Array:pi,extendBuiltins:()=>{yi(),pi()}},ne=/^ttf:\/\/(.+)#(.+)$/,wi="data:image/svg+xml;base64,",xi=["horline","vertline","line"],Ci="geostyler-mark-symbolizer";class g{static getRgbaColor(t,e){if(V(t)&&(t=g.evaluateStringFunction(t)),typeof t!="string")return;if(t.startsWith("rgba("))return t;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t))return;const r=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);return wt(e)&&(e=g.evaluateNumberFunction(e)),e<0&&(e=1),"rgba("+r+", "+s+", "+o+", "+e+")"}static splitRgbaColor(t){const e=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/),i=parseInt(e[0],10),r=parseInt(e[1],10),s=parseInt(e[2],10),o=parseFloat(e[3]);return[i,r,s,o]}static getHexColor(t){if(t.startsWith("#"))return t;if(t.startsWith("rgb")){const e=g.splitRgbaColor(t);return g.getHexCodeFromRgbArray(e)}else if(ti[t.toLocaleLowerCase()]!==void 0){const e=ti[t.toLocaleLowerCase()];return g.getHexCodeFromRgbArray(e)}else return}static getHexCodeFromRgbArray(t){return"#"+t.map((e,i)=>{const r=e.toString(16);return i<3?r.length===1?"0"+r:r:""}).join("")}static getOpacity(t){if(!t.startsWith("rgba("))return;const e=g.splitRgbaColor(t);if(e.length===4)return e[3]}static checkOpacity(t){return typeof t=="number"&&t>=0&&t<1}static getTextFont(t){const e=t.fontWeight??"normal",i=t.fontStyle??"normal",r=t.size,s=t.font;return e+" "+i+" "+r+"px "+(s==null?void 0:s.join(", "))}static getIsFontGlyphBased(t){return ne.test(t.wellKnownName)}static getIsMarkSymbolizerFont(t){if(!t)return!1;const e=Ci;return t.substring(t.length-e.length,t.length)===e}static getTextFontForMarkSymbolizer(t){const e=t.wellKnownName.match(ne);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);const i=e[1];return`Normal ${t.radius||5}px '${i}', ${Ci}`}static getCharacterForMarkSymbolizer(t){const e=t.wellKnownName.match(ne);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);return String.fromCharCode(parseInt(e[2],16))}static getFontNameFromOlFont(t){const e=t.match(/(?:\d+\S+) '?"?([^,'"]+)/);if(!e)throw new Error(`Could not find font family name in the following string: ${t}`);return e[1]}static getSizeFromOlFont(t){const e=t.match(/(?:(\d+)px)/);return e?parseInt(e[1],10):0}static getBase64EncodedSvg(t){return wi+Si.encode(t)}static getBase64DecodedSvg(t){return Si.decode(t.replace(wi,""))}static resolveAttributeTemplate(t,e,i="n.v.",r=(s,o)=>o){let s="\\{\\{",o="\\}\\}",a=new RegExp(s+"(.*?)"+o,"g"),l=e.match(a);return l&&l.forEach(c=>{let h=0;for(let[f,u]of Object.entries(t.getProperties()))if(c.slice(2,c.length-2).toLowerCase()===f.toLowerCase()){e=e.replace(c,r(f,u));break}else h++;h===Object.keys(t.getProperties()).length&&(e=e.replace(c,i))}),e}static evaluateFunction(t,e){if(t.name==="property"){if(!e)throw new Error(`Could not evalute 'property' function. Feature ${e} is not defined.`);return V(t.args[0])?e==null?void 0:e.get(g.evaluateStringFunction(t.args[0],e)):e==null?void 0:e.get(t.args[0])}if(le(t))return g.evaluateUnknownFunction(t,e);if(V(t))return g.evaluateStringFunction(t,e);if(wt(t))return g.evaluateNumberFunction(t,e);if(et(t))return g.evaluateBooleanFunction(t,e)}static evaluateBooleanFunction(t,e){const i=t.args.map(r=>O(r)?g.evaluateFunction(r,e):r);switch(t.name){case"all":return i.map(o=>this.evaluateBooleanFunction(o,e)).every(o=>o===!0);case"any":return i.map(o=>this.evaluateBooleanFunction(o,e)).some(o=>o===!0);case"between":return i[0]>=i[1]&&i[0]<=i[2];case"double2bool":return!1;case"equalTo":return i[0]===i[1];case"greaterThan":return i[0]>i[1];case"greaterThanOrEqualTo":return i[0]>=i[1];case"in":return i.slice(1).includes(i[0]);case"lessThan":return i[0]<i[1];case"lessThanOrEqualTo":return i[0]<=i[1];case"not":return!i[0];case"notEqualTo":return i[0]!==i[1];case"parseBoolean":return!!i[0];case"strEndsWith":return i[0].endsWith(i[1]);case"strEqualsIgnoreCase":return i[0].toLowerCase()===i[1].toLowerCase();case"strMatches":const s=i[1].match(/\/(.*?)\/([gimy]{0,4})$/);return s&&s.length===3?new RegExp(s[1],s[2]).test(i[0]):!1;case"strStartsWith":return i[0].startsWith(i[1]);default:return!1}}static evaluateNumberFunction(t,e){if(t.name==="pi")return Math.PI;if(t.name==="random")return Math.random();const i=t.args.map(r=>O(r)?g.evaluateFunction(r,e):r);switch(t.name){case"abs":return Math.abs(i[0]);case"acos":return Math.acos(i[0]);case"add":return i[0]+i[1];case"asin":return Math.asin(i[0]);case"atan":return Math.atan(i[0]);case"atan2":return i[0];case"ceil":return Math.ceil(i[0]);case"cos":return Math.cos(i[0]);case"div":return i[0]/i[1];case"exp":return Math.exp(i[0]);case"floor":return Math.floor(i[0]);case"log":return Math.log(i[0]);case"max":return Math.max(...i);case"min":return Math.min(...i);case"modulo":return i[0]%i[1];case"mul":return i[0]*i[1];case"pow":return Math.pow(i[0],i[1]);case"rint":return i[0];case"round":return Math.round(i[0]);case"sin":return Math.sin(i[0]);case"sqrt":return Math.sqrt(i[0]);case"strIndexOf":return i[0].indexOf(i[1]);case"strLastIndexOf":return i[0].lastIndexOf(i[1]);case"strLength":return i[0].length;case"sub":return i[0]-i[1];case"tan":return Math.tan(i[0]);case"toDegrees":return i[0]*(180/Math.PI);case"toRadians":return i[0]*(Math.PI/180);default:return i[0]}}static evaluateUnknownFunction(t,e){const i=t.args.map(r=>O(r)?g.evaluateFunction(r,e):r);switch(t.name){case"property":return e==null?void 0:e.get(i[0]);case"case":const r=i;let s;for(let o=0;o<r.length;o++){const a=r[o];if(o===r.length-1){s=a;break}else if(a.case===!0){s=a.value;break}else if(g.evaluateBooleanFunction(a.case,e)){s=a.value;break}}return s;default:return i[0]}}static evaluateStringFunction(t,e){var s;const i=t.args.map(o=>O(o)?g.evaluateFunction(o,e):o);switch(t.name){case"numberFormat":return i[0];case"strAbbreviate":return i[0];case"strCapitalize":var r=i[0].toLowerCase().split(" ");for(let o of r)o=o.charAt(0).toUpperCase()+o.substring(1);return r.join(" ");case"strConcat":return i.join();case"strDefaultIfBlank":return((s=i[0])==null?void 0:s.length)<1?i[1]:i[0];case"strReplace":return i[3]===!0?i[0].replaceAll(i[1],i[2]):i[0].replace(i[1],i[2]);case"strStripAccents":return i[0].normalize("NFKD").replace(/[\u0300-\u036f]/g,"");case"strSubstring":return i[0].substring(i[1],i[2]);case"strSubstringStart":return i[0].substring(i[1]);case"strToLowerCase":return i[0].toLowerCase();case"strToUpperCase":return i[0].toUpperCase();case"strTrim":return i[0].trim();default:return i[0]}}static containsGeoStylerFunctions(t){return t.rules.some(e=>{var o,a,l,c;const i=Array.isArray(e.filter)&&((o=e.filter)==null?void 0:o.some(O)),r=(a=e.symbolizers)==null?void 0:a.some(h=>Object.values(h).some(O)),s=O((l=e==null?void 0:e.scaleDenominator)==null?void 0:l.max)||O((c=e==null?void 0:e.scaleDenominator)==null?void 0:c.min);return i||r||s})}}const vi={arrow:'d="M 0,-10 L 5,-5 L 2.5,-5 L 2.5,10 L -2.5,10 L -2.5,-5 L -5,-5 L 0,-10 Z"',arrowhead:'d="M -10 -10 L 0 0 L -10 10"',asterisk_fill:'d="M -1.5,-10 L 1.5,-10L 1.5,-3.939 L 6.011,-8.132 L 8.132,-6.011 L 3.939,-1.5 L 10,-1.5 L 10,1.5 L 3.939,1.5 L 8.132,6.011 L 6.011,8.132 L 1.5,3.939 L 1.5,10 L -1.5,10 L -1.5,3.939 L -6.011,8.132 L -8.132,6.011 L -3.939,1.5 L -10,1.5 L -10,-1.5 L -3.939,-1.5 L -8.132,-6.011 L -6.011,-8.132 L -1.5,-3.939 L -1.5,-10 Z"',backslash:'d="M -12 -12 L 12 12"',carrow:'d="M -10 10 L 0 -10 L 10 10 Z"',circle:'cx="0" cy="0" r="10"',cross:'d="M -12 0 L 12 0 M 0 -12 L 0 12"',cross_fill:'d="M -10,-2 L -10,-2 L -10,2 L -2,2 L -2,10 L 2,10 L 2,2 L 10,2 L 10,-2 L 2,-2 L 2,-10 L -2,-10 L -2,-2 L -10,-2 Z"',cross2:'d="M -12 -12 L 12 12 M 12 -12 L -12 12"',decagon:'points="5.878,8.09 9.511,3.09 9.511,-3.09 5.878,-8.09 0,-10 -5.878,-8.09 -9.511,-3.09 -9.511,3.09 -5.878,8.09 0,10 5.878,8.09"',diagonal_half_square:'points="-10,-10 10,10 -10,10 -10,-10"',diamond:'points="-10,0 0,10 10,0 0,-10 -10,0"',equilateral_triangle:'points="-8.66,5 8.66,5 0,-10 -8.66,5"',filled_arrowhead:'d="M 0,0 L -10,10 L -10,-10 L 0,0 Z"',half_arc:'d="M -10 0 A -10 -10 0 0 1 10 0"',half_square:'points="-10,-10 0,-10 0,10 -10,10 -10,-10"',heart:'d="M -9.5 -2 A 1 1 0 0 1 0 -7.5 A 1 1 0 0 1 9.5 -2 L 0 10 Z"',hexagon:'points="-8.66,-5 -8.66,5 0,10 8.66,5 8.66,-5 0,-10 -8.66,-5"',horline:'d="M -12 0 L 12 0"',left_half_triangle:'points="0,10 10,10 0,-10 0,10"',line:'d="M 0 -12 L 0 12"',oarrow:'d="M -10 10 L 0 -10 L 10 10"',octagon:'points="-4.142,10 4.142,10 10,4.142 10,-4.142 4.142,-10 -4.142,-10 -10,-4.142 -10,4.142 -4.142,10"',parallelogram_left:'points="10,5 5,-5 -10,-5 -5,5 10,5"',parallelogram_right:'points="5,5 10,-5 -5,-5 -10,5 5,5"',pentagon:'points="-9.511,-3.09 -5.878,8.09 5.878,8.09 9.511,-3.09 0,-10 -9.511,-3.09"',quarter_arc:'d="M 0 -10 A 10 10 0 0 0 -10 0"',quarter_circle:'d="M 0 -10 A 10 10 0 0 0 -10 0 L 0 0 Z"',quarter_square:'points="-10,-10 0,-10 0,0 -10,0 -10,-10"',right_half_triangle:'points="-10,10 0,10 0,-10 -10,10"',rounded_square:'x="-10" y="-10" width="20" height="20" rx="2.5" ry="2.5"',semi_circle:'d="M -10 0 A -10 -10 0 0 1 10 0 L 0 0 Z"',shield:'points="10,5 10,-10 -10,-10 -10,5 0,10 10,5"',slash:'d="M 12 -12 L -12 12"',square:'points="-10,-10 10,-10 10,10 -10,10"',square_with_corners:'points="-6.072,10 6.072,10 10,6.072 10,-6.072 6.072,-10 -6.072,-10 -10,-6.072 -10,6.072 -6.072,10"',star:'d="M -2.24514,-3.09017 -9.51057,-3.09017 -3.63271,1.18034 -5.87785,8.09017 0,3.81966 5.87785,8.09017 3.63271,1.18034 9.51057,-3.09017 2.24514,-3.09017 0,-10 -2.24514,-3.09017 Z"',star_diamond:'d="M -2.70091,-2.70091 -10,0 -2.70091,2.70091 0,10 2.70091,2.70091 10,0 2.70091,-2.70091 0,-10 Z"',third_arc:'d="M 0 -10 A 10 10 0 0 0 -5 8.66"',third_circle:'d="M 0 -10 A 10 10 0 0 0 -5 8.66 L 0 0 Z"',trapezoid:'points="5,-5 10,5 -10,5 -5,-5 5,-5"',triangle:'points="-10,10 10,10 0,-10 -10,10"'},Cr=n=>{switch(n){case"shape://backslash":return"backslash";case"shape://carrow":return"carrow";case"shape://dot":return"circle";case"shape://horline":return"horline";case"shape://oarrow":return"oarrow";case"shape://plus":return"cross";case"shape://slash":return"slash";case"shape://times":case"x":return"cross2";case"shape://vertline":return"line";default:return n}},Oi=n=>n in vi,vr=(n="circle",t={dimensions:40})=>{const{dimensions:e,fill:i,fillOpacity:r,stroke:s,strokeWidth:o,strokeOpacity:a}=t;if(!Oi(n))throw new Error("Unknown shape: "+n);const l='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+e+'" viewBox="-12 -12 24 24">',c="</svg>";let h=vi[n]+" ";h.startsWith("points=")?h='<polygon id="'+n+'" '+h:h.startsWith("x=")?h='<rect id="'+n+'" '+h:h.startsWith("cx=")?h='<circle id="'+n+'" '+h:h='<path id="'+n+'" '+h;let f="";return i&&(f+="fill:"+i+"; "),g.checkOpacity(r)&&(f+="fill-opacity:"+r+"; "),s&&(f+="stroke:"+s+"; "),o&&(f+="stroke-width:"+o+"; "),g.checkOpacity(a)&&(f+="stroke-opacity:"+a+"; "),xi.includes(n)&&(f=f+"stroke-linejoin: butt; "),h+='style="'+f.trim()+'" />',l+h+c},re=n=>{try{const e=new DOMParser().parseFromString(n,"application/xml");if(e.querySelector("parsererror"))throw new Error("Invalid XML format");const r=e.querySelector("svg");if(!r)throw new Error("<svg> element not found");const s=r==null?void 0:r.getAttribute("width");if(!s)throw new Error("<svg> element must include dimensions (no width attribute exists)");const o=Array.from(r==null?void 0:r.children).find(u=>u instanceof Element),a=(o==null?void 0:o.getAttribute("id"))??"",c=((o==null?void 0:o.getAttribute("style"))??"").split(";").filter(u=>u.trim()!==""),h={};for(const u of c){const[d,m]=u.split(":").map(_=>_.trim());d&&m&&(h[d]=m)}return{id:a,dimensions:Number(s),...h.fill&&{fill:h.fill},...h["fill-opacity"]&&{fillOpacity:Number(h["fill-opacity"])},...h.stroke&&{stroke:h.stroke},...h["stroke-width"]&&{strokeWidth:Number(h["stroke-width"])},...h["stroke-opacity"]&&{strokeOpacity:Number(h["stroke-opacity"])}}}catch{throw new Error("Error parsing SVG")}};class Or{drawCustom(t,e,i,r,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}var kr=Or;class br extends kr{constructor(t,e,i,r,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=r,this.transformRotation_=r?fn(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=kt()}drawImages_(t,e,i,r){if(!this.image_)return;const s=J(t,e,i,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,f=s.length;h<f;h+=2){const u=s[h]-this.imageAnchorX_,d=s[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const m=u+this.imageAnchorX_,_=d+this.imageAnchorY_;_e(a,m,_,1,1,c,-m,-_),o.save(),o.transform.apply(o,a),o.translate(m,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=J(t,e,i,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=r){const l=s[e]+this.textOffsetX_,c=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,c),this.textFillState_&&o.fillText(this.text_,l,c))}}moveToLineTo_(t,e,i,r,s){const o=this.context_,a=J(t,e,i,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let c=2;c<l;c+=2)o.lineTo(a[c],a[c+1]);return s&&o.closePath(),i}drawRings_(t,e,i,r){for(let s=0,o=i.length;s<o;++s)e=this.moveToLineTo_(t,e,i[s],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!H(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Wn(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],s=Math.sqrt(i*i+r*r),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!H(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(H(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,c=o.length;l<c;++l)s=this.moveToLineTo_(r,s,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!H(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!H(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let r=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){const c=s[a];r=this.drawRings_(i,r,c,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),he(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:Ve;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=r&&(i.textAlign=r,e.textAlign=r),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:X(i||mt)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),r=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),h=s||Ye;this.strokeState_={lineCap:r!==void 0?r:_t,lineDash:this.pixelRatio_===1?h:h.map(f=>f*this.pixelRatio_),lineDashOffset:(o||$e)*this.pixelRatio_,lineJoin:a!==void 0?a:yt,lineWidth:(l!==void 0?l:Yt)*this.pixelRatio_,miterLimit:c!==void 0?c:Ut,strokeStyle:X(i||Xt)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const d=e.getColor();this.textFillState_={fillStyle:X(d||mt)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const d=i.getColor(),m=i.getLineCap(),_=i.getLineDash(),S=i.getLineDashOffset(),p=i.getLineJoin(),y=i.getWidth(),x=i.getMiterLimit();this.textStrokeState_={lineCap:m!==void 0?m:_t,lineDash:_||Ye,lineDashOffset:S||$e,lineJoin:p!==void 0?p:yt,lineWidth:y!==void 0?y:Yt,miterLimit:x!==void 0?x:Ut,strokeStyle:X(d||Xt)}}const r=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),h=t.getText(),f=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:r!==void 0?r:ar,textAlign:f!==void 0?f:Ve,textBaseline:u!==void 0?u:lr},this.text_=h!==void 0?Array.isArray(h)?h.reduce((d,m,_)=>d+=_%2?" ":m,""):h:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}var Fr=br;function Ir(n,t){const e=n.canvas;t=t||{};const i=t.pixelRatio||Qn,r=t.size;r&&(e.width=r[0]*i,e.height=r[1]*i,e.style.width=r[0]+"px",e.style.height=r[1]+"px");const s=[0,0,e.width,e.height],o=$i(kt(),i,i);return new Fr(n,i,s,o,0)}class se extends Ot{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new se(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Ct(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=it(t,R.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Lr(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Lr(n){if(typeof n=="function")return n;let t;return Array.isArray(n)?t=n:(rt(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[n]),function(){return t}}var Ar=se;class oe{constructor(t){I(this,"unsupportedProperties",{Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none"},FillSymbolizer:{antialias:"none",opacity:{support:"none",info:"Use fillOpacity instead."}},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none",TextSymbolizer:{anchor:"none",placement:{support:"partial",info:"point and line supported. line-center will be mapped to line."}}},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}});I(this,"title","OpenLayers Style Parser");I(this,"olIconStyleCache",{});I(this,"OlStyleConstructor",Je);I(this,"OlStyleImageConstructor",qt);I(this,"OlStyleFillConstructor",je);I(this,"OlStyleStrokeConstructor",hr);I(this,"OlStyleTextConstructor",fr);I(this,"OlStyleCircleConstructor",cr);I(this,"OlStyleIconConstructor",Qe);I(this,"OlStyleRegularshapeConstructor",He);I(this,"isOlParserStyleFct",t=>typeof t=="function");t&&(this.OlStyleConstructor=t.style.Style,this.OlStyleImageConstructor=t.style.Image,this.OlStyleFillConstructor=t.style.Fill,this.OlStyleStrokeConstructor=t.style.Stroke,this.OlStyleTextConstructor=t.style.Text,this.OlStyleCircleConstructor=t.style.Circle,this.OlStyleIconConstructor=t.style.Icon,this.OlStyleRegularshapeConstructor=t.style.RegularShape)}getPointSymbolizerFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleCircleConstructor){const i=t.getImage(),r=i.getFill(),s=i.getStroke(),o=i.getDisplacement();e={kind:"Mark",wellKnownName:"circle",color:r?g.getHexColor(r.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:r?g.getOpacity(r.getColor()):void 0,radius:i.getRadius()!==0?i.getRadius():5,strokeColor:s?s.getColor():void 0,strokeOpacity:s?g.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,offset:o[0]||o[1]?o:void 0}}else if(t.getImage()instanceof this.OlStyleRegularshapeConstructor){const i=t.getImage(),r=i.getFill(),s=i.getStroke(),o=i.getRadius(),a=i.getRadius2(),l=i.getPoints(),c=i.getAngle(),h=i.getDisplacement(),f={kind:"Mark",color:r?g.getHexColor(r.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:r?g.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?g.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:o!==0?o:5,rotate:i.getRotation()/Math.PI*180,offset:h[0]||h[1]?h:void 0};switch(l){case 2:switch(c){case 0:f.wellKnownName="shape://vertline";break;case Math.PI/2:f.wellKnownName="shape://horline";break;case Math.PI/4:f.wellKnownName="shape://slash";break;case 2*Math.PI-Math.PI/4:f.wellKnownName="shape://backslash";break}break;case 3:switch(c){case 0:f.wellKnownName="triangle";break;case Math.PI/2:f.wellKnownName="shape://carrow";break}break;case 4:Number.isFinite(a)?i.getAngle()===0?f.wellKnownName="cross":f.wellKnownName="x":f.wellKnownName="square";break;case 5:f.wellKnownName="star";break;default:throw new Error("Could not parse OlStyle. Only 2, 3, 4 or 5 point regular shapes are allowed")}e=f}else if(t.getText()instanceof this.OlStyleTextConstructor){const i=t.getText(),r=i.getFill(),s=i.getStroke(),o=i.getRotation();let a=i.getText()||"a";const l=i.getFont()||"10px sans-serif",c=g.getFontNameFromOlFont(l),h=g.getSizeFromOlFont(l),f=[i.getOffsetX(),i.getOffsetY()];Array.isArray(a)&&(a=a[0]),e={kind:"Mark",wellKnownName:`ttf://${c}#0x${a.charCodeAt(0).toString(16)}`,color:r?g.getHexColor(r.getColor()):void 0,opacity:r?g.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?g.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:h!==0?h:5,rotate:o?o/Math.PI*180:0,offset:f[0]||f[1]?f:void 0}}else{const i=t.getImage(),r=i.getDisplacement();let s=i.getWidth();const o=i.getRotation()/Math.PI*180,a=i.getOpacity();try{const l=g.getBase64DecodedSvg(i.getSrc()),{id:c,dimensions:h,fill:f,stroke:u,strokeWidth:d}=re(l);let{fillOpacity:m,strokeOpacity:_}=re(l);m=g.checkOpacity(m)?m:g.getOpacity(String(f)),_=g.checkOpacity(_)?_:g.getOpacity(String(u)),e={kind:"Mark",wellKnownName:c,...f&&{color:f},...g.checkOpacity(m)&&{fillOpacity:m},...u&&{strokeColor:u.substring(0,7)},...d&&{strokeWidth:d},...g.checkOpacity(_)&&{strokeOpacity:_},...h/2!==0&&{radius:h/2},...g.checkOpacity(a)&&{opacity:a},...o&&{rotate:o},...(r[0]||r[1])&&{offset:r}}}catch{e={kind:"Icon",image:this.getImageFromIconStyle(i),size:s,...g.checkOpacity(a)&&{opacity:a},...o&&{rotate:o},...(r[0]||r[1])&&{offset:r}}}}return e}getImageFromIconStyle(t){const e=t.getSize();if(Array.isArray(e)){let i=t.offset_;const r=t.offsetOrigin_;if(r&&r!=="top-left")throw new Error(`Offset origin ${r} not supported`);return{source:t.getSrc(),position:i,size:e}}else return t.getSrc()?t.getSrc():void 0}getLineSymbolizerFromOlStyle(t){const e=t.getStroke(),i=e?e.getLineDash():void 0;return{kind:"Line",color:e?g.getHexColor(e.getColor()):void 0,opacity:e?g.getOpacity(e.getColor()):void 0,width:e?e.getWidth():void 0,cap:e?e.getLineCap():"butt",join:e?e.getLineJoin():"miter",dasharray:i||void 0,dashOffset:e?e.getLineDashOffset():void 0}}getFillSymbolizerFromOlStyle(t){const e=t.getFill(),i=t.getStroke(),r=i?i.getLineDash():void 0,s={kind:"Fill"};return e&&(s.color=g.getHexColor(e.getColor())),e&&(s.fillOpacity=g.getOpacity(e.getColor())),i&&(s.outlineColor=g.getHexColor(i.getColor())),r&&(s.outlineDasharray=r),i&&(s.outlineOpacity=g.getOpacity(i.getColor())),i&&i.getWidth()&&(s.outlineWidth=i.getWidth()),s}getTextSymbolizerFromOlStyle(t){const e=t.getText();if(!e)throw new Error("Could not get text from olStyle.");const i=e.getFill(),r=e.getStroke(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getFont(),l=e.getRotation(),c=e.getOverflow()?e.getOverflow():void 0,h=e.getPlacement(),f=e.getText(),u=Array.isArray(f)?f[0]:f;let d=1/0,m,_,S;if(a){const p=Ii(a);if(p["font-weight"]&&(_=p["font-weight"]),p["font-size"]&&(d=parseInt(p["font-size"],10)),p["font-family"]){const y=p["font-family"];m=y==null?void 0:y.map(x=>x.includes(" ")?'"'+x+'"':x)}p["font-style"]&&(S=p["font-style"])}return{kind:"Text",label:u,placement:h,allowOverlap:c,color:i?g.getHexColor(i.getColor()):void 0,size:isFinite(d)?d:void 0,font:m,fontWeight:_||void 0,fontStyle:S||void 0,offset:s!==void 0&&o!==void 0?[s,o]:[0,0],haloColor:r&&r.getColor()?g.getHexColor(r.getColor()):void 0,haloWidth:r?r.getWidth():void 0,rotate:l!==void 0?l/Math.PI*180:void 0}}getSymbolizersFromOlStyle(t){const e=[];return t.forEach(i=>{let r;switch(this.getStyleTypeFromOlStyle(i)){case"Point":i.getText()&&!g.getIsMarkSymbolizerFont(i.getText().getFont())?r=this.getTextSymbolizerFromOlStyle(i):r=this.getPointSymbolizerFromOlStyle(i);break;case"Line":r=this.getLineSymbolizerFromOlStyle(i);break;case"Fill":r=this.getFillSymbolizerFromOlStyle(i);break;default:throw new Error("Failed to parse SymbolizerKind from OpenLayers Style")}e.push(r)}),e}getRuleFromOlStyle(t){let e;const i="OL Style Rule 0";return Array.isArray(t)?e=this.getSymbolizersFromOlStyle(t):e=this.getSymbolizersFromOlStyle([t]),{name:i,symbolizers:e}}getStyleTypeFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleImageConstructor)e="Point";else if(t.getText()instanceof this.OlStyleTextConstructor)e="Point";else if(t.getFill()instanceof this.OlStyleFillConstructor)e="Fill";else if(t.getStroke()&&!t.getFill())e="Line";else throw new Error("StyleType could not be detected");return e}olStyleToGeoStylerStyle(t){const e="OL Style",i=this.getRuleFromOlStyle(t);return{name:e,rules:[i]}}readStyle(t){return new Promise(e=>{try{if(this.isOlParserStyleFct(t))e({output:t.__geoStylerStyle});else{t=t;const i=this.olStyleToGeoStylerStyle(t),r=this.checkForUnsupportedProperties(i);e({output:i,unsupportedProperties:r})}}catch(i){e({errors:[i]})}})}writeStyle(t){return new Promise(async e=>{const i=structuredClone(t),r=this.checkForUnsupportedProperties(i);try{const s=await this.getOlStyleTypeFromGeoStylerStyle(i);e({output:s,unsupportedProperties:r,warnings:r&&["Your style contains unsupportedProperties!"]})}catch(s){e({errors:[s]})}})}checkForUnsupportedProperties(t){const e=r=>r[0].toUpperCase()+r.slice(1),i={};if(t.rules.forEach(r=>{r.symbolizers.forEach(s=>{var l,c;const o=e(`${s.kind}Symbolizer`),a=(c=(l=this.unsupportedProperties)==null?void 0:l.Symbolizer)==null?void 0:c[o];a&&(typeof a=="string"?(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[o]=a):Object.keys(s).forEach(h=>{a[h]&&(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[o]||(i.Symbolizer[o]={}),i.Symbolizer[o][h]=a[h])}))})}),Object.keys(i).length>0)return i}async getOlStyleTypeFromGeoStylerStyle(t){var r,s,o,a,l,c,h,f;const e=t.rules;if(e.length===1){const u=((s=(r=t==null?void 0:t.rules)==null?void 0:r[0])==null?void 0:s.filter)!==void 0,d=((l=(a=(o=t==null?void 0:t.rules)==null?void 0:o[0])==null?void 0:a.scaleDenominator)==null?void 0:l.min)!==void 0,m=((f=(h=(c=t==null?void 0:t.rules)==null?void 0:c[0])==null?void 0:h.scaleDenominator)==null?void 0:f.max)!==void 0,_=!!(d||m),S=g.containsGeoStylerFunctions(t),p=t.rules[0].symbolizers.length,y=e[0].symbolizers.some(C=>C.kind==="Text"),x=e[0].symbolizers.some(C=>C.kind==="Icon"&&typeof C.image=="string"&&C.image.includes("{{"));return!u&&!_&&!y&&!x&&!S?p===1?await this.geoStylerStyleToOlStyle(t):await this.geoStylerStyleToOlStyleArray(t):await this.geoStylerStyleToOlParserStyleFct(t)}else return await this.geoStylerStyleToOlParserStyleFct(t)}async geoStylerStyleToOlStyle(t){const i=t.rules[0].symbolizers[0];return await this.getOlSymbolizerFromSymbolizer(i)}async geoStylerStyleToOlStyleArray(t){const e=t.rules[0],i=[];for(const r of e.symbolizers){const s=await this.getOlSymbolizerFromSymbolizer(r);i.push(s)}return i}async geoStylerStyleToOlParserStyleFct(t){const e=structuredClone(t.rules),r=async(s,o)=>{var u,d;const a=[],l=90.7142857142857,c=we.m,h=39.37,f=o*c*h*l;for(const m of e){let _=(u=m==null?void 0:m.scaleDenominator)==null?void 0:u.min,S=(d=m==null?void 0:m.scaleDenominator)==null?void 0:d.max,p=!0;(_||S)&&(_=O(_)?g.evaluateNumberFunction(_):_,S=O(S)?g.evaluateNumberFunction(S):S,_&&f<_&&(p=!1),S&&f>=S&&(p=!1));let y=!1;if(!m.filter)y=!0;else try{y=this.geoStylerFilterToOlParserFilter(s,m.filter)}catch{y=!1}if(p&&y)for(const x of m.symbolizers){x.visibility===!1&&a.push(null),et(x.visibility)&&(g.evaluateBooleanFunction(x.visibility)||a.push(null));const C=await this.getOlSymbolizerFromSymbolizer(x,s);if(typeof C!="function")a.push(C);else{const F=C(s,o);a.push(F)}}}return a};return r.__geoStylerStyle=t,r}geoStylerFilterToOlParserFilter(t,e){const i={"&&":!0,"||":!0,"!":!0};let r=!0;if(et(e))return g.evaluateBooleanFunction(e,t);if(e===!0||e===!1)return e;const s=e[0];let o=!1;i[s]&&(o=!0);try{if(o){let a,l;switch(e[0]){case"&&":a=!0,l=e.slice(1),l.forEach(c=>{this.geoStylerFilterToOlParserFilter(t,c)||(a=!1)}),r=a;break;case"||":a=!1,l=e.slice(1),l.forEach(c=>{this.geoStylerFilterToOlParserFilter(t,c)&&(a=!0)}),r=a;break;case"!":r=!this.geoStylerFilterToOlParserFilter(t,e[1]);break;default:throw new Error("Cannot parse Filter. Unknown combination or negation operator.")}}else{let a;O(e[1])?a=g.evaluateFunction(e[1],t):a=t.get(e[1]);let l;switch(O(e[2])?l=g.evaluateFunction(e[2],t):l=e[2],e[0]){case"==":r=""+a==""+l;break;case"*=":typeof l=="string"&&typeof a=="string"&&(l.length>a.length?r=!1:r=a.indexOf(l)!==-1);break;case"!=":r=""+a!=""+l;break;case"<":r=Number(a)<Number(l);break;case"<=":r=Number(a)<=Number(l);break;case">":r=Number(a)>Number(l);break;case">=":r=Number(a)>=Number(l);break;default:throw new Error("Cannot parse Filter. Unknown comparison operator.")}}}catch{throw new Error("Cannot parse Filter. Invalid structure.")}return r}async getOlSymbolizerFromSymbolizer(t,e){let i;switch(t=structuredClone(t),t.kind){case"Mark":i=await this.getOlPointSymbolizerFromMarkSymbolizer(t,e);break;case"Icon":i=await this.getOlIconSymbolizerFromIconSymbolizer(t,e);break;case"Text":i=this.getOlTextSymbolizerFromTextSymbolizer(t,e);break;case"Line":i=this.getOlLineSymbolizerFromLineSymbolizer(t,e);break;case"Fill":i=await this.getOlPolygonSymbolizerFromFillSymbolizer(t,e);break;default:const r=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),s=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});i=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:r,stroke:s,radius:5}),fill:r,stroke:s});break}return i}async getOlPointSymbolizerFromMarkSymbolizer(t,e){for(const u of Object.keys(t))O(t[u])&&(t[u]=g.evaluateFunction(t[u],e));const i=t.strokeColor,r=t.strokeOpacity,s=t.strokeWidth,o=t.color,a=t.fillOpacity,l=Number(t.rotate)*Math.PI/180,c=t.offset;let h,f=Cr(t.wellKnownName);if(Oi(f)){const u=((t==null?void 0:t.radius)??6)*2,d=t.opacity,m={dimensions:u,...o&&{fill:o},...g.checkOpacity(a)&&{fillOpacity:a},...i&&{stroke:i},...s&&{strokeWidth:s},...g.checkOpacity(r)&&{strokeOpacity:r}},_=vr(f,m);h=new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({src:g.getBase64EncodedSvg(_),crossOrigin:"anonymous",...c&&{displacement:c},...g.checkOpacity(d)&&{opacity:d},...l&&{rotation:l},scale:1})})}else if(g.getIsFontGlyphBased(t)){const u=i&&r?g.getRgbaColor(i,r):i,d=o&&a?g.getRgbaColor(o,a):o,m=new this.OlStyleStrokeConstructor({...u&&{color:u},...s&&{width:s}}),_=new this.OlStyleFillConstructor({...d&&{color:d}});h=new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:g.getCharacterForMarkSymbolizer(t),font:g.getTextFontForMarkSymbolizer(t),..._&&{fill:_},...c&&{offsetX:c[0]},...c&&{offsetY:c[1]},...m&&{stroke:m},...l&&{rotation:l}})})}else throw new Error("MarkSymbolizer cannot be parsed. Unsupported WellKnownName.");return h}async getOlIconSymbolizerFromIconSymbolizer(t,e){for(const l of Object.keys(t))O(t[l])&&(t[l]=g.evaluateFunction(t[l],e));const i={src:xt(t.image)?t.image.source:t.image,crossOrigin:"anonymous",opacity:t.opacity,width:t.size,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,displacement:t.offset,size:xt(t.image)?t.image.size:void 0,offset:xt(t.image)?t.image.position:void 0},r="\\{\\{",s="\\}\\}",o=new RegExp(r+".*?"+s,"g");return(typeof t.image=="string"?t.image.match(o):null)?c=>{let h=g.resolveAttributeTemplate(c,t.image,"");h||(h=t.image+"");let f;return this.olIconStyleCache[h]?(f=this.olIconStyleCache[h],i.rotation!==void 0&&f.setRotation(i.rotation),i.opacity!==void 0&&f.setOpacity(i.opacity)):(f=new this.OlStyleIconConstructor({...i,src:h}),this.olIconStyleCache[h]=f),new this.OlStyleConstructor({image:f})}:new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({...i})})}getOlLineSymbolizerFromLineSymbolizer(t,e){for(const o of Object.keys(t))O(t[o])&&(t[o]=g.evaluateFunction(t[o],e));const i=t.color,r=t.opacity,s=i&&r!==null&&r!==void 0?g.getRgbaColor(i,r):i;return new this.OlStyleConstructor({stroke:new this.OlStyleStrokeConstructor({color:s,width:t.width,lineCap:t.cap,lineJoin:t.join,lineDash:t.dasharray,lineDashOffset:t.dashOffset})})}async getOlPolygonSymbolizerFromFillSymbolizer(t,e){for(const u of Object.keys(t))O(t[u])&&(t[u]=g.evaluateFunction(t[u],e));const i=t.color,r=t.fillOpacity,s=i&&Number.isFinite(r)?g.getRgbaColor(i,r):i;let o=i?new this.OlStyleFillConstructor({color:s}):void 0;const a=t.outlineColor,l=t.outlineOpacity,c=a&&Number.isFinite(l)?g.getRgbaColor(a,l):a,h=a||t.outlineWidth?new this.OlStyleStrokeConstructor({color:c,width:t.outlineWidth,lineDash:t.outlineDasharray}):void 0,f=new this.OlStyleConstructor({fill:o,stroke:h});if(t.graphicFill){const u=this.getOlPatternFromGraphicFill(t.graphicFill);o||(o=new this.OlStyleFillConstructor({})),u&&o.setColor(await u),f.setFill(o)}return f}async getOlPatternFromGraphicFill(t){return new Promise(async(e,i)=>{let r,s=[16,16],o=1,a=1;if(Ai(t))r=await this.getOlIconSymbolizerFromIconSymbolizer(t),s=r.getSize();else if(Ei(t)){r=await this.getOlPointSymbolizerFromMarkSymbolizer(t);const y=g.getBase64DecodedSvg(r.getImage().getSrc()),{id:x,dimensions:C}=re(y);if(C)if(s=[C,C],xi.includes(String(x))){const F=r.getImage().getRotation();F/(Math.PI/2)%1!==0&&(a=Math.abs(Math.cos(F))+Math.abs(Math.sin(F)))}else o=2}else{i(new Error("Unrecognised graphicFill type"));return}const l=r.getImage(),c=s.map(y=>y*o),h=document.createElement("canvas");h.width=c[0],h.height=c[1];const f=h.getContext("2d"),u=Ir(f,{size:c,pixelRatio:1}),d=c.map(y=>y/2),m=new Ar(new Un(d)),_=new Image(s[0],s[1]);_.crossOrigin="anonymous",_.src=l.getSrc();const S=new Qe({crossOrigin:"anonymous",img:_,scale:a,size:s,rotation:l.getRotation()}),p=new Je({image:S});_.onload=()=>{S.load(),u.drawFeature(m,p);const y=f.createPattern(h,"repeat");if(!y){i(new Error("Failed to create pattern"));return}e(y)}})}getOlTextSymbolizerFromTextSymbolizer(t,e){for(const _ of Object.keys(t))O(t[_])&&(t[_]=g.evaluateFunction(t[_],e));const i=t.color;let r=t.placement;r||(r="point"),r==="line-center"&&(r="line");const s=t.opacity,o=i&&Number.isFinite(s)?g.getRgbaColor(i,s):i,a=t.haloColor,l=t.haloWidth,c=a&&Number.isFinite(s)?g.getRgbaColor(a,s):a,h={font:g.getTextFont(t),fill:new this.OlStyleFillConstructor({color:o}),stroke:new this.OlStyleStrokeConstructor({color:c,width:l||0}),overflow:t.allowOverlap,offsetX:t.offset?t.offset[0]:0,offsetY:t.offset?t.offset[1]:0,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,placement:r},f="\\{\\{",u="\\}\\}",d=new RegExp(f+".*?"+u,"g");let m;return V(t.label)||(m=t.label?t.label.match(d):null),m?S=>{const p=new this.OlStyleTextConstructor({text:g.resolveAttributeTemplate(S,t.label,""),...h});return new this.OlStyleConstructor({text:p})}:new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:t.label,...h})})}}return I(oe,"title","OpenLayers Style Parser"),A.OlStyleParser=oe,A.default=oe,Object.defineProperty(A,"__esModule",{value:!0}),A}({});
//# sourceMappingURL=olStyleParser.iife.js.map
