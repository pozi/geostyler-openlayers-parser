var GeoStylerOpenlayersParser=function(F){"use strict";var Ji=Object.defineProperty;var Ki=(F,I,E)=>I in F?Ji(F,I,{enumerable:!0,configurable:!0,writable:!0,value:E}):F[I]=E;var k=(F,I,E)=>(Ki(F,typeof I!="symbol"?I+"":I,E),E);function I(s){return!/^(-?\d|--)/.test(s)}function E(s){const t=[];let e="",i="",n=7;for(let r,a=0;r=s.charAt(a);a++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(r)&&n===7)e+=r;else if(r==="\\"&&n===7)n=6;else if(r===" "&&n===7){if(e!==""){if(!I(e))return null;t.push(e),e=""}}else if(n===6)/[0-9a-f]/i.test(r)?(i+=r,n=8):(e+=r,n=7);else{if(n!==8)return null;/[0-9a-f]/i.test(r)&&i.length<6?i+=r:(e+=String.fromCodePoint(parseInt(i,16)),e+=r,i="",n=7)}if(e!==""){if(!I(e))return null;t.push(e)}return t.join(" ")}function de(s,t){let e=t,i="";const n={"font-family":[]};for(let r,a=0;r=s.charAt(a);a+=1)if(e!==4||r!=='"'&&r!=="'")if(e===3&&r===",")e=4,i="";else if(e===4&&r===","){const o=E(i);o&&n["font-family"].push(o),i=""}else if(e===5&&r===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(i)?(n["font-style"]+=" "+i,i=""):a-=1,e=1;else if(e!==1||r!==" "&&r!=="/")e===2&&r===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(i)&&(n["line-height"]=i),e=4,i=""):i+=r;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(i)||/^(?:larg|small)er$/.test(i)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(i))e=r==="/"?2:4,n["font-size"]=i;else if(/^italic$/.test(i))n["font-style"]=i;else if(/^oblique$/.test(i))n["font-style"]=i,e=5;else if(/^small-caps$/.test(i))n["font-variant"]=i;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(i))n["font-weight"]=i;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(i)){const o=parseFloat(i);o>=1&&o<=1e3&&(n["font-weight"]=i)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(i)&&(n["font-stretch"]=i);i=""}else{let o=a+1;do if(o=s.indexOf(r,o)+1,!o)return null;while(s.charAt(o-2)==="\\");n["font-family"].push(s.slice(a+1,o-1).replace(/\\('|")/g,"$1")),a=o-1,e=3,i=""}if(e===3&&!/^\s*$/.test(i))return null;if(e===4){const r=E(i);r&&n["font-family"].push(r)}return n}function me(s){const t=de(s,1);return t!==null&&t["font-size"]&&t["font-family"].length?t:null}function _e(s){return s!=null&&typeof s.valueOf()=="string"}const pe=s=>(s==null?void 0:s.kind)==="Icon",ye=s=>(s==null?void 0:s.kind)==="Mark"&&_e(s==null?void 0:s.wellKnownName),it=s=>["abs","acos","add","asin","atan","atan2","ceil","cos","div","exp","floor","interpolate","log","max","min","modulo","mul","pi","pow","random","rint","round","sin","sqrt","strIndexOf","strLastIndexOf","strLength","sub","tan","toDegrees","toNumber","toRadians"].includes(s==null?void 0:s.name),z=s=>["numberFormat","strAbbreviate","strCapitalize","strConcat","strDefaultIfBlank","strReplace","strStripAccents","strSubstring","strSubstringStart","strToLowerCase","strToString","strToUpperCase","strTrim"].includes(s==null?void 0:s.name),B=s=>["all","any","between","double2bool","equalTo","greaterThan","greaterThanOrEqualTo","in","lessThan","lessThanOrEqualTo","not","notEqualTo","parseBoolean","strEndsWith","strEqualsIgnoreCase","strMatches","strStartsWith"].includes(s==null?void 0:s.name),bt=s=>["case","property","step"].includes(s==null?void 0:s.name),x=s=>B(s)||it(s)||z(s)||bt(s),nt=s=>typeof(s==null?void 0:s.source)=="string"||x(s==null?void 0:s.source)&&Array.isArray(s.position)&&Array.isArray(s.size);var C={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Se{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}var Ft=Se,we={PROPERTYCHANGE:"propertychange"};class xe{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}var ve=xe;function It(s,t){const e=s.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(s[i]!==t[i])return!1;return!0}function Tt(){}function Ce(s){let t=!1,e,i,n;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==n||!It(r,i))&&(t=!0,n=this,i=r,e=s.apply(this,arguments)),e}}function Et(s){for(const t in s)delete s[t]}function Oe(s){let t;for(t in s)return!1;return!t}class ke extends ve{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=e?new Ft(t):t;r.target||(r.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});i in a||(a[i]=0,o[i]=0),++a[i];let l;for(let c=0,f=n.length;c<f;++c)if("handleEvent"in n[c]?l=n[c].handleEvent(r):l=n[c].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--a[i]===0){let c=o[i];for(delete o[i];c--;)this.removeEventListener(i,Tt);delete a[i]}return l}disposeInternal(){this.listeners_&&Et(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const n=i.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=Tt,++this.pendingRemovals_[t]):(i.splice(n,1),i.length===0&&delete this.listeners_[t]))}}var Mt=ke,H={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function st(s,t,e,i,n){if(i&&i!==s&&(e=e.bind(i)),n){const a=e;e=function(){s.removeEventListener(t,e),a.apply(this,arguments)}}const r={target:s,type:t,listener:e};return s.addEventListener(t,e),r}function At(s,t,e,i){return st(s,t,e,i,!0)}function Rt(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),Et(s))}class $ extends Mt{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(H.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=st(this,t[r],e);return n}return st(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=At(this,t[r],e)}else i=At(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)be(i);else if(Array.isArray(t))for(let n=0,r=t.length;n<r;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}$.prototype.on,$.prototype.once,$.prototype.un;function be(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)Rt(s[t]);else Rt(s)}var Fe=$;function w(){throw new Error("Unimplemented abstract method.")}let Ie=0;function Dt(s){return s.ol_uid||(s.ol_uid=String(++Ie))}class Lt extends Ft{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class Te extends Fe{constructor(t){super(),this.on,this.once,this.un,Dt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new Lt(i,t,e)),i=we.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Lt(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const r=n[t];n[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Oe(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}var Pt=Te;const M=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";M.includes("firefox"),M.includes("safari")&&!M.includes("chrom")&&(M.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(M)),M.includes("webkit")&&M.includes("edge"),M.includes("macintosh");const Ee=typeof devicePixelRatio<"u"?devicePixelRatio:1,Me=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Ae=typeof Image<"u"&&Image.prototype.decode;(function(){let s=!1;try{const t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return s})();function rt(s,t){if(!s)throw new Error(t)}const Re=new Array(6);function at(){return[1,0,0,1,0,0]}function De(s,t){const e=s[0],i=s[1],n=s[2],r=s[3],a=s[4],o=s[5],l=t[0],c=t[1],f=t[2],u=t[3],h=t[4],d=t[5];return s[0]=e*l+n*c,s[1]=i*l+r*c,s[2]=e*f+n*u,s[3]=i*f+r*u,s[4]=e*h+n*d+a,s[5]=i*h+r*d+o,s}function Le(s,t,e,i,n,r,a){return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=a,s}function Pe(s,t,e){return De(s,Le(Re,t,0,0,e,0,0))}function Wt(s,t,e,i,n,r,a,o){const l=Math.sin(r),c=Math.cos(r);return s[0]=i*c,s[1]=n*l,s[2]=-i*l,s[3]=n*c,s[4]=a*i*c-o*i*l+t,s[5]=a*n*l+o*n*c+e,s}function We(s,t,e){return s[0]<=t&&t<=s[2]&&s[1]<=e&&e<=s[3]}function ze(){return[1/0,1/0,-1/0,-1/0]}function zt(s,t,e,i,n){return n?(n[0]=s,n[1]=t,n[2]=e,n[3]=i,n):[s,t,e,i]}function Gt(s){return zt(1/0,1/0,-1/0,-1/0,s)}function Ge(s,t){const e=s[0],i=s[1];return zt(e,i,e,i,t)}function Ne(s,t,e,i,n){const r=Gt(n);return qe(r,s,t,e,i)}function qe(s,t,e,i,n){for(;e<i;e+=n)Xe(s,t[e],t[e+1]);return s}function Xe(s,t,e){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}function Ye(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function Nt(s){return s[3]-s[1]}function G(s,t){return s[0]<=t[2]&&s[2]>=t[0]&&s[1]<=t[3]&&s[3]>=t[1]}function Be(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s}const qt={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class He{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||qt[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}var Xt=He;const N=6378137,D=Math.PI*N,$e=[-D,-D,D,D],Ve=[-180,-85,180,85],V=N*Math.log(Math.tan(Math.PI/2));class L extends Xt{constructor(t){super({code:t,units:"m",extent:$e,global:!0,worldExtent:Ve,getPointResolution:function(e,i){return e/Math.cosh(i[1]/N)}})}}const Yt=[new L("EPSG:3857"),new L("EPSG:102100"),new L("EPSG:102113"),new L("EPSG:900913"),new L("http://www.opengis.net/def/crs/EPSG/0/3857"),new L("http://www.opengis.net/gml/srs/epsg.xml#3857")];function je(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let n=0;n<i;n+=e){t[n]=D*s[n]/180;let r=N*Math.log(Math.tan(Math.PI*(+s[n+1]+90)/360));r>V?r=V:r<-V&&(r=-V),t[n+1]=r}return t}function Ue(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let n=0;n<i;n+=e)t[n]=180*s[n]/D,t[n+1]=360*Math.atan(Math.exp(s[n+1]/N))/Math.PI-90;return t}const Je=6378137,Bt=[-180,-90,180,90],Ke=Math.PI*Je/180;class R extends Xt{constructor(t,e){super({code:t,units:"degrees",extent:Bt,axisOrientation:e,global:!0,metersPerUnit:Ke,worldExtent:Bt})}}const Ht=[new R("CRS:84"),new R("EPSG:4326","neu"),new R("urn:ogc:def:crs:OGC:1.3:CRS84"),new R("urn:ogc:def:crs:OGC:2:84"),new R("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new R("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new R("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let ot={};function Ze(s){return ot[s]||ot[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Qe(s,t){ot[s]=t}let P={};function j(s,t,e){const i=s.getCode(),n=t.getCode();i in P||(P[i]={}),P[i][n]=e}function ti(s,t){let e;return s in P&&t in P[s]&&(e=P[s][t]),e}function U(s,t,e){return Math.min(Math.max(s,t),e)}function ei(s,t,e,i){const n=e-s,r=i-t;return n*n+r*r}function ii(s,t){const e=Math.pow(10,t);return Math.round(s*e)/e}function $t(s,t){if(t!==void 0){for(let e=0,i=s.length;e<i;++e)t[e]=s[e];t=t}else t=s.slice();return t}function ni(s,t){if(t!==void 0&&s!==t){for(let e=0,i=s.length;e<i;++e)t[e]=s[e];s=t}return s}function si(s){Qe(s.getCode(),s),j(s,s,$t)}function ri(s){s.forEach(si)}function lt(s){return typeof s=="string"?Ze(s):s||null}function Vt(s){ri(s),s.forEach(function(t){s.forEach(function(e){t!==e&&j(t,e,$t)})})}function ai(s,t,e,i){s.forEach(function(n){t.forEach(function(r){j(n,r,e),j(r,n,i)})})}function oi(s,t){const e=s.getCode(),i=t.getCode();let n=ti(e,i);return n||(n=ni),n}function jt(s,t){const e=lt(s),i=lt(t);return oi(e,i)}function li(){Vt(Yt),Vt(Ht),ai(Ht,Yt,je,Ue)}li();function q(s,t,e,i,n,r){r=r||[];let a=0;for(let o=t;o<e;o+=i){const l=s[o],c=s[o+1];r[a++]=n[0]*l+n[2]*c+n[4],r[a++]=n[1]*l+n[3]*c+n[5]}return r&&r.length!=a&&(r.length=a),r}function ci(s,t,e,i,n,r,a){a=a||[];const o=Math.cos(n),l=Math.sin(n),c=r[0],f=r[1];let u=0;for(let h=t;h<e;h+=i){const d=s[h]-c,_=s[h+1]-f;a[u++]=c+d*o-_*l,a[u++]=f+d*l+_*o;for(let m=h+2;m<h+i;++m)a[u++]=s[m]}return a&&a.length!=u&&(a.length=u),a}function hi(s,t,e,i,n,r,a,o){o=o||[];const l=a[0],c=a[1];let f=0;for(let u=t;u<e;u+=i){const h=s[u]-l,d=s[u+1]-c;o[f++]=l+n*h,o[f++]=c+r*d;for(let _=u+2;_<u+i;++_)o[f++]=s[_]}return o&&o.length!=f&&(o.length=f),o}function ui(s,t,e,i,n,r,a){a=a||[];let o=0;for(let l=t;l<e;l+=i){a[o++]=s[l]+n,a[o++]=s[l+1]+r;for(let c=l+2;c<l+i;++c)a[o++]=s[c]}return a&&a.length!=o&&(a.length=o),a}const Ut=at();class fi extends Pt{constructor(){super(),this.extent_=ze(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Ce((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return w()}closestPointXY(t,e,i,n){return w()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return w()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Gt(e),this.extentRevision_=this.getRevision()}return Be(this.extent_,t)}rotate(t,e){w()}scale(t,e,i){w()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return w()}getType(){return w()}applyTransform(t){w()}intersectsExtent(t){return w()}translate(t,e){w()}transform(t,e){const i=lt(t),n=i.getUnits()=="tile-pixels"?function(r,a,o){const l=i.getExtent(),c=i.getWorldExtent(),f=Nt(c)/Nt(l);return Wt(Ut,c[0],c[3],f,-f,0,0,0),q(r,0,r.length,o,Ut,a),jt(i,e)(r,a,o)}:jt(i,e);return this.applyTransform(n),this}}var gi=fi;class di extends gi{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Ne(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return w()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Jt(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){w()}setLayout(t,e,i){let n;if(t)n=Jt(t);else{for(let r=0;r<i;++r){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}n=e.length,t=mi(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();ci(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=Ye(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();hi(n,0,n.length,r,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();ui(i,0,i.length,n,t,e,i),this.changed()}}}function mi(s){let t;return s==2?t="XY":s==3?t="XYZ":s==4&&(t="XYZM"),t}function Jt(s){let t;return s=="XY"?t=2:s=="XYZ"||s=="XYM"?t=3:s=="XYZM"&&(t=4),t}function _i(s,t,e){const i=s.getFlatCoordinates();if(!i)return null;const n=s.getStride();return q(i,0,i.length,n,t,e)}var pi=di;function yi(s,t,e,i){for(let n=0,r=e.length;n<r;++n)s[t++]=e[n];return t}class ct extends pi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ct(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const r=this.flatCoordinates,a=ei(t,e,r[0],r[1]);if(a<n){const o=this.stride;for(let l=0;l<o;++l)i[l]=r[l];return i.length=o,a}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Ge(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return We(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=yi(this.flatCoordinates,0,t,this.stride),this.changed()}}var Si=ct;function J(s,t){return Array.isArray(s)?s:(t===void 0?t=[s,s]:(t[0]=s,t[1]=s),t)}class ht{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=J(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new ht({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return w()}getImage(t){return w()}getHitDetectionImage(){return w()}getPixelRatio(t){return 1}getImageState(){return w()}getImageSize(){return w()}getOrigin(){return w()}getSize(){return w()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=J(t)}listenImageChange(t){w()}load(){w()}unlistenImageChange(t){w()}}var ut=ht,K={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},O={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};O.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},O.max=O.whitepoint[2].D65,O.rgb=function(s,t){t=t||O.whitepoint[2].E;var e=s[0]/t[0],i=s[1]/t[1],n=s[2]/t[2],r,a,o;return r=e*3.240969941904521+i*-1.537383177570093+n*-.498610760293,a=e*-.96924363628087+i*1.87596750150772+n*.041555057407175,o=e*.055630079696993+i*-.20397695888897+n*1.056971514242878,r=r>.0031308?1.055*Math.pow(r,.4166666666666667)-.055:r=r*12.92,a=a>.0031308?1.055*Math.pow(a,.4166666666666667)-.055:a=a*12.92,o=o>.0031308?1.055*Math.pow(o,.4166666666666667)-.055:o=o*12.92,r=Math.min(Math.max(0,r),1),a=Math.min(Math.max(0,a),1),o=Math.min(Math.max(0,o),1),[r*255,a*255,o*255]},K.xyz=function(s,t){var e=s[0]/255,i=s[1]/255,n=s[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var r=e*.41239079926595+i*.35758433938387+n*.18048078840183,a=e*.21263900587151+i*.71516867876775+n*.072192315360733,o=e*.019330818715591+i*.11919477979462+n*.95053215224966;return t=t||O.whitepoint[2].E,[r*t[0],a*t[1],o*t[2]]};var Kt={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(s,t,e){var i,n,r,a,o,l,c,f,u,h,d,_,m;if(r=s[0],a=s[1],o=s[2],r===0)return[0,0,0];var p=.0011070564598794539;return t=t||"D65",e=e||2,u=O.whitepoint[e][t][0],h=O.whitepoint[e][t][1],d=O.whitepoint[e][t][2],_=4*u/(u+15*h+3*d),m=9*h/(u+15*h+3*d),i=a/(13*r)+_||0,n=o/(13*r)+m||0,c=r>8?h*Math.pow((r+16)/116,3):h*r*p,l=c*9*i/(4*n)||0,f=c*(12-3*i-20*n)/(4*n)||0,[l,c,f]}};O.luv=function(s,t,e){var i,n,r,a,o,l,c,f,u,h,d,_,m,p=.008856451679035631,y=903.2962962962961;t=t||"D65",e=e||2,u=O.whitepoint[e][t][0],h=O.whitepoint[e][t][1],d=O.whitepoint[e][t][2],_=4*u/(u+15*h+3*d),m=9*h/(u+15*h+3*d),l=s[0],c=s[1],f=s[2],i=4*l/(l+15*c+3*f)||0,n=9*c/(l+15*c+3*f)||0;var S=c/h;return r=S<=p?y*S:116*Math.pow(S,.3333333333333333)-16,a=13*r*(i-_),o=13*r*(n-m),[r,a,o]},Kt.lchuv=function(s){var t=s[0],e=s[1],i=s[2],n=Math.sqrt(e*e+i*i),r=Math.atan2(i,e),a=r*360/2/Math.PI;return a<0&&(a+=360),[t,n,a]},O.lchuv=function(s){return Kt.lchuv(O.luv(s))};var Zt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Qt={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function wi(s){var f,u;var t,e=[],i=1,n;if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(s=String(s).toLowerCase(),Zt[s])e=Zt[s].slice(),n="rgb";else if(s==="transparent")i=0,n="rgb",e=[0,0,0];else if(s[0]==="#"){var r=s.slice(1),a=r.length,o=a<=4;i=1,o?(e=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],a===4&&(i=parseInt(r[3]+r[3],16)/255)):(e=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],a===8&&(i=parseInt(r[6]+r[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),n="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(s)){var l=t[1];n=l.replace(/a$/,"");var c=n==="cmyk"?4:n==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),n==="color"&&(n=e.shift()),e=e.map(function(h,d){if(h[h.length-1]==="%")return h=parseFloat(h)/100,d===3?h:n==="rgb"?h*255:n[0]==="h"||n[0]==="l"&&!d?h*100:n==="lab"?h*125:n==="lch"?d<2?h*150:h*360:n[0]==="o"&&!d?h:n==="oklab"?h*.4:n==="oklch"?d<2?h*.4:h*360:h;if(n[d]==="h"||d===2&&n[n.length-1]==="h"){if(Qt[h]!==void 0)return Qt[h];if(h.endsWith("deg"))return parseFloat(h);if(h.endsWith("turn"))return parseFloat(h)*360;if(h.endsWith("grad"))return parseFloat(h)*360/400;if(h.endsWith("rad"))return parseFloat(h)*180/Math.PI}return h==="none"?0:parseFloat(h)}),i=e.length>c?e.pop():1}else/[0-9](?:\s|\/|,)/.test(s)&&(e=s.match(/([0-9]+)/g).map(function(h){return parseFloat(h)}),n=((u=(f=s.match(/([a-z])/ig))==null?void 0:f.join(""))==null?void 0:u.toLowerCase())||"rgb");return{space:n,values:e,alpha:i}}var ft={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(s){var t=s[0]/360,e=s[1]/100,i=s[2]/100,n,r,a,o,l,c=0;if(e===0)return l=i*255,[l,l,l];for(r=i<.5?i*(1+e):i+e-i*e,n=2*i-r,o=[0,0,0];c<3;)a=t+1/3*-(c-1),a<0?a++:a>1&&a--,l=6*a<1?n+(r-n)*6*a:2*a<1?r:3*a<2?n+(r-n)*(2/3-a)*6:n,o[c++]=l*255;return o}};K.hsl=function(s){var t=s[0]/255,e=s[1]/255,i=s[2]/255,n=Math.min(t,e,i),r=Math.max(t,e,i),a=r-n,o,l,c;return r===n?o=0:t===r?o=(e-i)/a:e===r?o=2+(i-t)/a:i===r&&(o=4+(t-e)/a),o=Math.min(o*60,360),o<0&&(o+=360),c=(n+r)/2,r===n?l=0:c<=.5?l=a/(r+n):l=a/(2-r-n),[o,l*100,c*100]};function xi(s){Array.isArray(s)&&s.raw&&(s=String.raw(...arguments)),s instanceof Number&&(s=+s);var t,e=wi(s);if(!e.space)return[];const i=e.space[0]==="h"?ft.min:K.min,n=e.space[0]==="h"?ft.max:K.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),n[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),n[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),n[2]),e.space[0]==="h"&&(t=ft.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function te(s){return typeof s=="string"?s:ie(s)}const vi=1024,X={};let gt=0;function Ci(s){if(X.hasOwnProperty(s))return X[s];if(gt>=vi){let e=0;for(const i in X)e++&3||(delete X[i],--gt)}const t=xi(s);if(t.length!==4)throw new Error('Failed to parse "'+s+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+s+'" as color');return Oi(t),X[s]=t,++gt,t}function ee(s){return Array.isArray(s)?s:Ci(s)}function Oi(s){return s[0]=U(s[0]+.5|0,0,255),s[1]=U(s[1]+.5|0,0,255),s[2]=U(s[2]+.5|0,0,255),s[3]=U(s[3],0,1),s}function ie(s){let t=s[0];t!=(t|0)&&(t=t+.5|0);let e=s[1];e!=(e|0)&&(e=e+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const n=s[3]===void 0?1:Math.round(s[3]*100)/100;return"rgba("+t+","+e+","+i+","+n+")"}function W(s){return Array.isArray(s)?ie(s):s}function Z(s,t,e,i){let n;return e&&e.length?n=e.shift():Me?n=new OffscreenCanvas(s||300,t||300):n=document.createElement("canvas"),s&&(n.width=s),t&&(n.height=t),n.getContext("2d",i)}const ki="10px sans-serif",Q="#000",tt="round",ne=[],se=0,et="round",dt=10,mt="#000",re="center",bi="middle",_t=1;new Pt;class pt extends ut{constructor(t){const e=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:1,rotateWithView:e,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.render()}clone(){const t=this.getScale(),e=new pt({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const i=this.renderOptions_,n=Z(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return C.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let n=this.radius_,r=this.radius2_===void 0?n:this.radius2_;if(n<r){const T=n;n=r,r=T}const a=this.radius2_===void 0?this.points_:this.points_*2,o=2*Math.PI/a,l=r*Math.sin(o),c=Math.sqrt(r*r-l*l),f=n-c,u=Math.sqrt(l*l+f*f),h=u/l;if(t==="miter"&&h<=i)return h*e;const d=e/2/h,_=e/2*(f/u),p=Math.sqrt((n+d)*(n+d)+_*_)-n;if(this.radius2_===void 0||t==="bevel")return p*2;const y=n*Math.sin(o),S=Math.sqrt(n*n-y*y),v=r-S,A=Math.sqrt(y*y+v*v)/y;if(A<=i){const T=A*e/2-r-n;return 2*Math.max(p,T)}return p*2}createRenderOptions(){let t=tt,e=et,i=0,n=null,r=0,a,o=0;this.stroke_&&(a=W(this.stroke_.getColor()??mt),o=this.stroke_.getWidth()??_t,n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??et,t=this.stroke_.getLineCap()??tt,i=this.stroke_.getMiterLimit()??dt);const l=this.calculateLineJoinSize_(e,o,i),c=Math.max(this.radius_,this.radius2_||0),f=Math.ceil(2*c+l);return{strokeStyle:a,strokeWidth:o,size:f,lineCap:t,lineDash:n,lineDashOffset:r,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();n===null&&(n=Q),e.fillStyle=W(n),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),n=0;typeof i=="string"&&(i=ee(i)),i===null?n=1:Array.isArray(i)&&(n=i.length===4?i[3]:1),n===0&&(e=Z(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,a=2*Math.PI/e;for(let o=0;o<e;o++){const l=r+o*a,c=o%2===0?i:n;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Q,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}var ae=pt;class yt extends ae{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new yt({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}var Fi=yt;class St{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new St({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}var oe=St;class wt{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new wt({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var Ii=wt;class xt{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=le,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new xt({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=le,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function le(s){return s.getGeometry()}var Ti=xt;const Ei="#333";class vt{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=J(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new oe({color:Ei}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new vt({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=J(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}var Mi=vt;function Ai(s,t){return new Promise((e,i)=>{function n(){a(),e(s)}function r(){a(),i(new Error("Image load error"))}function a(){s.removeEventListener("load",n),s.removeEventListener("error",r)}s.addEventListener("load",n),s.addEventListener("error",r),t&&(s.src=t)})}function Ri(s,t){return t&&(s.src=t),s.src&&Ae?new Promise((e,i)=>s.decode().then(()=>e(s)).catch(n=>s.complete&&s.width?e(s):i(n))):Ai(s)}class Di{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=ce(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const r=ce(t,e,i);this.cache_[r]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function ce(s,t,e){const i=e?te(e):"null";return t+":"+s+":"+i}const he=new Di;let Y=null;class Li extends Mt{constructor(t,e,i,n,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=n===void 0?C.IDLE:n,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===C.LOADED){Y||(Y=Z(1,1,void 0,{willReadFrequently:!0})),Y.drawImage(this.image_,0,0);try{Y.getImageData(0,0,1,1),this.tainted_=!1}catch{Y=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(H.CHANGE)}handleImageError_(){this.imageState_=C.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=C.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=Z(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===C.IDLE){this.image_||this.initializeImage_(),this.imageState_=C.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ri(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==C.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=te(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}}function Pi(s,t,e,i,n){let r=t===void 0?void 0:he.get(t,e,n);return r||(r=new Li(s,s instanceof HTMLImageElement?s.src||void 0:t,e,i,n),he.set(t,e,n,r)),r}function ue(s,t,e,i){return e!==void 0&&i!==void 0?[e/s,i/t]:e!==void 0?e/s:i!==void 0?i/t:1}class Ct extends ut{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,n=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:n,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const a=t.img!==void 0?t.img:null;let o=t.src;rt(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||Dt(a)),rt(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),rt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=C.IDLE:a!==void 0&&(a instanceof HTMLImageElement?a.complete?l=a.src?C.LOADED:C.IDLE:l=C.LOADING:l=C.LOADED),this.color_=t.color!==void 0?ee(t.color):null,this.iconImage_=Pi(a,o,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let c,f;if(t.size)[c,f]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)c=u.width,f=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const h=()=>{if(this.unlistenImageChange(h),!this.initialOptions_)return;const d=this.iconImage_.getSize();this.setScale(ue(d[0],d[1],t.width,t.height))};this.listenImageChange(h);return}}c!==void 0&&this.setScale(ue(c,f,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Ct({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=n[0]),this.anchorYUnits_=="fraction"&&(t[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==C.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==C.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(H.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(H.CHANGE,t)}}var Wi=Ct;const fe={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ot=/^ttf:\/\/(.+)#(.+)$/,ge="geostyler-mark-symbolizer";class g{static getRgbaColor(t,e){if(z(t)&&(t=g.evaluateStringFunction(t)),typeof t!="string")return;if(t.startsWith("rgba("))return t;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t))return;const n=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return it(e)&&(e=g.evaluateNumberFunction(e)),e<0&&(e=1),"rgba("+n+", "+r+", "+a+", "+e+")"}static splitRgbaColor(t){const e=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/),i=parseInt(e[0],10),n=parseInt(e[1],10),r=parseInt(e[2],10),a=parseFloat(e[3]);return[i,n,r,a]}static getHexColor(t){if(t.startsWith("#"))return t;if(t.startsWith("rgb")){const e=g.splitRgbaColor(t);return g.getHexCodeFromRgbArray(e)}else if(fe[t.toLocaleLowerCase()]!==void 0){const e=fe[t.toLocaleLowerCase()];return g.getHexCodeFromRgbArray(e)}else return}static getHexCodeFromRgbArray(t){return"#"+t.map((e,i)=>{const n=e.toString(16);return i<3?n.length===1?"0"+n:n:""}).join("")}static getOpacity(t){if(!t.startsWith("rgba("))return;const e=g.splitRgbaColor(t);if(e.length===4)return e[3]}static getTextFont(t){const e=t.fontWeight??"normal",i=t.fontStyle??"normal",n=t.size,r=t.font;return e+" "+i+" "+n+"px "+(r==null?void 0:r.join(", "))}static getIsFontGlyphBased(t){return Ot.test(t.wellKnownName)}static getIsMarkSymbolizerFont(t){if(!t)return!1;const e=ge;return t.substring(t.length-e.length,t.length)===e}static getTextFontForMarkSymbolizer(t){const e=t.wellKnownName.match(Ot);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);const i=e[1];return`Normal ${t.radius||5}px '${i}', ${ge}`}static getCharacterForMarkSymbolizer(t){const e=t.wellKnownName.match(Ot);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);return String.fromCharCode(parseInt(e[2],16))}static getFontNameFromOlFont(t){const e=t.match(/(?:\d+\S+) '?"?([^,'"]+)/);if(!e)throw new Error(`Could not find font family name in the following string: ${t}`);return e[1]}static getSizeFromOlFont(t){const e=t.match(/(?:(\d+)px)/);return e?parseInt(e[1],10):0}static resolveAttributeTemplate(t,e,i="n.v.",n=(r,a)=>a){let r="\\{\\{",a="\\}\\}",o=new RegExp(r+"(.*?)"+a,"g"),l=e.match(o);return l&&l.forEach(c=>{let f=0;for(let[u,h]of Object.entries(t.getProperties()))if(c.slice(2,c.length-2).toLowerCase()===u.toLowerCase()){e=e.replace(c,n(u,h));break}else f++;f===Object.keys(t.getProperties()).length&&(e=e.replace(c,i))}),e}static evaluateFunction(t,e){if(t.name==="property"){if(!e)throw new Error(`Could not evalute 'property' function. Feature ${e} is not defined.`);return z(t.args[0])?e==null?void 0:e.get(g.evaluateStringFunction(t.args[0],e)):e==null?void 0:e.get(t.args[0])}if(bt(t))return g.evaluateUnknownFunction(t,e);if(z(t))return g.evaluateStringFunction(t,e);if(it(t))return g.evaluateNumberFunction(t,e);if(B(t))return g.evaluateBooleanFunction(t,e)}static evaluateBooleanFunction(t,e){const i=t.args.map(n=>x(n)?g.evaluateFunction(n,e):n);switch(t.name){case"all":return i.map(a=>this.evaluateBooleanFunction(a,e)).every(a=>a===!0);case"any":return i.map(a=>this.evaluateBooleanFunction(a,e)).some(a=>a===!0);case"between":return i[0]>=i[1]&&i[0]<=i[2];case"double2bool":return!1;case"equalTo":return i[0]===i[1];case"greaterThan":return i[0]>i[1];case"greaterThanOrEqualTo":return i[0]>=i[1];case"in":return i.slice(1).includes(i[0]);case"lessThan":return i[0]<i[1];case"lessThanOrEqualTo":return i[0]<=i[1];case"not":return!i[0];case"notEqualTo":return i[0]!==i[1];case"parseBoolean":return!!i[0];case"strEndsWith":return i[0].endsWith(i[1]);case"strEqualsIgnoreCase":return i[0].toLowerCase()===i[1].toLowerCase();case"strMatches":const r=i[1].match(/\/(.*?)\/([gimy]{0,4})$/);return r&&r.length===3?new RegExp(r[1],r[2]).test(i[0]):!1;case"strStartsWith":return i[0].startsWith(i[1]);default:return!1}}static evaluateNumberFunction(t,e){if(t.name==="pi")return Math.PI;if(t.name==="random")return Math.random();const i=t.args.map(n=>x(n)?g.evaluateFunction(n,e):n);switch(t.name){case"abs":return Math.abs(i[0]);case"acos":return Math.acos(i[0]);case"add":return i[0]+i[1];case"asin":return Math.asin(i[0]);case"atan":return Math.atan(i[0]);case"atan2":return i[0];case"ceil":return Math.ceil(i[0]);case"cos":return Math.cos(i[0]);case"div":return i[0]/i[1];case"exp":return Math.exp(i[0]);case"floor":return Math.floor(i[0]);case"log":return Math.log(i[0]);case"max":return Math.max(...i);case"min":return Math.min(...i);case"modulo":return i[0]%i[1];case"mul":return i[0]*i[1];case"pow":return Math.pow(i[0],i[1]);case"rint":return i[0];case"round":return Math.round(i[0]);case"sin":return Math.sin(i[0]);case"sqrt":return Math.sqrt(i[0]);case"strIndexOf":return i[0].indexOf(i[1]);case"strLastIndexOf":return i[0].lastIndexOf(i[1]);case"strLength":return i[0].length;case"sub":return i[0]-i[1];case"tan":return Math.tan(i[0]);case"toDegrees":return i[0]*(180/Math.PI);case"toRadians":return i[0]*(Math.PI/180);default:return i[0]}}static evaluateUnknownFunction(t,e){const i=t.args.map(n=>x(n)?g.evaluateFunction(n,e):n);switch(t.name){case"property":return e==null?void 0:e.get(i[0]);case"case":const n=i;let r;for(let a=0;a<n.length;a++){const o=n[a];if(a===n.length-1){r=o;break}else if(o.case===!0){r=o.value;break}else if(g.evaluateBooleanFunction(o.case,e)){r=o.value;break}}return r;default:return i[0]}}static evaluateStringFunction(t,e){var r;const i=t.args.map(a=>x(a)?g.evaluateFunction(a,e):a);switch(t.name){case"numberFormat":return i[0];case"strAbbreviate":return i[0];case"strCapitalize":var n=i[0].toLowerCase().split(" ");for(let a of n)a=a.charAt(0).toUpperCase()+a.substring(1);return n.join(" ");case"strConcat":return i.join();case"strDefaultIfBlank":return((r=i[0])==null?void 0:r.length)<1?i[1]:i[0];case"strReplace":return i[3]===!0?i[0].replaceAll(i[1],i[2]):i[0].replace(i[1],i[2]);case"strStripAccents":return i[0].normalize("NFKD").replace(/[\u0300-\u036f]/g,"");case"strSubstring":return i[0].substring(i[1],i[2]);case"strSubstringStart":return i[0].substring(i[1]);case"strToLowerCase":return i[0].toLowerCase();case"strToUpperCase":return i[0].toUpperCase();case"strTrim":return i[0].trim();default:return i[0]}}static containsGeoStylerFunctions(t){return t.rules.some(e=>{var a,o,l,c;const i=Array.isArray(e.filter)&&((a=e.filter)==null?void 0:a.some(x)),n=(o=e.symbolizers)==null?void 0:o.some(f=>Object.values(f).some(x)),r=x((l=e==null?void 0:e.scaleDenominator)==null?void 0:l.max)||x((c=e==null?void 0:e.scaleDenominator)==null?void 0:c.min);return i||n||r})}}class zi{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}var Gi=zi;class Ni extends Gi{constructor(t,e,i,n,r,a,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.transformRotation_=n?ii(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=a,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=at()}drawImages_(t,e,i,n){if(!this.image_)return;const r=q(t,e,i,n,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,l=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let f=0,u=r.length;f<u;f+=2){const h=r[f]-this.imageAnchorX_,d=r[f+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const _=h+this.imageAnchorX_,m=d+this.imageAnchorY_;Wt(o,_,m,1,1,c,-_,-m),a.save(),a.transform.apply(a,o),a.translate(_,m),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,h,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=l)}drawText_(t,e,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=q(t,e,i,n,this.transform_,this.pixelCoordinates_),a=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=n){const l=r[e]+this.textOffsetX_,c=r[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(l-this.textOffsetX_,c-this.textOffsetY_),a.rotate(o),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,l,c),this.textFillState_&&a.fillText(this.text_,l,c))}}moveToLineTo_(t,e,i,n,r){const a=this.context_,o=q(t,e,i,n,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);let l=o.length;r&&(l-=2);for(let c=2;c<l;c+=2)a.lineTo(o[c],o[c+1]);return r&&a.closePath(),i}drawRings_(t,e,i,n){for(let r=0,a=i.length;r<a;++r)e=this.moveToLineTo_(t,e,i[r],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!G(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=_i(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(i*i+n*n),a=this.context_;a.beginPath(),a.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!G(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(G(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let r=0;const a=t.getEnds(),o=t.getStride();i.beginPath();for(let l=0,c=a.length;l<c;++l)r=this.moveToLineTo_(n,r,a[l],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!G(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!G(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const r=t.getEndss(),a=t.getStride();e.beginPath();for(let o=0,l=r.length;o<l;++o){const c=r[o];n=this.drawRings_(i,n,c,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),It(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:re;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:W(i||Q)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),n=e.getLineCap(),r=e.getLineDash(),a=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),f=r||ne;this.strokeState_={lineCap:n!==void 0?n:tt,lineDash:this.pixelRatio_===1?f:f.map(u=>u*this.pixelRatio_),lineDashOffset:(a||se)*this.pixelRatio_,lineJoin:o!==void 0?o:et,lineWidth:(l!==void 0?l:_t)*this.pixelRatio_,miterLimit:c!==void 0?c:dt,strokeStyle:W(i||mt)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/i,a[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const d=e.getColor();this.textFillState_={fillStyle:W(d||Q)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const d=i.getColor(),_=i.getLineCap(),m=i.getLineDash(),p=i.getLineDashOffset(),y=i.getLineJoin(),S=i.getWidth(),v=i.getMiterLimit();this.textStrokeState_={lineCap:_!==void 0?_:tt,lineDash:m||ne,lineDashOffset:p||se,lineJoin:y!==void 0?y:et,lineWidth:S!==void 0?S:_t,miterLimit:v!==void 0?v:dt,strokeStyle:W(d||mt)}}const n=t.getFont(),r=t.getOffsetX(),a=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),f=t.getText(),u=t.getTextAlign(),h=t.getTextBaseline();this.textState_={font:n!==void 0?n:ki,textAlign:u!==void 0?u:re,textBaseline:h!==void 0?h:bi},this.text_=f!==void 0?Array.isArray(f)?f.reduce((d,_,m)=>d+=m%2?" ":_,""):f:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}var qi=Ni;function Xi(s,t){const e=s.canvas;t=t||{};const i=t.pixelRatio||Ee,n=t.size;n&&(e.width=n[0]*i,e.height=n[1]*i,e.style.width=n[0]+"px",e.style.height=n[1]+"px");const r=[0,0,e.width,e.height],a=Pe(at(),i,i);return new qi(s,i,r,a,0)}class kt{constructor(t){k(this,"unsupportedProperties",{Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none"},FillSymbolizer:{antialias:"none",opacity:{support:"none",info:"Use fillOpacity instead."}},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none",TextSymbolizer:{anchor:"none",placement:{support:"partial",info:"point and line supported. line-center will be mapped to line."}}},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}});k(this,"title","OpenLayers Style Parser");k(this,"olIconStyleCache",{});k(this,"OlStyleConstructor",Ti);k(this,"OlStyleImageConstructor",ut);k(this,"OlStyleFillConstructor",oe);k(this,"OlStyleStrokeConstructor",Ii);k(this,"OlStyleTextConstructor",Mi);k(this,"OlStyleCircleConstructor",Fi);k(this,"OlStyleIconConstructor",Wi);k(this,"OlStyleRegularshapeConstructor",ae);k(this,"isOlParserStyleFct",t=>typeof t=="function");t&&(this.OlStyleConstructor=t.style.Style,this.OlStyleImageConstructor=t.style.Image,this.OlStyleFillConstructor=t.style.Fill,this.OlStyleStrokeConstructor=t.style.Stroke,this.OlStyleTextConstructor=t.style.Text,this.OlStyleCircleConstructor=t.style.Circle,this.OlStyleIconConstructor=t.style.Icon,this.OlStyleRegularshapeConstructor=t.style.RegularShape)}getPointSymbolizerFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleCircleConstructor){const i=t.getImage(),n=i.getFill(),r=i.getStroke(),a=i.getDisplacement();e={kind:"Mark",wellKnownName:"circle",color:n?g.getHexColor(n.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:n?g.getOpacity(n.getColor()):void 0,radius:i.getRadius()!==0?i.getRadius():5,strokeColor:r?r.getColor():void 0,strokeOpacity:r?g.getOpacity(r.getColor()):void 0,strokeWidth:r?r.getWidth():void 0,offset:a[0]||a[1]?a:void 0}}else if(t.getImage()instanceof this.OlStyleRegularshapeConstructor){const i=t.getImage(),n=i.getFill(),r=i.getStroke(),a=i.getRadius(),o=i.getRadius2(),l=i.getPoints(),c=i.getAngle(),f=i.getDisplacement(),u={kind:"Mark",color:n?g.getHexColor(n.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:n?g.getOpacity(n.getColor()):void 0,strokeColor:r?r.getColor():void 0,strokeOpacity:r?g.getOpacity(r.getColor()):void 0,strokeWidth:r?r.getWidth():void 0,radius:a!==0?a:5,rotate:i.getRotation()/Math.PI*180,offset:f[0]||f[1]?f:void 0};switch(l){case 2:switch(c){case 0:u.wellKnownName="shape://vertline";break;case Math.PI/2:u.wellKnownName="shape://horline";break;case Math.PI/4:u.wellKnownName="shape://slash";break;case 2*Math.PI-Math.PI/4:u.wellKnownName="shape://backslash";break}break;case 3:switch(c){case 0:u.wellKnownName="triangle";break;case Math.PI/2:u.wellKnownName="shape://carrow";break}break;case 4:Number.isFinite(o)?i.getAngle()===0?u.wellKnownName="cross":u.wellKnownName="x":u.wellKnownName="square";break;case 5:u.wellKnownName="star";break;default:throw new Error("Could not parse OlStyle. Only 2, 3, 4 or 5 point regular shapes are allowed")}e=u}else if(t.getText()instanceof this.OlStyleTextConstructor){const i=t.getText(),n=i.getFill(),r=i.getStroke(),a=i.getRotation();let o=i.getText()||"a";const l=i.getFont()||"10px sans-serif",c=g.getFontNameFromOlFont(l),f=g.getSizeFromOlFont(l),u=[i.getOffsetX(),i.getOffsetY()];Array.isArray(o)&&(o=o[0]),e={kind:"Mark",wellKnownName:`ttf://${c}#0x${o.charCodeAt(0).toString(16)}`,color:n?g.getHexColor(n.getColor()):void 0,opacity:n?g.getOpacity(n.getColor()):void 0,strokeColor:r?r.getColor():void 0,strokeOpacity:r?g.getOpacity(r.getColor()):void 0,strokeWidth:r?r.getWidth():void 0,radius:f!==0?f:5,rotate:a?a/Math.PI*180:0,offset:u[0]||u[1]?u:void 0}}else{const i=t.getImage(),n=i.getDisplacement(),r=this.getImageFromIconStyle(i);let a=i.getWidth();const o=i.getRotation()/Math.PI*180,l=i.getOpacity();e={kind:"Icon",image:r,opacity:l<1?l:void 0,size:a,rotate:o!==0?o:void 0,offset:n[0]||n[1]?n:void 0}}return e}getImageFromIconStyle(t){const e=t.getSize();if(Array.isArray(e)){let i=t.offset_;const n=t.offsetOrigin_;if(n&&n!=="top-left")throw new Error(`Offset origin ${n} not supported`);return{source:t.getSrc(),position:i,size:e}}else return t.getSrc()?t.getSrc():void 0}getLineSymbolizerFromOlStyle(t){const e=t.getStroke(),i=e?e.getLineDash():void 0;return{kind:"Line",color:e?g.getHexColor(e.getColor()):void 0,opacity:e?g.getOpacity(e.getColor()):void 0,width:e?e.getWidth():void 0,cap:e?e.getLineCap():"butt",join:e?e.getLineJoin():"miter",dasharray:i||void 0,dashOffset:e?e.getLineDashOffset():void 0}}getFillSymbolizerFromOlStyle(t){const e=t.getFill(),i=t.getStroke(),n=i?i.getLineDash():void 0,r={kind:"Fill"};return e&&(r.color=g.getHexColor(e.getColor())),e&&(r.fillOpacity=g.getOpacity(e.getColor())),i&&(r.outlineColor=g.getHexColor(i.getColor())),n&&(r.outlineDasharray=n),i&&(r.outlineOpacity=g.getOpacity(i.getColor())),i&&i.getWidth()&&(r.outlineWidth=i.getWidth()),r}getTextSymbolizerFromOlStyle(t){const e=t.getText();if(!e)throw new Error("Could not get text from olStyle.");const i=e.getFill(),n=e.getStroke(),r=e.getOffsetX(),a=e.getOffsetY(),o=e.getFont(),l=e.getRotation(),c=e.getOverflow()?e.getOverflow():void 0,f=e.getPlacement(),u=e.getText(),h=Array.isArray(u)?u[0]:u;let d=1/0,_,m,p;if(o){const y=me(o);if(y["font-weight"]&&(m=y["font-weight"]),y["font-size"]&&(d=parseInt(y["font-size"],10)),y["font-family"]){const S=y["font-family"];_=S==null?void 0:S.map(v=>v.includes(" ")?'"'+v+'"':v)}y["font-style"]&&(p=y["font-style"])}return{kind:"Text",label:h,placement:f,allowOverlap:c,color:i?g.getHexColor(i.getColor()):void 0,size:isFinite(d)?d:void 0,font:_,fontWeight:m||void 0,fontStyle:p||void 0,offset:r!==void 0&&a!==void 0?[r,a]:[0,0],haloColor:n&&n.getColor()?g.getHexColor(n.getColor()):void 0,haloWidth:n?n.getWidth():void 0,rotate:l!==void 0?l/Math.PI*180:void 0}}getSymbolizersFromOlStyle(t){const e=[];return t.forEach(i=>{let n;switch(this.getStyleTypeFromOlStyle(i)){case"Point":i.getText()&&!g.getIsMarkSymbolizerFont(i.getText().getFont())?n=this.getTextSymbolizerFromOlStyle(i):n=this.getPointSymbolizerFromOlStyle(i);break;case"Line":n=this.getLineSymbolizerFromOlStyle(i);break;case"Fill":n=this.getFillSymbolizerFromOlStyle(i);break;default:throw new Error("Failed to parse SymbolizerKind from OpenLayers Style")}e.push(n)}),e}getRuleFromOlStyle(t){let e;const i="OL Style Rule 0";return Array.isArray(t)?e=this.getSymbolizersFromOlStyle(t):e=this.getSymbolizersFromOlStyle([t]),{name:i,symbolizers:e}}getStyleTypeFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleImageConstructor)e="Point";else if(t.getText()instanceof this.OlStyleTextConstructor)e="Point";else if(t.getFill()instanceof this.OlStyleFillConstructor)e="Fill";else if(t.getStroke()&&!t.getFill())e="Line";else throw new Error("StyleType could not be detected");return e}olStyleToGeoStylerStyle(t){const e="OL Style",i=this.getRuleFromOlStyle(t);return{name:e,rules:[i]}}readStyle(t){return new Promise(e=>{try{if(this.isOlParserStyleFct(t))e({output:t.__geoStylerStyle});else{t=t;const i=this.olStyleToGeoStylerStyle(t),n=this.checkForUnsupportedProperties(i);e({output:i,unsupportedProperties:n})}}catch(i){e({errors:[i]})}})}writeStyle(t){return new Promise(e=>{const i=structuredClone(t),n=this.checkForUnsupportedProperties(i);try{const r=this.getOlStyleTypeFromGeoStylerStyle(i);e({output:r,unsupportedProperties:n,warnings:n&&["Your style contains unsupportedProperties!"]})}catch(r){e({errors:[r]})}})}checkForUnsupportedProperties(t){const e=n=>n[0].toUpperCase()+n.slice(1),i={};if(t.rules.forEach(n=>{n.symbolizers.forEach(r=>{var l,c;const a=e(`${r.kind}Symbolizer`),o=(c=(l=this.unsupportedProperties)==null?void 0:l.Symbolizer)==null?void 0:c[a];o&&(typeof o=="string"?(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[a]=o):Object.keys(r).forEach(f=>{o[f]&&(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[a]||(i.Symbolizer[a]={}),i.Symbolizer[a][f]=o[f])}))})}),Object.keys(i).length>0)return i}getOlStyleTypeFromGeoStylerStyle(t){var n,r,a,o,l,c,f,u;const e=t.rules;if(e.length===1){const h=((r=(n=t==null?void 0:t.rules)==null?void 0:n[0])==null?void 0:r.filter)!==void 0,d=((l=(o=(a=t==null?void 0:t.rules)==null?void 0:a[0])==null?void 0:o.scaleDenominator)==null?void 0:l.min)!==void 0,_=((u=(f=(c=t==null?void 0:t.rules)==null?void 0:c[0])==null?void 0:f.scaleDenominator)==null?void 0:u.max)!==void 0,m=!!(d||_),p=g.containsGeoStylerFunctions(t),y=t.rules[0].symbolizers.length,S=e[0].symbolizers.some(b=>b.kind==="Text"),v=e[0].symbolizers.some(b=>b.kind==="Icon"&&typeof b.image=="string"&&b.image.includes("{{"));return!h&&!m&&!S&&!v&&!p?y===1?this.geoStylerStyleToOlStyle(t):this.geoStylerStyleToOlStyleArray(t):this.geoStylerStyleToOlParserStyleFct(t)}else return this.geoStylerStyleToOlParserStyleFct(t)}geoStylerStyleToOlStyle(t){const i=t.rules[0].symbolizers[0];return this.getOlSymbolizerFromSymbolizer(i)}geoStylerStyleToOlStyleArray(t){const e=t.rules[0],i=[];return e.symbolizers.forEach(n=>{const r=this.getOlSymbolizerFromSymbolizer(n);i.push(r)}),i}geoStylerStyleToOlParserStyleFct(t){const e=structuredClone(t.rules),n=(r,a)=>{const o=[],l=90.7142857142857,c=qt.m,f=39.37,u=a*c*f*l;return e.forEach(h=>{var y,S;let d=(y=h==null?void 0:h.scaleDenominator)==null?void 0:y.min,_=(S=h==null?void 0:h.scaleDenominator)==null?void 0:S.max,m=!0;(d||_)&&(d=x(d)?g.evaluateNumberFunction(d):d,_=x(_)?g.evaluateNumberFunction(_):_,d&&u<d&&(m=!1),_&&u>=_&&(m=!1));let p=!1;if(!h.filter)p=!0;else try{p=this.geoStylerFilterToOlParserFilter(r,h.filter)}catch{p=!1}m&&p&&h.symbolizers.forEach(v=>{v.visibility===!1&&o.push(null),B(v.visibility)&&(g.evaluateBooleanFunction(v.visibility)||o.push(null));const b=this.getOlSymbolizerFromSymbolizer(v,r);if(typeof b!="function")o.push(b);else{const A=b(r,a);o.push(A)}})}),o};return n.__geoStylerStyle=t,n}geoStylerFilterToOlParserFilter(t,e){const i={"&&":!0,"||":!0,"!":!0};let n=!0;if(B(e))return g.evaluateBooleanFunction(e,t);if(e===!0||e===!1)return e;const r=e[0];let a=!1;i[r]&&(a=!0);try{if(a){let o,l;switch(e[0]){case"&&":o=!0,l=e.slice(1),l.forEach(c=>{this.geoStylerFilterToOlParserFilter(t,c)||(o=!1)}),n=o;break;case"||":o=!1,l=e.slice(1),l.forEach(c=>{this.geoStylerFilterToOlParserFilter(t,c)&&(o=!0)}),n=o;break;case"!":n=!this.geoStylerFilterToOlParserFilter(t,e[1]);break;default:throw new Error("Cannot parse Filter. Unknown combination or negation operator.")}}else{let o;x(e[1])?o=g.evaluateFunction(e[1],t):o=t.get(e[1]);let l;switch(x(e[2])?l=g.evaluateFunction(e[2],t):l=e[2],e[0]){case"==":n=""+o==""+l;break;case"*=":typeof l=="string"&&typeof o=="string"&&(l.length>o.length?n=!1:n=o.indexOf(l)!==-1);break;case"!=":n=""+o!=""+l;break;case"<":n=Number(o)<Number(l);break;case"<=":n=Number(o)<=Number(l);break;case">":n=Number(o)>Number(l);break;case">=":n=Number(o)>=Number(l);break;default:throw new Error("Cannot parse Filter. Unknown comparison operator.")}}}catch{throw new Error("Cannot parse Filter. Invalid structure.")}return n}getOlSymbolizerFromSymbolizer(t,e){let i;switch(t=structuredClone(t),t.kind){case"Mark":i=this.getOlPointSymbolizerFromMarkSymbolizer(t,e);break;case"Icon":i=this.getOlIconSymbolizerFromIconSymbolizer(t,e);break;case"Text":i=this.getOlTextSymbolizerFromTextSymbolizer(t,e);break;case"Line":i=this.getOlLineSymbolizerFromLineSymbolizer(t,e);break;case"Fill":i=this.getOlPolygonSymbolizerFromFillSymbolizer(t,e);break;default:const n=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),r=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});i=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:n,stroke:r,radius:5}),fill:n,stroke:r});break}return i}getOlPointSymbolizerFromMarkSymbolizer(t,e){let i;for(const S of Object.keys(t))x(t[S])&&(t[S]=g.evaluateFunction(t[S],e));const n=t.strokeColor,r=t.strokeOpacity,a=t.strokeWidth===void 0?1:t.strokeWidth,o=n&&r!==void 0?g.getRgbaColor(n,r):t.strokeColor;(t.strokeColor||t.strokeWidth!==void 0)&&(i=new this.OlStyleStrokeConstructor({color:o,width:t.strokeWidth}));const l=t.color,c=t.opacity,f=t.radius,u=((t==null?void 0:t.radius)??8)*2,h=t.fillOpacity,d=l&&h!==void 0?g.getRgbaColor(l,h??1):l,_=new this.OlStyleFillConstructor({color:d});let m;const p={fill:_,radius:f??5,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,stroke:i,displacement:Array.isArray(t.offset)?t.offset.map(Number):void 0};let y=t.wellKnownName;switch(y=y==="shape://dot"?"circle":y,y=y==="shape://plus"?"cross":y,y){case"arrow":case"arrowhead":case"asterisk_fill":case"circle":case"cross":case"cross2":case"cross_fill":case"decagon":case"diagonal_half_square":case"diamond":case"equilateral_triangle":case"filled_arrowhead":case"half_arc":case"half_square":case"heart":case"hexagon":case"left_half_triangle":case"line":case"octagon":case"parallelogram_left":case"parallelogram_right":case"pentagon":case"quarter_arc":case"quarter_circle":case"quarter_square":case"right_half_triangle":case"rounded_square":case"semi_circle":case"shield":case"square":case"square_with_corners":case"star":case"star_diamond":case"third_arc":case"third_circle":case"trapezoid":case"triangle":Promise.resolve().then(function(){return Bi}).then(S=>{const A=new DOMParser().parseFromString(S.default,"image/svg+xml").documentElement,T=($i,Vi,ji)=>{A.querySelectorAll($i).forEach(Ui=>Ui.setAttribute(Vi,ji))};T("[fill]","fill",String(d)),T("[stroke]","stroke",String(o)),T("[stroke-width]","stroke-width",String(a)),T("[width]","width",String(u)),T("[height]","height",String(u));const Hi=new XMLSerializer().serializeToString(A);m=new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({src:`data:image/svg+xml;base64,${btoa(Hi)}`,scale:1})})}).catch(()=>{throw new Error(`No SVG for WellKnownName (${y}.)`)});break;case"shape://times":case"x":p.stroke===void 0&&(p.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),m=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...p,points:4,radius2:0,angle:45*Math.PI/180})});break;case"shape://backslash":p.stroke===void 0&&(p.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),m=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...p,points:2,angle:2*Math.PI-Math.PI/4})});break;case"shape://horline":p.stroke===void 0&&(p.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),m=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...p,points:2,angle:Math.PI/2})});break;case"shape://oarrow":case"shape://carrow":m=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...p,points:3,angle:Math.PI/2})});break;case"shape://slash":p.stroke===void 0&&(p.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),m=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...p,points:2,angle:Math.PI/4})});break;case"shape://vertline":p.stroke===void 0&&(p.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),m=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...p,points:2,angle:0})});break;default:if(g.getIsFontGlyphBased(t)){m=new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:g.getCharacterForMarkSymbolizer(t),font:g.getTextFontForMarkSymbolizer(t),fill:p.fill,stroke:p.stroke,rotation:p.rotation})});break}throw new Error("MarkSymbolizer cannot be parsed. Unsupported WellKnownName.")}return Number.isFinite(c)&&m.getImage()&&m.getImage().setOpacity(c),m}getOlIconSymbolizerFromIconSymbolizer(t,e){for(const l of Object.keys(t))x(t[l])&&(t[l]=g.evaluateFunction(t[l],e));const i={src:nt(t.image)?t.image.source:t.image,crossOrigin:"anonymous",opacity:t.opacity,width:t.size,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,displacement:t.offset,size:nt(t.image)?t.image.size:void 0,offset:nt(t.image)?t.image.position:void 0},n="\\{\\{",r="\\}\\}",a=new RegExp(n+".*?"+r,"g");return(typeof t.image=="string"?t.image.match(a):null)?c=>{let f=g.resolveAttributeTemplate(c,t.image,"");f||(f=t.image+"");let u;return this.olIconStyleCache[f]?(u=this.olIconStyleCache[f],i.rotation!==void 0&&u.setRotation(i.rotation),i.opacity!==void 0&&u.setOpacity(i.opacity)):(u=new this.OlStyleIconConstructor({...i,src:f}),this.olIconStyleCache[f]=u),new this.OlStyleConstructor({image:u})}:new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({...i})})}getOlLineSymbolizerFromLineSymbolizer(t,e){for(const a of Object.keys(t))x(t[a])&&(t[a]=g.evaluateFunction(t[a],e));const i=t.color,n=t.opacity,r=i&&n!==null&&n!==void 0?g.getRgbaColor(i,n):i;return new this.OlStyleConstructor({stroke:new this.OlStyleStrokeConstructor({color:r,width:t.width,lineCap:t.cap,lineJoin:t.join,lineDash:t.dasharray,lineDashOffset:t.dashOffset})})}getOlPolygonSymbolizerFromFillSymbolizer(t,e){for(const h of Object.keys(t))x(t[h])&&(t[h]=g.evaluateFunction(t[h],e));const i=t.color,n=t.fillOpacity,r=i&&Number.isFinite(n)?g.getRgbaColor(i,n):i;let a=i?new this.OlStyleFillConstructor({color:r}):void 0;const o=t.outlineColor,l=t.outlineOpacity,c=o&&Number.isFinite(l)?g.getRgbaColor(o,l):o,f=o||t.outlineWidth?new this.OlStyleStrokeConstructor({color:c,width:t.outlineWidth,lineDash:t.outlineDasharray}):void 0,u=new this.OlStyleConstructor({fill:a,stroke:f});if(t.graphicFill){const h=this.getOlPatternFromGraphicFill(t.graphicFill);a||(a=new this.OlStyleFillConstructor({})),h&&a.setColor(h),u.setFill(a)}return u}getOlPatternFromGraphicFill(t){let e;if(pe(t)){e=this.getOlIconSymbolizerFromIconSymbolizer(t);const h=e==null?void 0:e.getImage();if(h==null||h.load(),(h==null?void 0:h.getImageState())!==C.LOADED)return null}else if(ye(t))e=this.getOlPointSymbolizerFromMarkSymbolizer(t);else return null;const i=e.clone(),n=i.getImage(),r=document.createElement("canvas"),a=r.getContext("2d"),l=n.getScale()||1;n.setScale(1);const c=n.getSize(),f=Xi(a,{pixelRatio:l,size:c});f.setStyle(i);const u=c.map(h=>h/2);return f.drawGeometry(new Si(u)),a.createPattern(r,"repeat")}getOlTextSymbolizerFromTextSymbolizer(t,e){for(const m of Object.keys(t))x(t[m])&&(t[m]=g.evaluateFunction(t[m],e));const i=t.color;let n=t.placement;n||(n="point"),n==="line-center"&&(n="line");const r=t.opacity,a=i&&Number.isFinite(r)?g.getRgbaColor(i,r):i,o=t.haloColor,l=t.haloWidth,c=o&&Number.isFinite(r)?g.getRgbaColor(o,r):o,f={font:g.getTextFont(t),fill:new this.OlStyleFillConstructor({color:a}),stroke:new this.OlStyleStrokeConstructor({color:c,width:l||0}),overflow:t.allowOverlap,offsetX:t.offset?t.offset[0]:0,offsetY:t.offset?t.offset[1]:0,rotation:typeof t.rotate=="number"?t.rotate*Math.PI/180:void 0,placement:n},u="\\{\\{",h="\\}\\}",d=new RegExp(u+".*?"+h,"g");let _;return z(t.label)||(_=t.label?t.label.match(d):null),_?p=>{const y=new this.OlStyleTextConstructor({text:g.resolveAttributeTemplate(p,t.label,""),...f});return new this.OlStyleConstructor({text:y})}:new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:t.label,...f})})}}k(kt,"title","OpenLayers Style Parser");var Yi="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMiAtMTIgMjQgMjQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+DQogIDxwYXRoIGlkPSJoZWFydCIgZD0iTSAtOS41IC0yIEEgMSAxIDAgMCAxIDAgLTcuNSBBIDEgMSAwIDAgMSA5LjUgLTIgTCAwIDEwIFoiICBzdHlsZT0iZmlsbDogIzAwZmYwMDsgc3Ryb2tlOiAjMDAwMDAwOyBzdHJva2Utd2lkdGg6IDE7IiAvPg0KPC9zdmc+",Bi=Object.freeze({__proto__:null,default:Yi});return F.OlStyleParser=kt,F.default=kt,Object.defineProperty(F,"__esModule",{value:!0}),F}({});
//# sourceMappingURL=olStyleParser.iife.js.map
