var GeoStylerOpenlayersParser=function(N){"use strict";var ql=Object.defineProperty;var Xl=(N,W,X)=>W in N?ql(N,W,{enumerable:!0,configurable:!0,writable:!0,value:X}):N[W]=X;var T=(N,W,X)=>Xl(N,typeof W!="symbol"?W+"":W,X);function W(s){return!/^(-?\d|--)/.test(s)}function X(s){const t=[];let e="",i="",l=7;for(let n,r=0;n=s.charAt(r);r++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(n)&&l===7)e+=n;else if(n==="\\"&&l===7)l=6;else if(n===" "&&l===7){if(e!==""){if(!W(e))return null;t.push(e),e=""}}else if(l===6)/[0-9a-f]/i.test(n)?(i+=n,l=8):(e+=n,l=7);else{if(l!==8)return null;/[0-9a-f]/i.test(n)&&i.length<6?i+=n:(e+=String.fromCodePoint(parseInt(i,16)),e+=n,i="",l=7)}if(e!==""){if(!W(e))return null;t.push(e)}return t.join(" ")}function li(s,t){let e=t,i="";const l={"font-family":[]};for(let n,r=0;n=s.charAt(r);r+=1)if(e!==4||n!=='"'&&n!=="'")if(e===3&&n===",")e=4,i="";else if(e===4&&n===","){const a=X(i);a&&l["font-family"].push(a),i=""}else if(e===5&&n===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(i)?(l["font-style"]+=" "+i,i=""):r-=1,e=1;else if(e!==1||n!==" "&&n!=="/")e===2&&n===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(i)&&(l["line-height"]=i),e=4,i=""):i+=n;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(i)||/^(?:larg|small)er$/.test(i)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(i))e=n==="/"?2:4,l["font-size"]=i;else if(/^italic$/.test(i))l["font-style"]=i;else if(/^oblique$/.test(i))l["font-style"]=i,e=5;else if(/^small-caps$/.test(i))l["font-variant"]=i;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(i))l["font-weight"]=i;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(i)){const a=parseFloat(i);a>=1&&a<=1e3&&(l["font-weight"]=i)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(i)&&(l["font-stretch"]=i);i=""}else{let a=r+1;do if(a=s.indexOf(n,a)+1,!a)return null;while(s.charAt(a-2)==="\\");l["font-family"].push(s.slice(r+1,a-1).replace(/\\('|")/g,"$1")),r=a-1,e=3,i=""}if(e===3&&!/^\s*$/.test(i))return null;if(e===4){const n=X(i);n&&l["font-family"].push(n)}return l}function si(s){const t=li(s,1);return t!==null&&t["font-size"]&&t["font-family"].length?t:null}function ni(s){return s!=null&&typeof s.valueOf()=="string"}const ae=s=>(s==null?void 0:s.kind)==="Icon",ri=s=>(s==null?void 0:s.kind)==="Mark"&&ni(s==null?void 0:s.wellKnownName),It=s=>["abs","acos","add","asin","atan","atan2","ceil","cos","div","exp","floor","interpolate","log","max","min","modulo","mul","pi","pow","random","rint","round","sin","sqrt","strIndexOf","strLastIndexOf","strLength","sub","tan","toDegrees","toNumber","toRadians"].includes(s==null?void 0:s.name),Q=s=>["numberFormat","strAbbreviate","strCapitalize","strConcat","strDefaultIfBlank","strReplace","strStripAccents","strSubstring","strSubstringStart","strToLowerCase","strToString","strToUpperCase","strTrim"].includes(s==null?void 0:s.name),ht=s=>["all","any","between","double2bool","equalTo","greaterThan","greaterThanOrEqualTo","in","lessThan","lessThanOrEqualTo","not","notEqualTo","parseBoolean","strEndsWith","strEqualsIgnoreCase","strMatches","strStartsWith"].includes(s==null?void 0:s.name),oe=s=>["case","property","step"].includes(s==null?void 0:s.name),O=s=>ht(s)||It(s)||Q(s)||oe(s),At=s=>typeof(s==null?void 0:s.source)=="string"||O(s==null?void 0:s.source)&&Array.isArray(s.position)&&Array.isArray(s.size);var x={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function ai(s,t,e){return s[0]<=t&&t<=s[2]&&s[1]<=e&&e<=s[3]}function oi(){return[1/0,1/0,-1/0,-1/0]}function ce(s,t,e,i,l){return l?(l[0]=s,l[1]=t,l[2]=e,l[3]=i,l):[s,t,e,i]}function he(s){return ce(1/0,1/0,-1/0,-1/0,s)}function ci(s,t){const e=s[0],i=s[1];return ce(e,i,e,i,t)}function hi(s,t,e,i,l){const n=he(l);return fi(n,s,t,e,i)}function fi(s,t,e,i,l){for(;e<i;e+=l)gi(s,t[e],t[e+1]);return s}function gi(s,t,e){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}function di(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function fe(s){return s[3]-s[1]}function tt(s,t){return s[0]<=t[2]&&s[2]>=t[0]&&s[1]<=t[3]&&s[3]>=t[1]}function ui(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s}function ft(s,t,e){return Math.min(Math.max(s,t),e)}function yi(s,t,e,i){const l=e-s,n=i-t;return l*l+n*n}function ge(s){return s*180/Math.PI}function gt(s){return s*Math.PI/180}function de(s,t){const e=Math.pow(10,t);return Math.round(s*e)/e}function Tt(s,t,e){if(s>=t&&s<e)return s;const i=e-t;return((s-t)%i+i)%i+t}function S(){throw new Error("Unimplemented abstract method.")}let pi=0;function Et(s){return s.ol_uid||(s.ol_uid=String(++pi))}var mi={PROPERTYCHANGE:"propertychange"},B={CHANGE:"change"};class _i{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function ue(s,t){const e=s.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(s[i]!==t[i])return!1;return!0}function ye(){}function wi(s){let t,e,i;return function(){const l=Array.prototype.slice.call(arguments);return(!e||this!==i||!ue(l,e))&&(i=this,e=l,t=s.apply(this,arguments)),t}}function pe(s){for(const t in s)delete s[t]}function xi(s){let t;for(t in s)return!1;return!t}class me{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class _e extends _i{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),l=i[t]||(i[t]=[]);l.includes(e)||l.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,l=this.listeners_&&this.listeners_[i];if(!l)return;const n=e?new me(t):t;n.target||(n.target=this.eventTarget_||this);const r=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in r||(r[i]=0,a[i]=0),++r[i];let o;for(let c=0,h=l.length;c<h;++c)if("handleEvent"in l[c]?o=l[c].handleEvent(n):o=l[c].call(this,n),o===!1||n.propagationStopped){o=!1;break}if(--r[i]===0){let c=a[i];for(delete a[i];c--;)this.removeEventListener(i,ye);delete r[i]}return o}disposeInternal(){this.listeners_&&pe(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const l=i.indexOf(e);l!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[l]=ye,++this.pendingRemovals_[t]):(i.splice(l,1),i.length===0&&delete this.listeners_[t]))}}function dt(s,t,e,i,l){if(l){const r=e;e=function(a){return s.removeEventListener(t,e),r.call(i??this,a)}}else i&&i!==s&&(e=e.bind(i));const n={target:s,type:t,listener:e};return s.addEventListener(t,e),n}function we(s,t,e,i){return dt(s,t,e,i,!0)}function Mt(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),pe(s))}class ki extends _e{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(B.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,l=new Array(i);for(let n=0;n<i;++n)l[n]=dt(this,t[n],e);return l}return dt(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const l=t.length;i=new Array(l);for(let n=0;n<l;++n)i[n]=we(this,t[n],e)}else i=we(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)bi(i);else if(Array.isArray(t))for(let l=0,n=t.length;l<n;++l)this.removeEventListener(t[l],e);else this.removeEventListener(t,e)}}function bi(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)Mt(s[t]);else Mt(s)}class xe extends me{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class Pt extends ki{constructor(t){super(),this.on,this.once,this.un,Et(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new xe(i,t,e)),i=mi.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new xe(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const l=this.values_||(this.values_={});if(i)l[t]=e;else{const n=l[t];l[t]=e,n!==e&&this.notify(t,n)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],xi(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const ke={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Rt{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ke[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const et=6378137,V=Math.PI*et,Si=[-V,-V,V,V],vi=[-180,-85,180,85],ut=et*Math.log(Math.tan(Math.PI/2));class U extends Rt{constructor(t){super({code:t,units:"m",extent:Si,global:!0,worldExtent:vi,getPointResolution:function(e,i){return e/Math.cosh(i[1]/et)}})}}const be=[new U("EPSG:3857"),new U("EPSG:102100"),new U("EPSG:102113"),new U("EPSG:900913"),new U("http://www.opengis.net/def/crs/EPSG/0/3857"),new U("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Ci(s,t,e,i){const l=s.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=s.slice():t=new Array(l));for(let n=0;n<l;n+=i){t[n]=V*s[n]/180;let r=et*Math.log(Math.tan(Math.PI*(+s[n+1]+90)/360));r>ut?r=ut:r<-ut&&(r=-ut),t[n+1]=r}return t}function Oi(s,t,e,i){const l=s.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=s.slice():t=new Array(l));for(let n=0;n<l;n+=i)t[n]=180*s[n]/V,t[n+1]=360*Math.atan(Math.exp(s[n+1]/et))/Math.PI-90;return t}const Fi=6378137,Se=[-180,-90,180,90],Li=Math.PI*Fi/180;class Y extends Rt{constructor(t,e){super({code:t,units:"degrees",extent:Se,axisOrientation:e,global:!0,metersPerUnit:Li,worldExtent:Se})}}const ve=[new Y("CRS:84"),new Y("EPSG:4326","neu"),new Y("urn:ogc:def:crs:OGC:1.3:CRS84"),new Y("urn:ogc:def:crs:OGC:2:84"),new Y("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Y("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Y("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Dt={};function Ii(s){return Dt[s]||Dt[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Ai(s,t){Dt[s]=t}let j={};function it(s,t,e){const i=s.getCode(),l=t.getCode();i in j||(j[i]={}),j[i][l]=e}function Nt(s,t){return s in j&&t in j[s]?j[s][t]:null}const yt=.9996,P=.00669438,pt=P*P,mt=pt*P,$=P/(1-P),Ce=Math.sqrt(1-P),J=(1-Ce)/(1+Ce),Oe=J*J,Wt=Oe*J,zt=Wt*J,Fe=zt*J,Le=1-P/4-3*pt/64-5*mt/256,Ti=3*P/8+3*pt/32+45*mt/1024,Ei=15*pt/256+45*mt/1024,Mi=35*mt/3072,Pi=3/2*J-27/32*Wt+269/512*Fe,Ri=21/16*Oe-55/32*zt,Di=151/96*Wt-417/128*Fe,Ni=1097/512*zt,_t=6378137;function Wi(s,t,e){const i=s-5e5,r=(e.north?t:t-1e7)/yt/(_t*Le),a=r+Pi*Math.sin(2*r)+Ri*Math.sin(4*r)+Di*Math.sin(6*r)+Ni*Math.sin(8*r),o=Math.sin(a),c=o*o,h=Math.cos(a),f=o/h,g=f*f,d=g*g,y=1-P*c,p=Math.sqrt(1-P*c),m=_t/p,_=(1-P)/y,w=$*h**2,k=w*w,b=i/(m*yt),v=b*b,D=v*b,K=D*b,G=K*b,E=G*b,A=a-f/_*(v/2-K/24*(5+3*g+10*w-4*k-9*$))+E/720*(61+90*g+298*w+45*d-252*$-3*k);let F=(b-D/6*(1+2*g+w)+G/120*(5-2*w+28*g-3*k+8*$+24*d))/h;return F=Tt(F+gt(Te(e.number)),-Math.PI,Math.PI),[ge(F),ge(A)]}const Ie=-80,Ae=84,zi=-180,Gi=180;function qi(s,t,e){s=Tt(s,zi,Gi),t<Ie?t=Ie:t>Ae&&(t=Ae);const i=gt(t),l=Math.sin(i),n=Math.cos(i),r=l/n,a=r*r,o=a*a,c=gt(s),h=Te(e.number),f=gt(h),g=_t/Math.sqrt(1-P*l**2),d=$*n**2,y=n*Tt(c-f,-Math.PI,Math.PI),p=y*y,m=p*y,_=m*y,w=_*y,k=w*y,b=_t*(Le*i-Ti*Math.sin(2*i)+Ei*Math.sin(4*i)-Mi*Math.sin(6*i)),v=yt*g*(y+m/6*(1-a+d)+w/120*(5-18*a+o+72*d-58*$))+5e5;let D=yt*(b+g*r*(p/2+_/24*(5-a+9*d+4*d**2)+k/720*(61-58*a+o+600*d-330*$)));return e.north||(D+=1e7),[v,D]}function Te(s){return(s-1)*6-180+3}const Xi=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Ee(s){let t=0;for(const l of Xi){const n=s.match(l);if(n){t=parseInt(n[1]);break}}if(!t)return null;let e=0,i=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(i=!0,e=t-32600),e?{number:e,north:i}:null}function Me(s,t){return function(e,i,l,n){const r=e.length;l=l>1?l:2,n=n??l,i||(l>2?i=e.slice():i=new Array(r));for(let a=0;a<r;a+=n){const o=e[a],c=e[a+1],h=s(o,c,t);i[a]=h[0],i[a+1]=h[1]}return i}}function Bi(s){return Ee(s)?new Rt({code:s,units:"m"}):null}function Yi(s){const t=Ee(s.getCode());return t?{forward:Me(qi,t),inverse:Me(Wi,t)}:null}const $i=[Yi],Hi=[Bi];function Pe(s,t){if(t!==void 0){for(let e=0,i=s.length;e<i;++e)t[e]=s[e];t=t}else t=s.slice();return t}function Gt(s){Ai(s.getCode(),s),it(s,s,Pe)}function Ki(s){s.forEach(Gt)}function qt(s){if(typeof s!="string")return s;const t=Ii(s);if(t)return t;for(const e of Hi){const i=e(s);if(i)return i}return null}function Re(s){Ki(s),s.forEach(function(t){s.forEach(function(e){t!==e&&it(t,e,Pe)})})}function Vi(s,t,e,i){s.forEach(function(l){t.forEach(function(n){it(l,n,e),it(n,l,i)})})}function Ui(s,t){const e=s.getCode(),i=t.getCode();let l=Nt(e,i);if(l)return l;let n=null,r=null;for(const o of $i)n||(n=o(s)),r||(r=o(t));if(!n&&!r)return null;const a="EPSG:4326";if(r)if(n)l=Xt(n.inverse,r.forward);else{const o=Nt(e,a);o&&(l=Xt(o,r.forward))}else{const o=Nt(a,i);o&&(l=Xt(n.inverse,o))}return l&&(Gt(s),Gt(t),it(s,t,l)),l}function Xt(s,t){return function(e,i,l,n){return i=s(e,i,l,n),t(i,i,l,n)}}function De(s,t){const e=qt(s),i=qt(t);return Ui(e,i)}function ji(){Re(be),Re(ve),Vi(ve,be,Ci,Oi)}ji();function wt(s,t){if(!s)throw new Error(t)}const Ji=new Array(6);function Bt(){return[1,0,0,1,0,0]}function Zi(s,t){const e=s[0],i=s[1],l=s[2],n=s[3],r=s[4],a=s[5],o=t[0],c=t[1],h=t[2],f=t[3],g=t[4],d=t[5];return s[0]=e*o+l*c,s[1]=i*o+n*c,s[2]=e*h+l*f,s[3]=i*h+n*f,s[4]=e*g+l*d+r,s[5]=i*g+n*d+a,s}function Qi(s,t,e,i,l,n,r){return s[0]=t,s[1]=e,s[2]=i,s[3]=l,s[4]=n,s[5]=r,s}function tl(s,t,e){return Zi(s,Qi(Ji,t,0,0,e,0,0))}function Ne(s,t,e,i,l,n,r,a){const o=Math.sin(n),c=Math.cos(n);return s[0]=i*c,s[1]=l*o,s[2]=-i*o,s[3]=l*c,s[4]=r*i*c-a*i*o+t,s[5]=r*l*o+a*l*c+e,s}function lt(s,t,e,i,l,n,r){n=n||[],r=r||2;let a=0;for(let o=t;o<e;o+=i){const c=s[o],h=s[o+1];n[a++]=l[0]*c+l[2]*h+l[4],n[a++]=l[1]*c+l[3]*h+l[5];for(let f=2;f<r;f++)n[a++]=s[o+f]}return n&&n.length!=a&&(n.length=a),n}function el(s,t,e,i,l,n,r){r=r||[];const a=Math.cos(l),o=Math.sin(l),c=n[0],h=n[1];let f=0;for(let g=t;g<e;g+=i){const d=s[g]-c,y=s[g+1]-h;r[f++]=c+d*a-y*o,r[f++]=h+d*o+y*a;for(let p=g+2;p<g+i;++p)r[f++]=s[p]}return r&&r.length!=f&&(r.length=f),r}function il(s,t,e,i,l,n,r,a){a=a||[];const o=r[0],c=r[1];let h=0;for(let f=t;f<e;f+=i){const g=s[f]-o,d=s[f+1]-c;a[h++]=o+l*g,a[h++]=c+n*d;for(let y=f+2;y<f+i;++y)a[h++]=s[y]}return a&&a.length!=h&&(a.length=h),a}function ll(s,t,e,i,l,n,r){r=r||[];let a=0;for(let o=t;o<e;o+=i){r[a++]=s[o]+l,r[a++]=s[o+1]+n;for(let c=o+2;c<o+i;++c)r[a++]=s[c]}return r&&r.length!=a&&(r.length=a),r}const We=Bt(),sl=[NaN,NaN];class nl extends Pt{constructor(){super(),this.extent_=oi(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=wi((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const l=this.clone();return l.applyTransform(i),l.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return S()}closestPointXY(t,e,i,l){return S()}containsXY(t,e){return this.closestPointXY(t,e,sl,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return S()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&he(e),this.extentRevision_=this.getRevision()}return ui(this.extent_,t)}rotate(t,e){S()}scale(t,e,i){S()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return S()}getType(){return S()}applyTransform(t){S()}intersectsExtent(t){return S()}translate(t,e){S()}transform(t,e){const i=qt(t),l=i.getUnits()=="tile-pixels"?function(n,r,a){const o=i.getExtent(),c=i.getWorldExtent(),h=fe(c)/fe(o);Ne(We,c[0],c[3],h,-h,0,0,0);const f=lt(n,0,n.length,a,We,r),g=De(i,e);return g?g(f,f,a):f}:De(i,e);return this.applyTransform(l),this}}class rl extends nl{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return S()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=ze(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){S()}setLayout(t,e,i){let l;if(t)l=ze(t);else{for(let n=0;n<i;++n){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}l=e.length,t=al(l)}this.layout=t,this.stride=l}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const l=this.getStride();el(i,0,i.length,l,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=di(this.getExtent()));const l=this.getFlatCoordinates();if(l){const n=this.getStride();il(l,0,l.length,n,t,e,i,l),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const l=this.getStride();ll(i,0,i.length,l,t,e,i),this.changed()}}}function al(s){let t;return s==2?t="XY":s==3?t="XYZ":s==4&&(t="XYZM"),t}function ze(s){let t;return s=="XY"?t=2:s=="XYZ"||s=="XYM"?t=3:s=="XYZM"&&(t=4),t}function ol(s,t,e){const i=s.getFlatCoordinates();if(!i)return null;const l=s.getStride();return lt(i,0,i.length,l,t,e)}function cl(s,t,e,i){for(let l=0,n=e.length;l<n;++l)s[t++]=e[l];return t}class Yt extends rl{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Yt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,l){const n=this.flatCoordinates,r=yi(t,e,n[0],n[1]);if(r<l){const a=this.stride;for(let o=0;o<a;++o)i[o]=n[o];return i.length=a,r}return l}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return ci(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ai(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cl(this.flatCoordinates,0,t,this.stride),this.changed()}}const H=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";H.includes("safari")&&!H.includes("chrom")&&(H.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(H)),H.includes("webkit")&&H.includes("edge"),H.includes("macintosh");const hl=typeof devicePixelRatio<"u"?devicePixelRatio:1,fl=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,gl=typeof Image<"u"&&Image.prototype.decode;(function(){let s=!1;try{const t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return s})();function q(s,t,e,i){let l;return fl?l=new OffscreenCanvas(s||300,t||300):l=document.createElement("canvas"),s&&(l.width=s),t&&(l.height=t),l.getContext("2d",i)}let $t;function Ge(){return $t||($t=q(1,1)),$t}const dl=[NaN,NaN,NaN,0];let Ht;function ul(){return Ht||(Ht=q(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Ht}const yl=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,pl=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,ml=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,_l=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function xt(s,t){return s.endsWith("%")?Number(s.substring(0,s.length-1))/t:Number(s)}function st(s){throw new Error('failed to parse "'+s+'" as color')}function qe(s){if(s.toLowerCase().startsWith("rgb")){const n=s.match(pl)||s.match(yl)||s.match(ml);if(n){const r=n[4],a=100/255;return[ft(xt(n[1],a)+.5|0,0,255),ft(xt(n[2],a)+.5|0,0,255),ft(xt(n[3],a)+.5|0,0,255),r!==void 0?ft(xt(r,100),0,1):1]}st(s)}if(s.startsWith("#")){if(_l.test(s)){const n=s.substring(1),r=n.length<=4?1:2,a=[0,0,0,255];for(let o=0,c=n.length;o<c;o+=r){let h=parseInt(n.substring(o,o+r),16);r===1&&(h+=h<<4),a[o/r]=h}return a[3]=a[3]/255,a}st(s)}const t=ul();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=s,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=s,t.fillStyle===e&&st(s));const i=t.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return qe(i);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const l=Array.from(t.getImageData(0,0,1,1).data);return l[3]=de(l[3]/255,3),l}function wl(s){return typeof s=="string"?s:Xe(s)}const xl=1024,nt={};let Kt=0;function kl(s){if(s==="none")return dl;if(nt.hasOwnProperty(s))return nt[s];if(Kt>=xl){let e=0;for(const i in nt)(e++&3)===0&&(delete nt[i],--Kt)}const t=qe(s);t.length!==4&&st(s);for(const e of t)isNaN(e)&&st(s);return nt[s]=t,++Kt,t}function kt(s){return Array.isArray(s)?s:kl(s)}function Xe(s){let t=s[0];t!=(t|0)&&(t=t+.5|0);let e=s[1];e!=(e|0)&&(e=e+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const l=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+l+")"}function bl(s,t){return new Promise((e,i)=>{function l(){r(),e(s)}function n(){r(),i(new Error("Image load error"))}function r(){s.removeEventListener("load",l),s.removeEventListener("error",n)}s.addEventListener("load",l),s.addEventListener("error",n)})}function Sl(s,t){return t&&(s.src=t),s.src&&gl?new Promise((e,i)=>s.decode().then(()=>e(s)).catch(l=>s.complete&&s.width?e(s):i(l))):bl(s)}class vl{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];(t++&3)===0&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const l=Vt(t,e,i);return l in this.cache_?this.cache_[l]:null}getPattern(t,e,i){const l=Vt(t,e,i);return l in this.patternCache_?this.patternCache_[l]:null}set(t,e,i,l,n){const r=Vt(t,e,i),a=r in this.cache_;this.cache_[r]=l,n&&(l.getImageState()===x.IDLE&&l.load(),l.getImageState()===x.LOADING?l.ready().then(()=>{this.patternCache_[r]=Ge().createPattern(l.getImage(1),"repeat")}):this.patternCache_[r]=Ge().createPattern(l.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Vt(s,t,e){const i=e?kt(e):"null";return t+":"+s+":"+i}const z=new vl;let rt=null;class Be extends _e{constructor(t,e,i,l,n){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=n,this.imageState_=l===void 0?x.IDLE:l,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===x.LOADED){rt||(rt=q(1,1,void 0,{willReadFrequently:!0})),rt.drawImage(this.image_,0,0);try{rt.getImageData(0,0,1,1),this.tainted_=!1}catch{rt=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(B.CHANGE)}handleImageError_(){this.imageState_=x.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=x.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=q(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===x.IDLE){this.image_||this.initializeImage_(),this.imageState_=x.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Sl(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==x.LOADED)return;const e=this.image_,i=q(Math.ceil(e.width*t),Math.ceil(e.height*t)),l=i.canvas;i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=wl(this.color_),i.fillRect(0,0,l.width/t,l.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=l}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===x.LOADED||this.imageState_===x.ERROR)t();else{const e=()=>{(this.imageState_===x.LOADED||this.imageState_===x.ERROR)&&(this.removeEventListener(B.CHANGE,e),t())};this.addEventListener(B.CHANGE,e)}})),this.ready_}}function Ut(s,t,e,i,l,n){let r=t===void 0?void 0:z.get(t,e,l);return r||(r=new Be(s,s&&"src"in s?s.src||void 0:t,e,i,l),z.set(t,e,l,r,n)),n&&r&&!z.getPattern(t,e,l)&&z.set(t,e,l,r,n),r}function Z(s){return s?Array.isArray(s)?Xe(s):typeof s=="object"&&"src"in s?Cl(s):s:null}function Cl(s){if(!s.offset||!s.size)return z.getPattern(s.src,"anonymous",s.color);const t=s.src+":"+s.offset,e=z.getPattern(t,void 0,s.color);if(e)return e;const i=z.get(s.src,"anonymous",null);if(i.getImageState()!==x.LOADED)return null;const l=q(s.size[0],s.size[1]);return l.drawImage(i.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),Ut(l.canvas,t,void 0,x.LOADED,s.color,!0),z.getPattern(t,void 0,s.color)}const Ol="10px sans-serif",bt="#000",St="round",Ye=[],$e=0,vt="round",jt=10,Jt="#000",He="center",Fl="middle",Zt=1;new Pt;function Ct(s,t){return Array.isArray(s)?s:(t===void 0?t=[s,s]:(t[0]=s,t[1]=s),t)}class at{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Ct(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new at({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return S()}getImage(t){return S()}getHitDetectionImage(){return S()}getPixelRatio(t){return 1}getImageState(){return S()}getImageSize(){return S()}getOrigin(){return S()}getSize(){return S()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ct(t)}listenImageChange(t){S()}load(){S()}unlistenImageChange(t){S()}ready(){return Promise.resolve()}}class Ot extends at{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?x.LOADING:x.LOADED,this.imageState_===x.LOADING&&this.ready().then(()=>this.imageState_=x.LOADED),this.render()}clone(){const t=this.getScale(),e=new Ot({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var n,r;const e=(n=this.fill_)==null?void 0:n.getKey(),i=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let l=(r=z.get(i,null,null))==null?void 0:r.getImage(1);if(!l){const a=this.renderOptions_,o=Math.ceil(a.size*t),c=q(o,o);this.draw_(a,c,t),l=c.canvas,z.set(i,null,null,new Be(l,void 0,null,x.LOADED,null))}return l}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let l=this.radius,n=this.radius2_===void 0?l:this.radius2_;if(l<n){const D=l;l=n,n=D}const r=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/r,o=n*Math.sin(a),c=Math.sqrt(n*n-o*o),h=l-c,f=Math.sqrt(o*o+h*h),g=f/o;if(t==="miter"&&g<=i)return g*e;const d=e/2/g,y=e/2*(h/f),m=Math.sqrt((l+d)*(l+d)+y*y)-l;if(this.radius2_===void 0||t==="bevel")return m*2;const _=l*Math.sin(a),w=Math.sqrt(l*l-_*_),k=n-w,v=Math.sqrt(_*_+k*k)/_;if(v<=i){const D=v*e/2-n-l;return 2*Math.max(m,D)}return m*2}createRenderOptions(){let t=St,e=vt,i=0,l=null,n=0,r,a=0;this.stroke_&&(r=Z(this.stroke_.getColor()??Jt),a=this.stroke_.getWidth()??Zt,l=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??vt,t=this.stroke_.getLineCap()??St,i=this.stroke_.getMiterLimit()??jt);const o=this.calculateLineJoinSize_(e,a,i),c=Math.max(this.radius,this.radius2_||0),h=Math.ceil(2*c+o);return{strokeStyle:r,strokeWidth:a,size:h,lineCap:t,lineDash:l,lineDashOffset:n,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let l=this.fill_.getColor();l===null&&(l=bt),e.fillStyle=Z(l),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),l=0;typeof i=="string"&&(i=kt(i)),i===null?l=1:Array.isArray(i)&&(l=i.length===4?i[3]:1),l===0&&(e=q(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const l=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const n=this.angle_-Math.PI/2,r=2*Math.PI/e;for(let a=0;a<e;a++){const o=n+a*r,c=a%2===0?i:l;t.lineTo(c*Math.cos(o),c*Math.sin(o))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=bt,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Qt extends Ot{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Qt({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class ot{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new ot({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Ut(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===x.IDLE&&e.load(),e.getImageState()===x.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?Et(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:kt(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class te{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new te({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class Ft{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Ke,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Ft({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Ke,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Ke(s){return s.getGeometry()}const Ll="#333";class ee{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=Ct(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new ot({color:Ll}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new ee({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ct(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function Ve(s,t,e,i){return e!==void 0&&i!==void 0?[e/s,i/t]:e!==void 0?e/s:i!==void 0?i/t:1}class ie extends at{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,l=t.scale!==void 0?t.scale:1,n=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:l,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:n,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const r=t.img!==void 0?t.img:null;let a=t.src;wt(!(a!==void 0&&r),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&r&&(a=r.src||Et(r)),wt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),wt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let o;if(t.src!==void 0?o=x.IDLE:r!==void 0&&("complete"in r?r.complete?o=r.src?x.LOADED:x.IDLE:o=x.LOADING:o=x.LOADED),this.color_=t.color!==void 0?kt(t.color):null,this.iconImage_=Ut(r,a,this.crossOrigin_,o,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let c,h;if(t.size)[c,h]=t.size;else{const f=this.getImage(1);if(f.width&&f.height)c=f.width,h=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;const g=()=>{if(this.unlistenImageChange(g),!this.initialOptions_)return;const d=this.iconImage_.getSize();this.setScale(Ve(d[0],d[1],t.width,t.height))};this.listenImageChange(g);return}}c!==void 0&&this.setScale(Ve(c,h,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new ie({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const l=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!l)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=l[0]),this.anchorYUnits_=="fraction"&&(t[1]*=l[1])}if(this.anchorOrigin_!="top-left"){if(!l)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+l[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+l[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==x.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==x.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(B.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(B.CHANGE,t)}ready(){return this.iconImage_.ready()}}const Ue={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},le=/^ttf:\/\/(.+)#(.+)$/,je="geostyler-mark-symbolizer",R=Math.PI/180;class u{static getRgbaColor(t,e){if(Q(t)&&(t=u.evaluateStringFunction(t)),typeof t!="string")return;if(t.startsWith("rgba("))return t;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t))return;const l=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);return It(e)&&(e=u.evaluateNumberFunction(e)),e<0&&(e=1),"rgba("+l+", "+n+", "+r+", "+e+")"}static splitRgbaColor(t){const e=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/),i=parseInt(e[0],10),l=parseInt(e[1],10),n=parseInt(e[2],10),r=parseFloat(e[3]);return[i,l,n,r]}static getHexColor(t){if(t.startsWith("#"))return t;if(t.startsWith("rgb")){const e=u.splitRgbaColor(t);return u.getHexCodeFromRgbArray(e)}else if(Ue[t.toLocaleLowerCase()]!==void 0){const e=Ue[t.toLocaleLowerCase()];return u.getHexCodeFromRgbArray(e)}else return}static getHexCodeFromRgbArray(t){return"#"+t.map((e,i)=>{const l=e.toString(16);return i<3?l.length===1?"0"+l:l:""}).join("")}static getHexAlphaFromHexAndOpacity(t,e){if(!t.startsWith("#"))return;e=Math.max(0,Math.min(1,e));const i=Math.round(e*255).toString(16).padStart(2,"0");return`${t}${i}`}static getOpacity(t){const e=t.startsWith("rgba("),i=t.startsWith("#")&&t.length>7;if(!e&&!i)return;let l;if(e?l=u.splitRgbaColor(t):l=[void 0,void 0,void 0,parseInt(t.slice(7,9),16)/255],l.length===4)return l[3]}static checkOpacity(t){return typeof t=="number"&&t>=0&&t<1}static getTextFont(t){const e=t.fontWeight??"normal",i=t.fontStyle??"normal",l=t.size,n=t.font;return e+" "+i+" "+l+"px "+(n==null?void 0:n.join(", "))}static getIsFontGlyphBased(t){return le.test(t.wellKnownName)}static getIsMarkSymbolizerFont(t){if(!t)return!1;const e=je;return t.substring(t.length-e.length,t.length)===e}static getTextFontForMarkSymbolizer(t){const e=t.wellKnownName.match(le);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);const i=e[1];return`Normal ${t.radius||5}px '${i}', ${je}`}static getCharacterForMarkSymbolizer(t){const e=t.wellKnownName.match(le);if(!e)throw new Error(`Could not parse font-based well known name: ${t.wellKnownName}`);return String.fromCharCode(parseInt(e[2],16))}static getFontNameFromOlFont(t){const e=t.match(/(?:\d+\S+) '?"?([^,'"]+)/);if(!e)throw new Error(`Could not find font family name in the following string: ${t}`);return e[1]}static getSizeFromOlFont(t){const e=t.match(/(?:(\d+)px)/);return e?parseInt(e[1],10):0}static resolveAttributeTemplate(t,e,i="n.v.",l=(n,r)=>r){const n="\\{\\{",r="\\}\\}",a=new RegExp(n+"(.*?)"+r,"g"),o=e.match(a);return o&&o.forEach(c=>{let h=0;for(const[f,g]of Object.entries(t.getProperties()))if(c.slice(2,c.length-2).toLowerCase()===f.toLowerCase()){e=e.replace(c,l(f,g));break}else h++;h===Object.keys(t.getProperties()).length&&(e=e.replace(c,i))}),e}static evaluateFunction(t,e){if(t.name==="property"){if(!e)throw new Error(`Could not evalute 'property' function. Feature ${e} is not defined.`);return Q(t.args[0])?e==null?void 0:e.get(u.evaluateStringFunction(t.args[0],e)):e==null?void 0:e.get(t.args[0])}if(oe(t))return u.evaluateUnknownFunction(t,e);if(Q(t))return u.evaluateStringFunction(t,e);if(It(t))return u.evaluateNumberFunction(t,e);if(ht(t))return u.evaluateBooleanFunction(t,e)}static evaluateBooleanFunction(t,e){const i=t.args.map(l=>O(l)?u.evaluateFunction(l,e):l);switch(t.name){case"all":return i.map(l=>this.evaluateBooleanFunction(l,e)).every(l=>l===!0);case"any":return i.map(l=>this.evaluateBooleanFunction(l,e)).some(l=>l===!0);case"between":return i[0]>=i[1]&&i[0]<=i[2];case"double2bool":return!1;case"equalTo":return i[0]===i[1];case"greaterThan":return i[0]>i[1];case"greaterThanOrEqualTo":return i[0]>=i[1];case"in":return i.slice(1).includes(i[0]);case"lessThan":return i[0]<i[1];case"lessThanOrEqualTo":return i[0]<=i[1];case"not":return!i[0];case"notEqualTo":return i[0]!==i[1];case"parseBoolean":return!!i[0];case"strEndsWith":return i[0].endsWith(i[1]);case"strEqualsIgnoreCase":return i[0].toLowerCase()===i[1].toLowerCase();case"strMatches":{const n=i[1].match(/\/(.*?)\/([gimy]{0,4})$/);return n&&n.length===3?new RegExp(n[1],n[2]).test(i[0]):!1}case"strStartsWith":return i[0].startsWith(i[1]);default:return!1}}static evaluateNumberFunction(t,e){if(t.name==="pi")return Math.PI;if(t.name==="random")return Math.random();const i=t.args.map(l=>O(l)?u.evaluateFunction(l,e):l);switch(t.name){case"abs":return Math.abs(i[0]);case"acos":return Math.acos(i[0]);case"add":return i[0]+i[1];case"asin":return Math.asin(i[0]);case"atan":return Math.atan(i[0]);case"atan2":return i[0];case"ceil":return Math.ceil(i[0]);case"cos":return Math.cos(i[0]);case"div":return i[0]/i[1];case"exp":return Math.exp(i[0]);case"floor":return Math.floor(i[0]);case"log":return Math.log(i[0]);case"max":return Math.max(...i);case"min":return Math.min(...i);case"modulo":return i[0]%i[1];case"mul":return i[0]*i[1];case"pow":return Math.pow(i[0],i[1]);case"rint":return i[0];case"round":return Math.round(i[0]);case"sin":return Math.sin(i[0]);case"sqrt":return Math.sqrt(i[0]);case"strIndexOf":return i[0].indexOf(i[1]);case"strLastIndexOf":return i[0].lastIndexOf(i[1]);case"strLength":return i[0].length;case"sub":return i[0]-i[1];case"tan":return Math.tan(i[0]);case"toDegrees":return i[0]/R;case"toRadians":return i[0]*R;default:return i[0]}}static evaluateUnknownFunction(t,e){const i=t.args.map(l=>O(l)?u.evaluateFunction(l,e):l);switch(t.name){case"property":return e==null?void 0:e.get(i[0]);case"case":{const l=i;let n;for(let r=0;r<l.length;r++){const a=l[r];if(r===l.length-1){n=a;break}else if(a.case===!0){n=a.value;break}else if(u.evaluateBooleanFunction(a.case,e)){n=a.value;break}}return n}default:return i[0]}}static evaluateStringFunction(t,e){var l;const i=t.args.map(n=>O(n)?u.evaluateFunction(n,e):n);switch(t.name){case"numberFormat":return i[0];case"strAbbreviate":return i[0];case"strCapitalize":{const n=i[0].toLowerCase().split(" ");for(let r of n)r=r.charAt(0).toUpperCase()+r.substring(1);return n.join(" ")}case"strConcat":return i.join();case"strDefaultIfBlank":return((l=i[0])==null?void 0:l.length)<1?i[1]:i[0];case"strReplace":return i[3]===!0?i[0].replaceAll(i[1],i[2]):i[0].replace(i[1],i[2]);case"strStripAccents":return i[0].normalize("NFKD").replace(/[\u0300-\u036f]/g,"");case"strSubstring":return i[0].substring(i[1],i[2]);case"strSubstringStart":return i[0].substring(i[1]);case"strToLowerCase":return i[0].toLowerCase();case"strToUpperCase":return i[0].toUpperCase();case"strTrim":return i[0].trim();default:return i[0]}}static containsGeoStylerFunctions(t){return t.rules.some(e=>{var r,a,o,c;const i=Array.isArray(e.filter)&&((r=e.filter)==null?void 0:r.some(O)),l=(a=e.symbolizers)==null?void 0:a.some(h=>Object.values(h).some(O)),n=O((o=e==null?void 0:e.scaleDenominator)==null?void 0:o.max)||O((c=e==null?void 0:e.scaleDenominator)==null?void 0:c.min);return i||l||n})}}const Je=["horline","vertline","line"],ct=["horline","vertline","line","cross","cross2","slash","backslash","oarrow","x","half_arc","third_arc","quarter_arc","arrowhead"],Ze="data:image/svg+xml;utf8,",Il=s=>Ze+encodeURIComponent(s),Al=s=>decodeURIComponent(s).replace(Ze,""),Qe=s=>{const t=s.split(";").filter(i=>i.trim()!==""),e={};for(const i of t){const[l,n]=i.split(":").map(r=>r.trim());l&&n&&(e[l]=n)}return e},Tl=s=>{const i=new DOMParser().parseFromString(s,"image/svg+xml").querySelector("svg"),l=i==null?void 0:i.getAttribute("width");if(!i)return;const n=Array.from(i.children).find(h=>h instanceof Element),r=n==null?void 0:n.getAttribute("id"),a=(n==null?void 0:n.getAttribute("style"))??"",o=Qe(a);return{kind:"Mark",wellKnownName:r,radius:Number(l)/2,...o.fill&&{color:o.fill},...o["fill-opacity"]&&{fillOpacity:Number(o["fill-opacity"])},...o.stroke&&{strokeColor:o.stroke},...o["stroke-width"]&&{strokeWidth:Number(o["stroke-width"])},...o["stroke-opacity"]&&{strokeOpacity:Number(o["stroke-opacity"])}}},El=(s,t,e,i)=>{var p;const r=new DOMParser().parseFromString(s,"image/svg+xml").querySelector("svg");if(!r)return;const c=(r.getAttribute("viewBox")||"0 0 0 0").split(" ").map(parseFloat)[2],h=c===8,g=parseFloat(r.getAttribute("width")||"0")/c,d=1/g;t.save(),h||(t.translate(e/2,e/2),t.rotate(i*R),t.scale(g,g));const y=r.children;for(const m of y){const _=m.getAttribute("style")||"",w=Qe(_),k=w.fill||"",b=Number(w["fill-opacity"]??1),v=u.getHexAlphaFromHexAndOpacity(k,b),D=w.stroke||"",K=w["stroke-width"],G=Number(w["stroke-opacity"]??1),E=u.getHexAlphaFromHexAndOpacity(D,G);switch(v?t.fillStyle=v:t.fillStyle="none",E?(t.strokeStyle=E,t.lineWidth=Number(K)*d):(t.strokeStyle="none",t.lineWidth=0),m.tagName){case"rect":{const A=parseFloat(m.getAttribute("x")||"0"),F=parseFloat(m.getAttribute("y")||"0"),L=parseFloat(String(m.getAttribute("width"))),M=parseFloat(String(m.getAttribute("height")));v&&t.fillRect(A,F,L,M),E&&t.strokeRect(A,F,L,M);break}case"circle":{const A=parseFloat(m.getAttribute("cx")||"0"),F=parseFloat(m.getAttribute("cy")||"0"),L=parseFloat(m.getAttribute("r")||"0");t.beginPath(),t.arc(A,F,L,0,2*Math.PI),v&&t.fill(),E&&t.stroke();break}case"polygon":{const A=(p=m.getAttribute("points"))==null?void 0:p.split(" ");if(!A)break;t.beginPath();for(let F=0;F<A.length;F++){const L=A[F].split(",");F===0?t.moveTo(parseFloat(L[0]),parseFloat(L[1])):t.lineTo(parseFloat(L[0]),parseFloat(L[1]))}t.closePath(),v&&t.fill(),E&&t.stroke();break}case"path":{const A=m.getAttribute("d");if(!A)break;const F=A.match(/[MALZ][^MALZ]*/g);if(!F)break;t.beginPath();let L=0,M=0;for(const Lt of F){const Gl=Lt[0],C=Lt.split(/[, ]+/).slice(1).map(parseFloat);switch(Gl){case"M":{for(let I=0;I<C.length-1;I+=2)I<2?t.moveTo(C[I],C[I+1]):t.lineTo(C[I],C[I+1]),L=C[I],M=C[I+1];break}case"L":{for(let I=0;I<C.length-1;I+=2)t.lineTo(C[I],C[I+1]),L=C[I],M=C[I+1];break}case"A":{Ml(t,L,M,C[0],C[1],C[2],C[3],C[4],C[5],C[6]),L=C[5],M=C[6];break}case"Z":{t.closePath();break}}}v&&t.fill(),E&&t.stroke();break}}}t.restore()},Ml=(s,t,e,i,l,n,r,a,o,c)=>{const h=Lt=>Lt*Math.PI/180,f=(t-o)/2,g=(e-c)/2,d=Math.cos(h(n)),y=Math.sin(h(n)),p=d*f+y*g,m=-y*f+d*g;let _=i*i,w=l*l;const k=p*p,b=m*m,v=k/_+b/w;v>1&&(i*=Math.sqrt(v),l*=Math.sqrt(v),_=i*i,w=l*l);const K=(r!==a?1:-1)*Math.sqrt(Math.max(0,(_*w-_*b-w*k)/(_*b+w*k))),G=K*(i*m/l),E=K*(-(l*p)/i),A=d*G-y*E+(t+o)/2,F=y*G+d*E+(e+c)/2,L=Math.atan2((m-E)/l,(p-G)/i);let M=Math.atan2((-m-E)/l,(-p-G)/i);!a&&M>L?M-=2*Math.PI:a&&M<L&&(M+=2*Math.PI),s.arc(A,F,i,L,M,!a)},ti={arrow:'d="M 0,-10 L 5,-5 L 2.5,-5 L 2.5,10 L -2.5,10 L -2.5,-5 L -5,-5 L 0,-10 Z"',arrowhead:'d="M -10 -10 L 0 0 L -10 10"',asterisk_fill:'d="M -1.5,-10 L 1.5,-10L 1.5,-3.939 L 6.011,-8.132 L 8.132,-6.011 L 3.939,-1.5 L 10,-1.5 L 10,1.5 L 3.939,1.5 L 8.132,6.011 L 6.011,8.132 L 1.5,3.939 L 1.5,10 L -1.5,10 L -1.5,3.939 L -6.011,8.132 L -8.132,6.011 L -3.939,1.5 L -10,1.5 L -10,-1.5 L -3.939,-1.5 L -8.132,-6.011 L -6.011,-8.132 L -1.5,-3.939 L -1.5,-10 Z"',backslash:'d="M -12 -12 L 12 12"',carrow:'d="M -10 10 L 0 -10 L 10 10 Z"',circle:'cx="0" cy="0" r="10"',cross:'d="M -12 0 L 12 0 M 0 -12 L 0 12"',cross_fill:'d="M -10,-2 L -10,-2 L -10,2 L -2,2 L -2,10 L 2,10 L 2,2 L 10,2 L 10,-2 L 2,-2 L 2,-10 L -2,-10 L -2,-2 L -10,-2 Z"',cross2:'d="M -12 -12 L 12 12 M 12 -12 L -12 12"',decagon:'points="5.878,8.09 9.511,3.09 9.511,-3.09 5.878,-8.09 0,-10 -5.878,-8.09 -9.511,-3.09 -9.511,3.09 -5.878,8.09 0,10 5.878,8.09"',diagonal_half_square:'points="-10,-10 10,10 -10,10 -10,-10"',diamond:'points="-10,0 0,10 10,0 0,-10 -10,0"',equilateral_triangle:'points="-8.66,5 8.66,5 0,-10 -8.66,5"',filled_arrowhead:'d="M 0,0 L -10,10 L -10,-10 L 0,0 Z"',half_arc:'d="M -10 0 A 10 10 0 0 1 10 0"',half_square:'points="-10,-10 0,-10 0,10 -10,10 -10,-10"',heart:'d="M -9.5 -2 A 1 1 0 0 1 0 -7.5 A 1 1 0 0 1 9.5 -2 L 0 10 Z"',hexagon:'points="-8.66,-5 -8.66,5 0,10 8.66,5 8.66,-5 0,-10 -8.66,-5"',horline:'d="M -12 0 L 12 0"',left_half_triangle:'points="0,10 10,10 0,-10 0,10"',line:'d="M 0 -12 L 0 12"',oarrow:'d="M -10 10 L 0 -10 L 10 10"',octagon:'points="-4.142,10 4.142,10 10,4.142 10,-4.142 4.142,-10 -4.142,-10 -10,-4.142 -10,4.142 -4.142,10"',parallelogram_left:'points="10,5 5,-5 -10,-5 -5,5 10,5"',parallelogram_right:'points="5,5 10,-5 -5,-5 -10,5 5,5"',pentagon:'points="-9.511,-3.09 -5.878,8.09 5.878,8.09 9.511,-3.09 0,-10 -9.511,-3.09"',quarter_arc:'d="M 0 -10 A 10 10 0 0 0 -10 0"',quarter_circle:'d="M 0 -10 A 10 10 0 0 0 -10 0 L 0 0 Z"',quarter_square:'points="-10,-10 0,-10 0,0 -10,0 -10,-10"',right_half_triangle:'points="-10,10 0,10 0,-10 -10,10"',rounded_square:'x="-10" y="-10" width="20" height="20" rx="2.5" ry="2.5"',semi_circle:'d="M -10 0 A 10 10 0 0 1 10 0 L 0 0 Z"',shield:'points="10,5 10,-10 -10,-10 -10,5 0,10 10,5"',slash:'d="M 12 -12 L -12 12"',square:'points="-10,-10 10,-10 10,10 -10,10"',square_with_corners:'points="-6.072,10 6.072,10 10,6.072 10,-6.072 6.072,-10 -6.072,-10 -10,-6.072 -10,6.072 -6.072,10"',star:'d="M -2.24514,-3.09017 -9.51057,-3.09017 -3.63271,1.18034 -5.87785,8.09017 0,3.81966 5.87785,8.09017 3.63271,1.18034 9.51057,-3.09017 2.24514,-3.09017 0,-10 -2.24514,-3.09017 Z"',star_diamond:'d="M -2.70091,-2.70091 -10,0 -2.70091,2.70091 0,10 2.70091,2.70091 10,0 2.70091,-2.70091 0,-10 Z"',third_arc:'d="M 0 -10 A 10 10 0 0 0 -5 8.66"',third_circle:'d="M 0 -10 A 10 10 0 0 0 -5 8.66 L 0 0 Z"',trapezoid:'points="5,-5 10,5 -10,5 -5,-5 5,-5"',triangle:'points="-10,10 10,10 0,-10 -10,10"'},se=s=>{let t=s.replace("shape://","");switch(t=t.replace("brush://",""),t){case"dot":return"circle";case"plus":return"cross";case"times":case"x":return"cross2";case"vertline":return"line";default:return t}},ei=s=>se(s)in ti,ii=s=>{const{wellKnownName:t,radius:e,color:i,fillOpacity:l,strokeColor:n,strokeWidth:r,strokeOpacity:a}=s,o=(e??6)*2;if(!ei(t))throw new Error("Unknown wellKnownName: "+t);const c=se(t),h='<svg xmlns="http://www.w3.org/2000/svg" width="'+o+'" height="'+o+'" viewBox="-12 -12 24 24">',f="</svg>";let g=ti[c]+" ";g.startsWith("points=")?g='<polygon id="'+c+'" '+g:g.startsWith("x=")?g='<rect id="'+c+'" '+g:g.startsWith("cx=")?g='<circle id="'+c+'" '+g:g='<path id="'+c+'" '+g;let d="";if(i&&!ct.includes(c)?d+="fill:"+i+"; ":ct.includes(c)&&(d+="fill:none; "),u.checkOpacity(l)&&!ct.includes(c)&&(d+="fill-opacity:"+l+"; "),n&&(d+="stroke:"+n+"; "),r){const y=o/24;d+="stroke-width:"+Number(r)/y+"; "}return u.checkOpacity(a)&&(d+="stroke-opacity:"+a+"; "),Je.includes(c)&&(d=d+"stroke-linejoin: butt"),g+='style="'+d.trim()+'" />',h+g+f};class Pl{drawCustom(t,e,i,l,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Rl extends Pl{constructor(t,e,i,l,n,r,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=l,this.transformRotation_=l?de(Math.atan2(l[1],l[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=r,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Bt()}drawImages_(t,e,i,l){if(!this.image_)return;const n=lt(t,e,i,l,this.transform_,this.pixelCoordinates_),r=this.context_,a=this.tmpLocalTransform_,o=r.globalAlpha;this.imageOpacity_!=1&&(r.globalAlpha=o*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,f=n.length;h<f;h+=2){const g=n[h]-this.imageAnchorX_,d=n[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const y=g+this.imageAnchorX_,p=d+this.imageAnchorY_;Ne(a,y,p,1,1,c,-y,-p),r.save(),r.transform.apply(r,a),r.translate(y,p),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.restore()}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,g,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(r.globalAlpha=o)}drawText_(t,e,i,l){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=lt(t,e,i,l,this.transform_,this.pixelCoordinates_),r=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=l){const o=n[e]+this.textOffsetX_,c=n[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(r.save(),r.translate(o-this.textOffsetX_,c-this.textOffsetY_),r.rotate(a),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.restore()):(this.textStrokeState_&&r.strokeText(this.text_,o,c),this.textFillState_&&r.fillText(this.text_,o,c))}}moveToLineTo_(t,e,i,l,n){const r=this.context_,a=lt(t,e,i,l,this.transform_,this.pixelCoordinates_);r.moveTo(a[0],a[1]);let o=a.length;n&&(o-=2);for(let c=2;c<o;c+=2)r.lineTo(a[c],a[c+1]);return n&&r.closePath(),i}drawRings_(t,e,i,l){for(let n=0,r=i.length;n<r;++n)e=this.moveToLineTo_(t,e,i[n],l,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=ol(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],l=e[3]-e[1],n=Math.sqrt(i*i+l*l),r=this.context_;r.beginPath(),r.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,l=e.length;i<l;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(tt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,l=t.getFlatCoordinates();let n=0;const r=t.getEnds(),a=t.getStride();i.beginPath();for(let o=0,c=r.length;o<c;++o)n=this.moveToLineTo_(l,n,r[o],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let l=0;const n=t.getEndss(),r=t.getStride();e.beginPath();for(let a=0,o=n.length;a<o;++a){const c=n[a];l=this.drawRings_(i,l,c,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),ue(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,l=t.textAlign?t.textAlign:He;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=l&&(i.textAlign=l,e.textAlign=l),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=l,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:l,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:Z(i||bt)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),l=e.getLineCap(),n=e.getLineDash(),r=e.getLineDashOffset(),a=e.getLineJoin(),o=e.getWidth(),c=e.getMiterLimit(),h=n||Ye;this.strokeState_={lineCap:l!==void 0?l:St,lineDash:this.pixelRatio_===1?h:h.map(f=>f*this.pixelRatio_),lineDashOffset:(r||$e)*this.pixelRatio_,lineJoin:a!==void 0?a:vt,lineWidth:(o!==void 0?o:Zt)*this.pixelRatio_,miterLimit:c!==void 0?c:jt,strokeStyle:Z(i||Jt)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),l=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=l[0]*i,this.imageAnchorY_=l[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const d=e.getColor();this.textFillState_={fillStyle:Z(d||bt)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const d=i.getColor(),y=i.getLineCap(),p=i.getLineDash(),m=i.getLineDashOffset(),_=i.getLineJoin(),w=i.getWidth(),k=i.getMiterLimit();this.textStrokeState_={lineCap:y!==void 0?y:St,lineDash:p||Ye,lineDashOffset:m||$e,lineJoin:_!==void 0?_:vt,lineWidth:w!==void 0?w:Zt,miterLimit:k!==void 0?k:jt,strokeStyle:Z(d||Jt)}}const l=t.getFont(),n=t.getOffsetX(),r=t.getOffsetY(),a=t.getRotateWithView(),o=t.getRotation(),c=t.getScaleArray(),h=t.getText(),f=t.getTextAlign(),g=t.getTextBaseline();this.textState_={font:l!==void 0?l:Ol,textAlign:f!==void 0?f:He,textBaseline:g!==void 0?g:Fl},this.text_=h!==void 0?Array.isArray(h)?h.reduce((d,y,p)=>d+=p%2?" ":y,""):h:"",this.textOffsetX_=n!==void 0?this.pixelRatio_*n:0,this.textOffsetY_=r!==void 0?this.pixelRatio_*r:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=o!==void 0?o:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}function Dl(s,t){const e=s.canvas;t=t||{};const i=t.pixelRatio||hl,l=t.size;l&&(e.width=l[0]*i,e.height=l[1]*i,e.style.width=l[0]+"px",e.style.height=l[1]+"px");const n=[0,0,e.width,e.height],r=tl(Bt(),i,i);return new Rl(s,i,n,r,0)}class ne extends Pt{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new ne(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Mt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=dt(t,B.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Nl(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Nl(s){if(typeof s=="function")return s;let t;return Array.isArray(s)?t=s:(wt(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[s]),function(){return t}}const Wl={horline:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="0" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',line:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="3" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',cross:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="3" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',slash:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="7" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',backslash:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="0" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',x:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="0" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',dense1:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="0" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',dense2:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="1" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',dense3:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="1" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',dense4:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="0" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',dense5:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="0" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="3" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="3" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="7" y="7" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',dense6:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="0" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="0" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="2" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="0" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="4" y="4" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="2" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="6" y="6" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>',dense7:'<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><rect x="1" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="1" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="1" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /><rect x="5" y="5" width="1" height="1" style="fill:black; fill-opacity:1" /></svg>'},zl=s=>{const{wellKnownName:t,color:e,fillOpacity:i,strokeColor:l,strokeOpacity:n,strokeWidth:r}=s,a=t.replace("brush://",""),o=!r&&ct.includes(String(a)),c=a.startsWith("dense");let h;return c||o?(h=Wl[a],c?(h=h.replace(/fill:black/g,`fill:${e}`),h=h.replace(/fill-opacity:1/g,`fill-opacity:${i??1}`)):(h=h.replace(/fill:black/g,`fill:${l}`),h=h.replace(/fill-opacity:1/g,`fill-opacity:${n??1}`))):h=ii(s),h};class re{constructor(t){T(this,"unsupportedProperties",{Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none"},FillSymbolizer:{antialias:"none",opacity:{support:"none",info:"Use fillOpacity instead."}},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none",TextSymbolizer:{anchor:"none",placement:{support:"partial",info:"point and line supported. line-center will be mapped to line."}}},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}});T(this,"title","OpenLayers Style Parser");T(this,"olIconStyleCache",{});T(this,"OlStyleConstructor",Ft);T(this,"OlStyleImageConstructor",at);T(this,"OlStyleFillConstructor",ot);T(this,"OlStyleStrokeConstructor",te);T(this,"OlStyleTextConstructor",ee);T(this,"OlStyleCircleConstructor",Qt);T(this,"OlStyleIconConstructor",ie);T(this,"OlStyleRegularshapeConstructor",Ot);T(this,"isOlParserStyleFct",t=>typeof t=="function");t&&(this.OlStyleConstructor=t.style.Style,this.OlStyleImageConstructor=t.style.Image,this.OlStyleFillConstructor=t.style.Fill,this.OlStyleStrokeConstructor=t.style.Stroke,this.OlStyleTextConstructor=t.style.Text,this.OlStyleCircleConstructor=t.style.Circle,this.OlStyleIconConstructor=t.style.Icon,this.OlStyleRegularshapeConstructor=t.style.RegularShape)}getPointSymbolizerFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleCircleConstructor){const i=t.getImage(),l=i.getFill(),n=i.getStroke(),r=i.getDisplacement();e={kind:"Mark",wellKnownName:"circle",color:l?u.getHexColor(l.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:l?u.getOpacity(l.getColor()):void 0,radius:i.getRadius()!==0?i.getRadius():5,strokeColor:n?n.getColor():void 0,strokeOpacity:n?u.getOpacity(n.getColor()):void 0,strokeWidth:n?n.getWidth():void 0,offset:r[0]||r[1]?r:void 0}}else if(t.getImage()instanceof this.OlStyleRegularshapeConstructor){const i=t.getImage(),l=i.getFill(),n=i.getStroke(),r=i.getRadius(),a=i.getRadius2(),o=i.getPoints(),c=i.getAngle(),h=i.getDisplacement(),f={kind:"Mark",color:l?u.getHexColor(l.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:l?u.getOpacity(l.getColor()):void 0,strokeColor:n?n.getColor():void 0,strokeOpacity:n?u.getOpacity(n.getColor()):void 0,strokeWidth:n?n.getWidth():void 0,radius:r!==0?r:5,rotate:i.getRotation()/R,offset:h[0]||h[1]?h:void 0};switch(o){case 2:switch(c){case 0:f.wellKnownName="shape://vertline";break;case Math.PI/2:f.wellKnownName="shape://horline";break;case Math.PI/4:f.wellKnownName="shape://slash";break;case 2*Math.PI-Math.PI/4:f.wellKnownName="shape://backslash";break}break;case 3:switch(c){case 0:f.wellKnownName="triangle";break;case Math.PI/2:f.wellKnownName="shape://carrow";break}break;case 4:Number.isFinite(a)?i.getAngle()===0?i.getRadius2()===0?f.wellKnownName="shape://plus":f.wellKnownName="star_diamond":f.wellKnownName="x":i.getAngle()===0?f.wellKnownName="diamond":f.wellKnownName="square";break;case 5:Number.isFinite(a)?f.wellKnownName="star":f.wellKnownName="pentagon";break;case 6:f.wellKnownName="hexagon";break;case 8:f.wellKnownName="octagon";break;case 10:f.wellKnownName="decagon";break;default:throw new Error("Could not parse OlStyle.")}e=f}else if(t.getText()instanceof this.OlStyleTextConstructor){const i=t.getText(),l=i.getFill(),n=i.getStroke(),r=i.getRotation();let a=i.getText()||"a";const o=i.getFont()||"10px sans-serif",c=u.getFontNameFromOlFont(o),h=u.getSizeFromOlFont(o),f=[i.getOffsetX(),i.getOffsetY()];Array.isArray(a)&&(a=a[0]),e={kind:"Mark",wellKnownName:`ttf://${c}#0x${a.charCodeAt(0).toString(16)}`,color:l?u.getHexColor(l.getColor()):void 0,opacity:l?u.getOpacity(l.getColor()):void 0,strokeColor:n?n.getColor():void 0,strokeOpacity:n?u.getOpacity(n.getColor()):void 0,strokeWidth:n?n.getWidth():void 0,radius:h!==0?h:5,rotate:r?r/R:0,offset:f[0]||f[1]?f:void 0}}else{const i=t.getImage(),l=i.getDisplacement(),n=i.getWidth(),r=i.getRotation()/R,a=i.getOpacity(),o=i.getSrc();let c;o&&o.startsWith("data:image/svg+xml")?c=Al(o):o&&o.trim().startsWith("<svg")&&(c=o.trim()),c?e={...Tl(c),...u.checkOpacity(a)&&{opacity:a},...r&&{rotate:r},...(l[0]||l[1])&&{offset:l}}:e={kind:"Icon",image:this.getImageFromIconStyle(i),size:n,...u.checkOpacity(a)&&{opacity:a},...r&&{rotate:r},...(l[0]||l[1])&&{offset:l}}}return e}getImageFromIconStyle(t){const e=t.getSize();if(Array.isArray(e)){const i=t.offset_,l=t.offsetOrigin_;if(l&&l!=="top-left")throw new Error(`Offset origin ${l} not supported`);return{source:t.getSrc(),position:i,size:e}}else return t.getSrc()?t.getSrc():void 0}getLineSymbolizerFromOlStyle(t){const e=t.getStroke(),i=e?e.getLineDash():void 0;return{kind:"Line",color:e?u.getHexColor(e.getColor()):void 0,opacity:e?u.getOpacity(e.getColor()):void 0,width:e?e.getWidth():void 0,cap:e?e.getLineCap():"butt",join:e?e.getLineJoin():"miter",dasharray:i||void 0,dashOffset:e?e.getLineDashOffset():void 0}}getFillSymbolizerFromOlStyle(t){const e=t.getFill(),i=t.getStroke(),l=i?i.getLineDash():void 0,n={kind:"Fill"};return e&&(n.color=u.getHexColor(e.getColor())),e&&(n.fillOpacity=u.getOpacity(e.getColor())),i&&(n.outlineColor=u.getHexColor(i.getColor())),l&&(n.outlineDasharray=l),i&&(n.outlineOpacity=u.getOpacity(i.getColor())),i&&i.getWidth()&&(n.outlineWidth=i.getWidth()),n}getTextSymbolizerFromOlStyle(t){const e=t.getText();if(!e)throw new Error("Could not get text from olStyle.");const i=e.getFill(),l=e.getStroke(),n=e.getOffsetX(),r=e.getOffsetY(),a=e.getFont(),o=e.getRotation(),c=e.getOverflow()?e.getOverflow():void 0,h=e.getPlacement(),f=e.getText(),g=Array.isArray(f)?f[0]:f;let d=1/0,y,p,m;if(a){const _=si(a);if(_["font-weight"]&&(p=_["font-weight"]),_["font-size"]&&(d=parseInt(_["font-size"],10)),_["font-family"]){const w=_["font-family"];y=w==null?void 0:w.map(k=>k.includes(" ")?'"'+k+'"':k)}_["font-style"]&&(m=_["font-style"])}return{kind:"Text",label:g,placement:h,allowOverlap:c,color:i?u.getHexColor(i.getColor()):void 0,size:isFinite(d)?d:void 0,font:y,fontWeight:p||void 0,fontStyle:m||void 0,offset:n!==void 0&&r!==void 0?[n,r]:[0,0],haloColor:l&&l.getColor()?u.getHexColor(l.getColor()):void 0,haloWidth:l?l.getWidth():void 0,rotate:o!==void 0?o/R:void 0}}getSymbolizersFromOlStyle(t){const e=[];return t.forEach(i=>{let l;switch(this.getStyleTypeFromOlStyle(i)){case"Point":i.getText()&&!u.getIsMarkSymbolizerFont(i.getText().getFont())?l=this.getTextSymbolizerFromOlStyle(i):l=this.getPointSymbolizerFromOlStyle(i);break;case"Line":l=this.getLineSymbolizerFromOlStyle(i);break;case"Fill":l=this.getFillSymbolizerFromOlStyle(i);break;default:throw new Error("Failed to parse SymbolizerKind from OpenLayers Style")}e.push(l)}),e}getRuleFromOlStyle(t){let e;const i="OL Style Rule 0";return Array.isArray(t)?e=this.getSymbolizersFromOlStyle(t):e=this.getSymbolizersFromOlStyle([t]),{name:i,symbolizers:e}}getStyleTypeFromOlStyle(t){let e;if(t.getImage()instanceof this.OlStyleImageConstructor)e="Point";else if(t.getText()instanceof this.OlStyleTextConstructor)e="Point";else if(t.getFill()instanceof this.OlStyleFillConstructor)e="Fill";else if(t.getStroke()&&!t.getFill())e="Line";else throw new Error("StyleType could not be detected");return e}olStyleToGeoStylerStyle(t){const e="OL Style",i=this.getRuleFromOlStyle(t);return{name:e,rules:[i]}}readStyle(t){return new Promise(e=>{try{if(this.isOlParserStyleFct(t))e({output:t.__geoStylerStyle});else{t=t;const i=this.olStyleToGeoStylerStyle(t),l=this.checkForUnsupportedProperties(i);e({output:i,unsupportedProperties:l})}}catch(i){e({errors:[i]})}})}writeStyle(t){return new Promise(e=>{const i=structuredClone(t),l=this.checkForUnsupportedProperties(i);try{const n=this.getOlStyleTypeFromGeoStylerStyle(i);e({output:n,unsupportedProperties:l,warnings:l&&["Your style contains unsupportedProperties!"]})}catch(n){e({errors:[n]})}})}checkForUnsupportedProperties(t){const e=l=>l[0].toUpperCase()+l.slice(1),i={};if(t.rules.forEach(l=>{l.symbolizers.forEach(n=>{var o,c;const r=e(`${n.kind}Symbolizer`),a=(c=(o=this.unsupportedProperties)==null?void 0:o.Symbolizer)==null?void 0:c[r];a&&(typeof a=="string"?(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[r]=a):Object.keys(n).forEach(h=>{a[h]&&(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[r]||(i.Symbolizer[r]={}),i.Symbolizer[r][h]=a[h])}))})}),Object.keys(i).length>0)return i}getOlStyleTypeFromGeoStylerStyle(t){var l,n,r,a,o,c,h,f;const e=t.rules;if(e.length===1){const g=((n=(l=t==null?void 0:t.rules)==null?void 0:l[0])==null?void 0:n.filter)!==void 0,d=((o=(a=(r=t==null?void 0:t.rules)==null?void 0:r[0])==null?void 0:a.scaleDenominator)==null?void 0:o.min)!==void 0,y=((f=(h=(c=t==null?void 0:t.rules)==null?void 0:c[0])==null?void 0:h.scaleDenominator)==null?void 0:f.max)!==void 0,p=!!(d||y),m=u.containsGeoStylerFunctions(t),_=t.rules[0].symbolizers.length,w=e[0].symbolizers.some(b=>b.kind==="Text"),k=e[0].symbolizers.some(b=>b.kind==="Icon"&&typeof b.image=="string"&&b.image.includes("{{"));return!g&&!p&&!w&&!k&&!m?_===1?this.geoStylerStyleToOlStyle(t):this.geoStylerStyleToOlStyleArray(t):this.geoStylerStyleToOlParserStyleFct(t)}else return this.geoStylerStyleToOlParserStyleFct(t)}geoStylerStyleToOlStyle(t){const i=t.rules[0].symbolizers[0];return this.getOlSymbolizerFromSymbolizer(i)}geoStylerStyleToOlStyleArray(t){const e=t.rules[0],i=[];return e.symbolizers.forEach(l=>{const n=this.getOlSymbolizerFromSymbolizer(l);i.push(n)}),i}geoStylerStyleToOlParserStyleFct(t){const e=structuredClone(t.rules),l=(n,r)=>{const a=[],o=90.7142857142857,c=ke.m,f=r*c*39.37*o;return e.forEach(g=>{var _,w;let d=(_=g==null?void 0:g.scaleDenominator)==null?void 0:_.min,y=(w=g==null?void 0:g.scaleDenominator)==null?void 0:w.max,p=!0;(d||y)&&(d=O(d)?u.evaluateNumberFunction(d):d,y=O(y)?u.evaluateNumberFunction(y):y,d&&f<d&&(p=!1),y&&f>=y&&(p=!1));let m=!1;if(!g.filter)m=!0;else try{m=this.geoStylerFilterToOlParserFilter(n,g.filter)}catch{m=!1}p&&m&&g.symbolizers.forEach(k=>{k.visibility===!1&&a.push(null),ht(k.visibility)&&(u.evaluateBooleanFunction(k.visibility)||a.push(null));const b=this.getOlSymbolizerFromSymbolizer(k,n);if(typeof b!="function")a.push(b);else{const v=b(n,r);a.push(v)}})}),a};return l.__geoStylerStyle=t,l}geoStylerFilterToOlParserFilter(t,e){const i={"&&":!0,"||":!0,"!":!0};let l=!0;if(ht(e))return u.evaluateBooleanFunction(e,t);if(e===!0||e===!1)return e;const n=e[0];let r=!1;i[n]&&(r=!0);try{if(r){let a,o;switch(e[0]){case"&&":a=!0,o=e.slice(1),o.forEach(c=>{this.geoStylerFilterToOlParserFilter(t,c)||(a=!1)}),l=a;break;case"||":a=!1,o=e.slice(1),o.forEach(c=>{this.geoStylerFilterToOlParserFilter(t,c)&&(a=!0)}),l=a;break;case"!":l=!this.geoStylerFilterToOlParserFilter(t,e[1]);break;default:throw new Error("Cannot parse Filter. Unknown combination or negation operator.")}}else{let a;O(e[1])?a=u.evaluateFunction(e[1],t):a=t.get(e[1]);let o;switch(O(e[2])?o=u.evaluateFunction(e[2],t):o=e[2],e[0]){case"==":l=""+a==""+o;break;case"*=":typeof o=="string"&&typeof a=="string"&&(o.length>a.length?l=!1:l=a.indexOf(o)!==-1);break;case"!=":l=""+a!=""+o;break;case"<":l=Number(a)<Number(o);break;case"<=":l=Number(a)<=Number(o);break;case">":l=Number(a)>Number(o);break;case">=":l=Number(a)>=Number(o);break;default:throw new Error("Cannot parse Filter. Unknown comparison operator.")}}}catch{throw new Error("Cannot parse Filter. Invalid structure.")}return l}getOlSymbolizerFromSymbolizer(t,e){let i;switch(t=structuredClone(t),t.kind){case"Mark":i=this.getOlPointSymbolizerFromMarkSymbolizer(t,e);break;case"Icon":i=this.getOlIconSymbolizerFromIconSymbolizer(t,e);break;case"Text":i=this.getOlTextSymbolizerFromTextSymbolizer(t,e);break;case"Line":i=this.getOlLineSymbolizerFromLineSymbolizer(t,e);break;case"Fill":i=this.getOlPolygonSymbolizerFromFillSymbolizer(t,e);break;default:{const l=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),n=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});i=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:l,stroke:n,radius:5}),fill:l,stroke:n});break}}return i}getOlPointSymbolizerFromMarkSymbolizer(t,e){for(const f of Object.keys(t))O(t[f])&&(t[f]=u.evaluateFunction(t[f],e));const i=t.strokeColor,l=t.strokeOpacity,n=t.strokeWidth,r=t.color,a=t.fillOpacity,o=Number(t.rotate)*R,c=t.offset;let h;if(ei(t.wellKnownName)){const f=t.opacity,g=ii(t);h=new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({crossOrigin:"anonymous",...c&&{displacement:c},...u.checkOpacity(f)&&{opacity:f},...o&&{rotation:o},scale:1,src:Il(g)})})}else if(u.getIsFontGlyphBased(t)){const f=i&&u.checkOpacity(l)?u.getRgbaColor(i,l):i,g=r&&u.checkOpacity(a)?u.getRgbaColor(r,a):r,d=new this.OlStyleStrokeConstructor({...f&&{color:f},...n&&{width:n}}),y=new this.OlStyleFillConstructor({...g&&{color:g}});h=new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:u.getCharacterForMarkSymbolizer(t),font:u.getTextFontForMarkSymbolizer(t),...y&&{fill:y},...c&&{offsetX:c[0]},...c&&{offsetY:c[1]},...d&&{stroke:d},...o&&{rotation:o}})})}else throw new Error("MarkSymbolizer cannot be parsed. Unsupported WellKnownName.");return h}getOlIconSymbolizerFromIconSymbolizer(t,e){for(const o of Object.keys(t))O(t[o])&&(t[o]=u.evaluateFunction(t[o],e));const i={src:At(t.image)?t.image.source:t.image,crossOrigin:"anonymous",opacity:t.opacity,width:t.size,rotation:typeof t.rotate=="number"?t.rotate*R:void 0,displacement:t.offset,size:At(t.image)?t.image.size:void 0,offset:At(t.image)?t.image.position:void 0},l="\\{\\{",n="\\}\\}",r=new RegExp(l+".*?"+n,"g");return(typeof t.image=="string"?t.image.match(r):null)?c=>{let h=u.resolveAttributeTemplate(c,t.image,"");h||(h=t.image+"");let f;return this.olIconStyleCache[h]?(f=this.olIconStyleCache[h],i.rotation!==void 0&&f.setRotation(i.rotation),i.opacity!==void 0&&f.setOpacity(i.opacity)):(f=new this.OlStyleIconConstructor({...i,src:h}),this.olIconStyleCache[h]=f),new this.OlStyleConstructor({image:f})}:new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({...i})})}getOlLineSymbolizerFromLineSymbolizer(t,e){for(const r of Object.keys(t))O(t[r])&&(t[r]=u.evaluateFunction(t[r],e));const i=t.color,l=t.opacity,n=i&&l!==null&&l!==void 0?u.getRgbaColor(i,l):i;return new this.OlStyleConstructor({stroke:new this.OlStyleStrokeConstructor({color:n,width:t.width,lineCap:t.cap,lineJoin:t.join,lineDash:t.dasharray,lineDashOffset:t.dashOffset})})}getOlPolygonSymbolizerFromFillSymbolizer(t,e){for(const g of Object.keys(t))O(t[g])&&(t[g]=u.evaluateFunction(t[g],e));const i=t.color,l=t.fillOpacity,n=i&&Number.isFinite(l)?u.getRgbaColor(i,l):i;let r=i?new this.OlStyleFillConstructor({color:n}):void 0;const a=t.outlineColor,o=t.outlineOpacity,c=a&&Number.isFinite(o)?u.getRgbaColor(a,o):a,h=a||t.outlineWidth?new this.OlStyleStrokeConstructor({color:c,width:t.outlineWidth,lineDash:t.outlineDasharray}):void 0,f=new Ft({fill:r,stroke:h});if(t.graphicFill){const g=this.getOlPatternFromGraphicFill(t.graphicFill);r||(r=new ot({})),g&&r.setColor(g),f.setFill(r)}return f}getOlPatternFromGraphicFill(t){if(!ae(t)&&!ri(t))return null;const e=document.createElement("canvas"),i=e.getContext("2d");let l,n=[8,8],r=1.5,a=1;if(ae(t)){const p=this.getOlIconSymbolizerFromIconSymbolizer(t),m=p==null?void 0:p.getImage();if(m==null||m.load(),(m==null?void 0:m.getImageState())!==x.LOADED)return null;n=p.getImage().getSize(),l=n.map(b=>b*r),e.width=l[0],e.height=l[1];const _=Dl(i,{size:l,pixelRatio:1}),w=l.map(b=>b/2),k=new ne(new Yt(w));return _.drawFeature(k,p),i.createPattern(e,"repeat")}const o=zl(t),c=Je.includes(String(t.wellKnownName)),h=se(t.wellKnownName),f=!t.strokeWidth&&ct.includes(h),g=h.startsWith("dense"),d=t.rotate||0;(c||f||g)&&(d/R%1!==0&&(a=Math.sin(d*R)),r=1);const y=(t.radius??4)*2;return n=[y,y],l=n.map(p=>p*r*a),e.width=l[0],e.height=l[1],El(o,i,l[0],d),i.createPattern(e,"repeat")}getOlTextSymbolizerFromTextSymbolizer(t,e){for(const p of Object.keys(t))O(t[p])&&(t[p]=u.evaluateFunction(t[p],e));const i=t.color;let l=t.placement;l||(l="point"),l==="line-center"&&(l="line");const n=t.opacity,r=i&&Number.isFinite(n)?u.getRgbaColor(i,n):i,a=t.haloColor,o=t.haloWidth,c=a&&Number.isFinite(n)?u.getRgbaColor(a,n):a,h={font:u.getTextFont(t),fill:new this.OlStyleFillConstructor({color:r}),stroke:new this.OlStyleStrokeConstructor({color:c,width:o||0}),overflow:t.allowOverlap,offsetX:t.offset?t.offset[0]:0,offsetY:t.offset?t.offset[1]:0,rotation:typeof t.rotate=="number"?t.rotate*R:void 0,placement:l},f="\\{\\{",g="\\}\\}",d=new RegExp(f+".*?"+g,"g");let y;return Q(t.label)||(y=t.label?t.label.match(d):null),y?m=>{const _=new this.OlStyleTextConstructor({text:u.resolveAttributeTemplate(m,t.label,""),...h});return new this.OlStyleConstructor({text:_})}:new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:t.label,...h})})}}return T(re,"title","OpenLayers Style Parser"),N.OlStyleParser=re,N.default=re,Object.defineProperty(N,"__esModule",{value:!0}),N}({});
//# sourceMappingURL=olStyleParser.iife.js.map
